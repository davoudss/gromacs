\hypertarget{share_2template_2gromacs_2sparsematrix_8h}{\section{share/template/gromacs/sparsematrix.h \-File \-Reference}
\label{share_2template_2gromacs_2sparsematrix_8h}\index{share/template/gromacs/sparsematrix.\-h@{share/template/gromacs/sparsematrix.\-h}}
}
{\ttfamily \#include \char`\"{}visibility.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}typedefs.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}types/simple.\-h\char`\"{}}\*
\-Include dependency graph for sparsematrix.\-h\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{share_2template_2gromacs_2sparsematrix_8h__incl}
\end{center}
\end{figure}
\-This graph shows which files directly or indirectly include this file\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{share_2template_2gromacs_2sparsematrix_8h__dep__incl}
\end{center}
\end{figure}
\subsection*{\-Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structgmx__sparsematrix__entry}{gmx\-\_\-sparsematrix\-\_\-entry}
\begin{DoxyCompactList}\small\item\em \-Sparse matrix storage format. \end{DoxyCompactList}\item 
struct \hyperlink{structgmx__sparsematrix}{gmx\-\_\-sparsematrix}
\end{DoxyCompactItemize}
\subsection*{\-Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \*
\hyperlink{structgmx__sparsematrix__entry}{gmx\-\_\-sparsematrix\-\_\-entry} \hyperlink{share_2template_2gromacs_2sparsematrix_8h_a54641be08c4a38f8e92681954751ae7b}{gmx\-\_\-sparsematrix\-\_\-entry\-\_\-t}
\begin{DoxyCompactList}\small\item\em \-Sparse matrix storage format. \end{DoxyCompactList}\item 
typedef struct \hyperlink{structgmx__sparsematrix}{gmx\-\_\-sparsematrix} \hyperlink{share_2template_2gromacs_2sparsematrix_8h_acc946265e6f9b5b25ab54aeed0aa7c1b}{gmx\-\_\-sparsematrix\-\_\-t}
\end{DoxyCompactItemize}
\subsection*{\-Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{share_2template_2gromacs_2visibility_8h_af6d678ccc5288db95c70b9d9003f11e2}{\-G\-M\-X\-\_\-\-L\-I\-B\-G\-M\-X\-\_\-\-E\-X\-P\-O\-R\-T} \*
\hyperlink{include_2sparsematrix_8h_acc946265e6f9b5b25ab54aeed0aa7c1b}{gmx\-\_\-sparsematrix\-\_\-t} $\ast$ \hyperlink{share_2template_2gromacs_2sparsematrix_8h_a55ab15e57dcd5cf935ac18213dfc5800}{gmx\-\_\-sparsematrix\-\_\-init} (int nrow)
\item 
\hyperlink{share_2template_2gromacs_2visibility_8h_af6d678ccc5288db95c70b9d9003f11e2}{\-G\-M\-X\-\_\-\-L\-I\-B\-G\-M\-X\-\_\-\-E\-X\-P\-O\-R\-T} \hyperlink{nbnxn__kernel__simd__4xn__outer_8h_a8dc3f4a797ed992dff49d2fa3477eee8}{void} \hyperlink{share_2template_2gromacs_2sparsematrix_8h_accb01332c2f8a220117c3ef93cf072c5}{gmx\-\_\-sparsematrix\-\_\-destroy} (\hyperlink{include_2sparsematrix_8h_acc946265e6f9b5b25ab54aeed0aa7c1b}{gmx\-\_\-sparsematrix\-\_\-t} $\ast$\hyperlink{shift__util_8c_aacaa5b9630e45bd7f464005e7eb9ce14}{\-A})
\begin{DoxyCompactList}\small\item\em \-Release all resources used by a sparse matrix structure. \end{DoxyCompactList}\item 
\hyperlink{nbnxn__kernel__simd__4xn__outer_8h_a8dc3f4a797ed992dff49d2fa3477eee8}{void} \hyperlink{share_2template_2gromacs_2sparsematrix_8h_ab5fd625fd699ce3c53d8fbc259d21316}{gmx\-\_\-sparsematrix\-\_\-print} (\-F\-I\-L\-E $\ast$stream, \hyperlink{include_2sparsematrix_8h_acc946265e6f9b5b25ab54aeed0aa7c1b}{gmx\-\_\-sparsematrix\-\_\-t} $\ast$\hyperlink{shift__util_8c_aacaa5b9630e45bd7f464005e7eb9ce14}{\-A})
\begin{DoxyCompactList}\small\item\em \-Print sparse matrix to a stream. \end{DoxyCompactList}\item 
real \hyperlink{share_2template_2gromacs_2sparsematrix_8h_ae2eadd66cbe6d28c7458dda42744161d}{gmx\-\_\-sparsematrix\-\_\-value} (\hyperlink{include_2sparsematrix_8h_acc946265e6f9b5b25ab54aeed0aa7c1b}{gmx\-\_\-sparsematrix\-\_\-t} $\ast$\hyperlink{shift__util_8c_aacaa5b9630e45bd7f464005e7eb9ce14}{\-A}, int row, int col)
\item 
\hyperlink{share_2template_2gromacs_2visibility_8h_af6d678ccc5288db95c70b9d9003f11e2}{\-G\-M\-X\-\_\-\-L\-I\-B\-G\-M\-X\-\_\-\-E\-X\-P\-O\-R\-T} \hyperlink{nbnxn__kernel__simd__4xn__outer_8h_a8dc3f4a797ed992dff49d2fa3477eee8}{void} \hyperlink{share_2template_2gromacs_2sparsematrix_8h_acd12a6bcce648aef0432978e24b22c00}{gmx\-\_\-sparsematrix\-\_\-increment\-\_\-value} (\hyperlink{include_2sparsematrix_8h_acc946265e6f9b5b25ab54aeed0aa7c1b}{gmx\-\_\-sparsematrix\-\_\-t} $\ast$\hyperlink{shift__util_8c_aacaa5b9630e45bd7f464005e7eb9ce14}{\-A}, int row, int col, real difference)
\item 
\hyperlink{nbnxn__kernel__simd__4xn__outer_8h_a8dc3f4a797ed992dff49d2fa3477eee8}{void} \hyperlink{share_2template_2gromacs_2sparsematrix_8h_ac3c58041a48f0f821ef71da0d6fbe0fd}{gmx\-\_\-sparsematrix\-\_\-compress} (\hyperlink{include_2sparsematrix_8h_acc946265e6f9b5b25ab54aeed0aa7c1b}{gmx\-\_\-sparsematrix\-\_\-t} $\ast$\hyperlink{shift__util_8c_aacaa5b9630e45bd7f464005e7eb9ce14}{\-A})
\begin{DoxyCompactList}\small\item\em \-Sort elements in each column and remove zeros. \end{DoxyCompactList}\item 
\hyperlink{share_2template_2gromacs_2visibility_8h_af6d678ccc5288db95c70b9d9003f11e2}{\-G\-M\-X\-\_\-\-L\-I\-B\-G\-M\-X\-\_\-\-E\-X\-P\-O\-R\-T} \hyperlink{nbnxn__kernel__simd__4xn__outer_8h_a8dc3f4a797ed992dff49d2fa3477eee8}{void} \hyperlink{share_2template_2gromacs_2sparsematrix_8h_a8d5139fb5857c790f01aff487f736486}{gmx\-\_\-sparsematrix\-\_\-vector\-\_\-multiply} (\hyperlink{include_2sparsematrix_8h_acc946265e6f9b5b25ab54aeed0aa7c1b}{gmx\-\_\-sparsematrix\-\_\-t} $\ast$\hyperlink{shift__util_8c_aacaa5b9630e45bd7f464005e7eb9ce14}{\-A}, real $\ast$\hyperlink{share_2template_2gromacs_2gmx__lapack_8h_a36b8fb392443aff4dd09ac968a2acfe8}{x}, real $\ast$\hyperlink{share_2template_2gromacs_2gmx__lapack_8h_ad992d70ec70c927046cfc2ab1c79b188}{y})
\begin{DoxyCompactList}\small\item\em \-Sparse matrix vector multiplication. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{\-Typedef \-Documentation}
\hypertarget{share_2template_2gromacs_2sparsematrix_8h_a54641be08c4a38f8e92681954751ae7b}{\index{share/template/gromacs/sparsematrix.\-h@{share/template/gromacs/sparsematrix.\-h}!gmx\-\_\-sparsematrix\-\_\-entry\-\_\-t@{gmx\-\_\-sparsematrix\-\_\-entry\-\_\-t}}
\index{gmx\-\_\-sparsematrix\-\_\-entry\-\_\-t@{gmx\-\_\-sparsematrix\-\_\-entry\-\_\-t}!share/template/gromacs/sparsematrix.h@{share/template/gromacs/sparsematrix.\-h}}
\subsubsection[{gmx\-\_\-sparsematrix\-\_\-entry\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf gmx\-\_\-sparsematrix\-\_\-entry}  {\bf gmx\-\_\-sparsematrix\-\_\-entry\-\_\-t}}}\label{share_2template_2gromacs_2sparsematrix_8h_a54641be08c4a38f8e92681954751ae7b}


\-Sparse matrix storage format. 

\-This structure specifies a storage format for a sparse matrix. \-The memory requirements are only proportional to the number of nonzero elements, and it provides a reasonably fast way to perform matrix-\/vector multiplications.

\-The data format is very similar to a neighborlist. \-It is optimized for fast access, but it is difficult to add entries. \-If you are constructing a matrix you should either do it in exactly the order specified here, or use some other more flexible intermediate structure.

\-The index array is of size nrow+1. \-All non-\/zero matrix elements on row i are stored in positions index\mbox{[}i\mbox{]} through index\mbox{[}i+1\mbox{]}-\/1 in the arrays column and value. \-The column array contains the column index for each entry, in ascending order, and the corresponding position in the value array contains the floating point matrix element.

index\mbox{[}nrow\mbox{]} should be equal to the total number of elements stored.

\-Thus, to find the value of matrix element \mbox{[}5,4\mbox{]} you should loop over positions index\mbox{[}5\mbox{]} to index\mbox{[}6\mbox{]}-\/1 in column until you either find the value 4, or a higher value (meaning the element was zero).

\-It is fairly easy to construct the matrix on-\/the-\/fly if you can do it row-\/by-\/row.

\-I\-M\-P\-O\-R\-T\-A\-N\-T\-: \-If compressed\-\_\-symmetric is set to \-T\-R\-U\-E, you should only store \-E\-I\-T\-H\-E\-R the upper \-O\-R lower triangle (and the diagonal), and the other half is assumed to be symmetric. \-Otherwise, if compressed\-\_\-symmetric==\-F\-A\-L\-S\-E, no symmetry is implied and all elements should be stored.

\-The symmetry compression saves us a factor 2 both in storage and matrix multiplication \-C\-P\-U-\/time, which can be very useful for huge eigenproblems.

\-If you are unsure, just set compressed\-\_\-symmetric to \-F\-A\-L\-S\-E and list all elements. \-If you enable it but still list all elements (both upper and lower triangle) you will be sorry...

\-Internally, the sparse data is stored as a separate list for each row, where the list element is a structure with a column and (floating-\/point) data value. \-This makes it possible, although not completely transparent, to update values in random access order. \-The drawback is that the structure will allocate nrow memory regions. \-The matrix data could be stored in a single contiguous array with indices for each row, but then we could only insert elements at the end without copying the entire matrix.

\-After you have

\-In other words\-: \-Not perfect, but it works. \hypertarget{share_2template_2gromacs_2sparsematrix_8h_acc946265e6f9b5b25ab54aeed0aa7c1b}{\index{share/template/gromacs/sparsematrix.\-h@{share/template/gromacs/sparsematrix.\-h}!gmx\-\_\-sparsematrix\-\_\-t@{gmx\-\_\-sparsematrix\-\_\-t}}
\index{gmx\-\_\-sparsematrix\-\_\-t@{gmx\-\_\-sparsematrix\-\_\-t}!share/template/gromacs/sparsematrix.h@{share/template/gromacs/sparsematrix.\-h}}
\subsubsection[{gmx\-\_\-sparsematrix\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf gmx\-\_\-sparsematrix}
 {\bf gmx\-\_\-sparsematrix\-\_\-t}}}\label{share_2template_2gromacs_2sparsematrix_8h_acc946265e6f9b5b25ab54aeed0aa7c1b}


\subsection{\-Function \-Documentation}
\hypertarget{share_2template_2gromacs_2sparsematrix_8h_ac3c58041a48f0f821ef71da0d6fbe0fd}{\index{share/template/gromacs/sparsematrix.\-h@{share/template/gromacs/sparsematrix.\-h}!gmx\-\_\-sparsematrix\-\_\-compress@{gmx\-\_\-sparsematrix\-\_\-compress}}
\index{gmx\-\_\-sparsematrix\-\_\-compress@{gmx\-\_\-sparsematrix\-\_\-compress}!share/template/gromacs/sparsematrix.h@{share/template/gromacs/sparsematrix.\-h}}
\subsubsection[{gmx\-\_\-sparsematrix\-\_\-compress}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} {\bf gmx\-\_\-sparsematrix\-\_\-compress} (
\begin{DoxyParamCaption}
\item[{{\bf gmx\-\_\-sparsematrix\-\_\-t} $\ast$}]{\-A}
\end{DoxyParamCaption}
)}}\label{share_2template_2gromacs_2sparsematrix_8h_ac3c58041a48f0f821ef71da0d6fbe0fd}


\-Sort elements in each column and remove zeros. 

\-Sparse matrix access is faster when the elements are stored in increasing column order in each row. \-In some cases previously non-\/zero elements will be zero after adding more data, and this routine also removes those entries to reduce the storage requirements.

\-It never hurts to run this routine if you have been updating the matrix... 

\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{share_2template_2gromacs_2sparsematrix_8h_ac3c58041a48f0f821ef71da0d6fbe0fd_cgraph}
\end{center}
\end{figure}


\hypertarget{share_2template_2gromacs_2sparsematrix_8h_accb01332c2f8a220117c3ef93cf072c5}{\index{share/template/gromacs/sparsematrix.\-h@{share/template/gromacs/sparsematrix.\-h}!gmx\-\_\-sparsematrix\-\_\-destroy@{gmx\-\_\-sparsematrix\-\_\-destroy}}
\index{gmx\-\_\-sparsematrix\-\_\-destroy@{gmx\-\_\-sparsematrix\-\_\-destroy}!share/template/gromacs/sparsematrix.h@{share/template/gromacs/sparsematrix.\-h}}
\subsubsection[{gmx\-\_\-sparsematrix\-\_\-destroy}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-G\-M\-X\-\_\-\-L\-I\-B\-G\-M\-X\-\_\-\-E\-X\-P\-O\-R\-T} {\bf void} {\bf gmx\-\_\-sparsematrix\-\_\-destroy} (
\begin{DoxyParamCaption}
\item[{{\bf gmx\-\_\-sparsematrix\-\_\-t} $\ast$}]{\-A}
\end{DoxyParamCaption}
)}}\label{share_2template_2gromacs_2sparsematrix_8h_accb01332c2f8a220117c3ef93cf072c5}


\-Release all resources used by a sparse matrix structure. 

\-All arrays in the structure will be freed, and the structure itself. \hypertarget{share_2template_2gromacs_2sparsematrix_8h_acd12a6bcce648aef0432978e24b22c00}{\index{share/template/gromacs/sparsematrix.\-h@{share/template/gromacs/sparsematrix.\-h}!gmx\-\_\-sparsematrix\-\_\-increment\-\_\-value@{gmx\-\_\-sparsematrix\-\_\-increment\-\_\-value}}
\index{gmx\-\_\-sparsematrix\-\_\-increment\-\_\-value@{gmx\-\_\-sparsematrix\-\_\-increment\-\_\-value}!share/template/gromacs/sparsematrix.h@{share/template/gromacs/sparsematrix.\-h}}
\subsubsection[{gmx\-\_\-sparsematrix\-\_\-increment\-\_\-value}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-G\-M\-X\-\_\-\-L\-I\-B\-G\-M\-X\-\_\-\-E\-X\-P\-O\-R\-T} {\bf void} {\bf gmx\-\_\-sparsematrix\-\_\-increment\-\_\-value} (
\begin{DoxyParamCaption}
\item[{{\bf gmx\-\_\-sparsematrix\-\_\-t} $\ast$}]{\-A, }
\item[{int}]{row, }
\item[{int}]{col, }
\item[{real}]{difference}
\end{DoxyParamCaption}
)}}\label{share_2template_2gromacs_2sparsematrix_8h_acd12a6bcce648aef0432978e24b22c00}
\hypertarget{share_2template_2gromacs_2sparsematrix_8h_a55ab15e57dcd5cf935ac18213dfc5800}{\index{share/template/gromacs/sparsematrix.\-h@{share/template/gromacs/sparsematrix.\-h}!gmx\-\_\-sparsematrix\-\_\-init@{gmx\-\_\-sparsematrix\-\_\-init}}
\index{gmx\-\_\-sparsematrix\-\_\-init@{gmx\-\_\-sparsematrix\-\_\-init}!share/template/gromacs/sparsematrix.h@{share/template/gromacs/sparsematrix.\-h}}
\subsubsection[{gmx\-\_\-sparsematrix\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-G\-M\-X\-\_\-\-L\-I\-B\-G\-M\-X\-\_\-\-E\-X\-P\-O\-R\-T} {\bf gmx\-\_\-sparsematrix\-\_\-t}$\ast$ {\bf gmx\-\_\-sparsematrix\-\_\-init} (
\begin{DoxyParamCaption}
\item[{int}]{nrow}
\end{DoxyParamCaption}
)}}\label{share_2template_2gromacs_2sparsematrix_8h_a55ab15e57dcd5cf935ac18213dfc5800}
a new sparse matrix structure

\-The number of rows is used to allocate the index array entry. \-Obviously you can reallocate these later yourself if necessary -\/ this is a convenience routine.

\-By default, the compressed\-\_\-symmetric flag in the structure will be \-F\-A\-L\-S\-E. \-Set it to \-T\-R\-U\-E manually if you are only storing either the upper or lower half of the matrix. \hypertarget{share_2template_2gromacs_2sparsematrix_8h_ab5fd625fd699ce3c53d8fbc259d21316}{\index{share/template/gromacs/sparsematrix.\-h@{share/template/gromacs/sparsematrix.\-h}!gmx\-\_\-sparsematrix\-\_\-print@{gmx\-\_\-sparsematrix\-\_\-print}}
\index{gmx\-\_\-sparsematrix\-\_\-print@{gmx\-\_\-sparsematrix\-\_\-print}!share/template/gromacs/sparsematrix.h@{share/template/gromacs/sparsematrix.\-h}}
\subsubsection[{gmx\-\_\-sparsematrix\-\_\-print}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} {\bf gmx\-\_\-sparsematrix\-\_\-print} (
\begin{DoxyParamCaption}
\item[{\-F\-I\-L\-E $\ast$}]{stream, }
\item[{{\bf gmx\-\_\-sparsematrix\-\_\-t} $\ast$}]{\-A}
\end{DoxyParamCaption}
)}}\label{share_2template_2gromacs_2sparsematrix_8h_ab5fd625fd699ce3c53d8fbc259d21316}


\-Print sparse matrix to a stream. 

\-Mainly used for debugging. \-Be warned that the real sparse matrices used in \-Gromacs runs can be \-H\-U\-G\-E (think 100,000 rows). \hypertarget{share_2template_2gromacs_2sparsematrix_8h_ae2eadd66cbe6d28c7458dda42744161d}{\index{share/template/gromacs/sparsematrix.\-h@{share/template/gromacs/sparsematrix.\-h}!gmx\-\_\-sparsematrix\-\_\-value@{gmx\-\_\-sparsematrix\-\_\-value}}
\index{gmx\-\_\-sparsematrix\-\_\-value@{gmx\-\_\-sparsematrix\-\_\-value}!share/template/gromacs/sparsematrix.h@{share/template/gromacs/sparsematrix.\-h}}
\subsubsection[{gmx\-\_\-sparsematrix\-\_\-value}]{\setlength{\rightskip}{0pt plus 5cm}real {\bf gmx\-\_\-sparsematrix\-\_\-value} (
\begin{DoxyParamCaption}
\item[{{\bf gmx\-\_\-sparsematrix\-\_\-t} $\ast$}]{\-A, }
\item[{int}]{row, }
\item[{int}]{col}
\end{DoxyParamCaption}
)}}\label{share_2template_2gromacs_2sparsematrix_8h_ae2eadd66cbe6d28c7458dda42744161d}
\hypertarget{share_2template_2gromacs_2sparsematrix_8h_a8d5139fb5857c790f01aff487f736486}{\index{share/template/gromacs/sparsematrix.\-h@{share/template/gromacs/sparsematrix.\-h}!gmx\-\_\-sparsematrix\-\_\-vector\-\_\-multiply@{gmx\-\_\-sparsematrix\-\_\-vector\-\_\-multiply}}
\index{gmx\-\_\-sparsematrix\-\_\-vector\-\_\-multiply@{gmx\-\_\-sparsematrix\-\_\-vector\-\_\-multiply}!share/template/gromacs/sparsematrix.h@{share/template/gromacs/sparsematrix.\-h}}
\subsubsection[{gmx\-\_\-sparsematrix\-\_\-vector\-\_\-multiply}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-G\-M\-X\-\_\-\-L\-I\-B\-G\-M\-X\-\_\-\-E\-X\-P\-O\-R\-T} {\bf void} {\bf gmx\-\_\-sparsematrix\-\_\-vector\-\_\-multiply} (
\begin{DoxyParamCaption}
\item[{{\bf gmx\-\_\-sparsematrix\-\_\-t} $\ast$}]{\-A, }
\item[{real $\ast$}]{x, }
\item[{real $\ast$}]{y}
\end{DoxyParamCaption}
)}}\label{share_2template_2gromacs_2sparsematrix_8h_a8d5139fb5857c790f01aff487f736486}


\-Sparse matrix vector multiplication. 

\-Calculate y = \-A $\ast$ x for a sparse matrix \-A. 