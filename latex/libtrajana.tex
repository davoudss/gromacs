\-This is a trajectory analysis library for \-Gromacs.

\-The main features of the library are\-:
\begin{DoxyItemize}
\item \hyperlink{selengine}{\-Flexible handling of textual selections} that can also be dynamic, i.\-e., depend of the trajectory frame through positions of the particles. \-Selections evaluate directly to positions, which can then be used in the analysis program.
\item \hyperlink{selmethods}{\-Custom selection keywords} can also be easily implemented, also on a tool-\/by-\/tool basis.
\item \-Efficient \hyperlink{nbsearch}{neighborhood searching} (currently not very efficient...).
\item \hyperlink{displacements}{\-On-\/the-\/fly calculation of displacement vectors} during a single pass over the trajectory.
\item \hyperlink{histograms}{\-Calculation of histograms} with error estimates through block averaging.
\end{DoxyItemize}

\-The functions also automate several things common to most analysis programs such as making molecules whole if required, reading input files, and setting up index groups for analysis. \-The library unifies the structure of analysis programs (at least a bit) and makes it easier to add common functionality to all analysis programs.\hypertarget{libtrajana_main_using}{}\section{\-Using the library}\label{libtrajana_main_using}
\-There is a \hyperlink{template_8c}{template} for writing analysis programs, the documentation for it and links from there should help getting started.\hypertarget{libtrajana_libtrajana_impl}{}\section{\-Implementation details}\label{libtrajana_libtrajana_impl}
\-Some internal implementation details of the library are documented on separate pages\-:
\begin{DoxyItemize}
\item poscalcengine
\item selparser
\item selcompiler 
\end{DoxyItemize}\hypertarget{selengine}{}\section{\-Text-\/based selections}\label{selengine}
\hypertarget{selengine_selection_basics}{}\subsection{\-Basics}\label{selengine_selection_basics}
\-Selections are enabled automatically for an analysis program that uses the library. \-The selection syntax is described in an online help that is accessible from all tools that use the library. \-By default, dynamic selections are allowed, and the user can freely choose whether to analyze atoms or centers of mass/geometry of residues/molecules. \-These defaults, as well as some others, can be changed by specifying flags for \hyperlink{include_2trajana_8h_afc7e80051e814978605f1f690ec41c50}{gmx\-\_\-ana\-\_\-traj\-\_\-create()}.

\-The analysis program can then access the selected positions for each frame through a {\ttfamily \hyperlink{structgmx__ana__selection__t}{gmx\-\_\-ana\-\_\-selection\-\_\-t}} array that is passed to the frame analysis function (see \hyperlink{include_2trajana_8h_ae359015d9f5e49a31d5f4fd113bf7a3d}{gmx\-\_\-analysisfunc()}). \-As long as the analysis program is written such that it does not assume that the number of positions or the atoms in the groups groups remain constant, any kind of selection expression can be used.

\-Some analysis programs may require a special structure for the index groups (e.\-g., {\ttfamily g\-\_\-angle} requires the index group to be made of groups of three or four atoms). \-For such programs, it is up to the user to provide a proper selection expression that always returns such positions. \-Such analysis program can define \hyperlink{share_2template_2gromacs_2trajana_8h_a0c15f014b7ee3da0efeb2b279e210633}{\-A\-N\-A\-\_\-\-R\-E\-Q\-U\-I\-R\-E\-\_\-\-W\-H\-O\-L\-E} to make the default behavior appropriate for the most common uses where the groups should consist of atoms within a single residue/molecule.\hypertarget{selengine_selection_methods}{}\subsection{\-Implementing new keywords}\label{selengine_selection_methods}
\-New selection keywords can be easily implemented, either directly into the library or as part of analysis programs (the latter may be useful for testing or methods very specific to some analysis). \-For both cases, you should first create a {\ttfamily \hyperlink{structgmx__ana__selmethod__t}{gmx\-\_\-ana\-\_\-selmethod\-\_\-t}} structure and fill it with the necessary information. \-Details can be found on a separate page\-: \hyperlink{selmethods}{\-Custom selection methods}. \hypertarget{selmethods}{}\section{\-Custom selection methods}\label{selmethods}
\-Custom selection methods are defined by creating a new instance of {\ttfamily \hyperlink{structgmx__ana__selmethod__t}{gmx\-\_\-ana\-\_\-selmethod\-\_\-t}} and filling it with the necessary data for handling the selection. \-The structure contains callback pointers that define the actual behavior of the method. \-The following sections discuss how the structure should be filled and how to implement the callbacks.\hypertarget{selmethods_selmethods_define}{}\subsection{$\backslash$c gmx\-\_\-ana\-\_\-selmethod\-\_\-t data structure}\label{selmethods_selmethods_define}
\-An example {\ttfamily \hyperlink{structgmx__ana__selmethod__t}{gmx\-\_\-ana\-\_\-selmethod\-\_\-t}} definition could look like this\-:


\begin{DoxyCode}
 gmx_ana_selmethod_t sm_example = {
   "example", GROUP_VALUE, 0,
   asize(sm_params_example), sm_params_example,
   &init_data_example,
    NULL,
   &init_example,
    NULL,
   &free_data_example,
   &init_frame_example,
   &evaluate_example,
    NULL,
   {"example from POS_EXPR [cutoff REAL]", 0, NULL},
 };
\end{DoxyCode}


\-The first value defines the name of the method. \-It is used mostly for informational purposes; the actual name(s) recognized by the selection parser are defined by the call to \hyperlink{include_2selmethod_8h_a820231622b6b4dd57fba7570f705498f}{gmx\-\_\-ana\-\_\-selmethod\-\_\-register()} (see \hyperlink{selmethods_selmethods_register}{\-Registering the method}).

\-The second value defines the type of the value the method returns. \-Possible values are
\begin{DoxyItemize}
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8}{\-N\-O\-\_\-\-V\-A\-L\-U\-E} \-: \-This is allowed only for methods that have the flag \hyperlink{share_2template_2gromacs_2selmethod_8h_aa5b18df47b72690889afd89f5e68694c}{\-S\-M\-E\-T\-H\-\_\-\-M\-O\-D\-I\-F\-I\-E\-R} set (see \hyperlink{selmethods_selmethods_modifiers}{\-Selection modifiers}).
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8becacd1ce0b084595a6072a57781dc7738a0}{\-I\-N\-T\-\_\-\-V\-A\-L\-U\-E} \-: \-The method returns one or more integer values.
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca7aa9587044cd6fd9c1f1690719a072cf}{\-R\-E\-A\-L\-\_\-\-V\-A\-L\-U\-E} \-: \-The method returns one or more floating-\/point values.
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca6f2f1fe9592d96990c9ac690c355bd08}{\-S\-T\-R\-\_\-\-V\-A\-L\-U\-E} \-: \-The method returns one or more strings.
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec}{\-P\-O\-S\-\_\-\-V\-A\-L\-U\-E} \-: \-The method returns one or more 3\-D vectors.
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6}{\-G\-R\-O\-U\-P\-\_\-\-V\-A\-L\-U\-E} \-: \-The method returns a single index group.
\end{DoxyItemize}

\-The third value gives additional information about the method using a combination of flags. \-Possible flags are\-:
\begin{DoxyItemize}
\item \hyperlink{share_2template_2gromacs_2selmethod_8h_ac5e632efef31120c54b55eac79cb23cc}{\-S\-M\-E\-T\-H\-\_\-\-R\-E\-Q\-T\-O\-P} \-: \-If set, the topology information is always loaded and the {\ttfamily top} pointer passed to the callbacks is guaranteed to be non-\/\-N\-U\-L\-L. \-Should be set if the method requires topology information for evaluation.
\item \hyperlink{share_2template_2gromacs_2selmethod_8h_af38b0eb2b4e305ae83ded06f9b12252e}{\-S\-M\-E\-T\-H\-\_\-\-D\-Y\-N\-A\-M\-I\-C} \-: \-If set, the method can only be evaluated dynamically, i.\-e., it requires data from the trajectory frame.
\item \hyperlink{share_2template_2gromacs_2selmethod_8h_aa5b18df47b72690889afd89f5e68694c}{\-S\-M\-E\-T\-H\-\_\-\-M\-O\-D\-I\-F\-I\-E\-R} \-: \-If set, the method is a selection modifier and not an actual selection method. \-For more details, see \hyperlink{selmethods_selmethods_modifiers}{\-Selection modifiers}.
\end{DoxyItemize}

\-There are two additional flags that specify the number of values the method returns. \-Only one of them can be set at a time. \-If neither is set, the default behavior is to evaluate a value for each input atom (except for \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6}{\-G\-R\-O\-U\-P\-\_\-\-V\-A\-L\-U\-E} methods, which always return a single group). \-Other behaviors can be specified with these flags\-:
\begin{DoxyItemize}
\item \hyperlink{share_2template_2gromacs_2selmethod_8h_a2de9fc1fca93570388059f72b064df08}{\-S\-M\-E\-T\-H\-\_\-\-S\-I\-N\-G\-L\-E\-V\-A\-L} \-: \-If set, the method evaluates to a single value. \-This is automatically set if the type is \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6}{\-G\-R\-O\-U\-P\-\_\-\-V\-A\-L\-U\-E}.
\item \hyperlink{share_2template_2gromacs_2selmethod_8h_ae0aa6a1bbb99ba5f0f6228c4cd401e0a}{\-S\-M\-E\-T\-H\-\_\-\-V\-A\-R\-N\-U\-M\-V\-A\-L} \-: \-If set, the method evaluates to an arbitrary number of values. \-The number of values is determined based on the values given by the user to the method parameters (see \hyperlink{selmethods_selmethods_params}{\-Defining parameters}).
\end{DoxyItemize}\-If either of these flags is specified (and the method type is not \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6}{\-G\-R\-O\-U\-P\-\_\-\-V\-A\-L\-U\-E}), the group passed to the evaluation callback should not be used as it can be \-N\-U\-L\-L. \-Currently, the above flags only work (have been tested) for \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec}{\-P\-O\-S\-\_\-\-V\-A\-L\-U\-E} methods.

\-There is one additional flag that can only be specified for \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca6f2f1fe9592d96990c9ac690c355bd08}{\-S\-T\-R\-\_\-\-V\-A\-L\-U\-E} methods\-: \hyperlink{share_2template_2gromacs_2selmethod_8h_a78abdcb637f45eafa513d07aaf14a45e}{\-S\-M\-E\-T\-H\-\_\-\-C\-H\-A\-R\-V\-A\-L} . \-It is meant for to ease implementation of methods that evaluate to strings consisting of single characters.

\-The next two values determine the number of parameters and a pointer to the parameter array. \-The contents of the parameter array are described in \hyperlink{selmethods_selmethods_params}{\-Defining parameters}. \-If the method does not take parameters, the first value should be 0 and the second can be \-N\-U\-L\-L. \-Currently, \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca6f2f1fe9592d96990c9ac690c355bd08}{\-S\-T\-R\-\_\-\-V\-A\-L\-U\-E} methods cannot take parameters, but this limitation should be easy to lift if required.

\-These are followed by function callbacks that determine the actual behavior of the method. \-Any of these except the evaluation callback can be \-N\-U\-L\-L (the evaluation callback can also be \-N\-U\-L\-L if \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8}{\-N\-O\-\_\-\-V\-A\-L\-U\-E} is specified for a selection modifier). \-However, the presence of parameters can require some of the callbacks to be implemented. \-The details are described in \hyperlink{selmethods_selmethods_callbacks}{\-Implementing callbacks}.

\-Finally, there is a data structure that gives help texts for the method.

\-The {\ttfamily \hyperlink{structgmx__ana__selmethod__t}{gmx\-\_\-ana\-\_\-selmethod\-\_\-t}} variable should be declared as a global variable or it should be otherwise ensured that the structure is not freed\-: only a pointer to the structure is stored by the library.\hypertarget{selmethods_selmethods_params}{}\subsection{\-Defining parameters}\label{selmethods_selmethods_params}
\-Parameters to selection methods are defined in a separate array of {\ttfamily \hyperlink{structgmx__ana__selparam__t}{gmx\-\_\-ana\-\_\-selparam\-\_\-t}} structures. \-The order of the parameters does not matter (except possibly for callback implementation), with one important exception\-: \-If the method evaluates to a \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec}{\-P\-O\-S\-\_\-\-V\-A\-L\-U\-E}, the first parameter should have \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6}{\-G\-R\-O\-U\-P\-\_\-\-V\-A\-L\-U\-E} and be the one that is used to calculate the positions.

\-An example parameter definition\-: 
\begin{DoxyCode}
 static gmx_ana_selparam_t sm_params_example[] = {
   {"cutoff", {REAL_VALUE, 1, {NULL}}, NULL, SPAR_OPTIONAL},
   {"from",   {POS_VALUE, -1, {NULL}}, NULL, SPAR_DYNAMIC | SPAR_VARNUM},
 };
\end{DoxyCode}


\-The first value gives the name of the parameter. \-The first parameter can have a \-N\-U\-L\-L name, which means that the value should immediately follow the method name. \-This can be used to specify methods of the type 'within 5 of ...'.

\-The second value specifies the type of the value that the parameter accepts. \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8}{\-N\-O\-\_\-\-V\-A\-L\-U\-E} can be used to specify a boolean parameter, other possibilities are the same as for the selection method type.

\-The third value gives the number of values that the parameter accepts. \-For boolean parameters (\hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8}{\-N\-O\-\_\-\-V\-A\-L\-U\-E}), it should be 0. \-For parameters with \hyperlink{share_2template_2gromacs_2selparam_8h_a400330277d7e17cdfef1610cc37838ea}{\-S\-P\-A\-R\-\_\-\-V\-A\-R\-N\-U\-M} of \hyperlink{share_2template_2gromacs_2selparam_8h_ababaf52ada40922bb660a4949e1e52f0}{\-S\-P\-A\-R\-\_\-\-A\-T\-O\-M\-V\-A\-L}, it should be set to -\/1 for consistency (it is not used). \-If \hyperlink{share_2template_2gromacs_2selparam_8h_ab39fef32ca729815df1299fafdd623b1}{\-S\-P\-A\-R\-\_\-\-R\-A\-N\-G\-E\-S} is specified, it should be either 1 (to accept a single continuous range) or -\/1 (if combined with \hyperlink{share_2template_2gromacs_2selparam_8h_a400330277d7e17cdfef1610cc37838ea}{\-S\-P\-A\-R\-\_\-\-V\-A\-R\-N\-U\-M}). \-In all other cases, it should be a positive integer; in most cases, it should be 1.

\-The nest two pointers should always be \-N\-U\-L\-L (they should be initialized in the callbacks), except the first pointer in the case of \hyperlink{share_2template_2gromacs_2selparam_8h_a9cab7952c47c82291754bb1b90db31e7}{\-S\-P\-A\-R\-\_\-\-E\-N\-U\-M\-V\-A\-L} (see below).

\-The final value gives additional information about the acceptable values for the parameter using a combination of flags. \-The possible flags are\-:
\begin{DoxyItemize}
\item \hyperlink{share_2template_2gromacs_2selparam_8h_a9829627bea1b9a81fe204f333a6519b6}{\-S\-P\-A\-R\-\_\-\-O\-P\-T\-I\-O\-N\-A\-L} \-: \-If set, the user does not need to provide a value for the parameter. \-If not set, an error is reported if the parameter is not specified by the user.
\item \hyperlink{share_2template_2gromacs_2selparam_8h_ae44a94b4d013d2a344cfb3a9f8c5479f}{\-S\-P\-A\-R\-\_\-\-D\-Y\-N\-A\-M\-I\-C} \-: \-If set, the method can handle dynamic values for the parameter, i.\-e., the value(s) can be given by an expression that evaluates to different values for different frames.
\item \hyperlink{share_2template_2gromacs_2selparam_8h_ab39fef32ca729815df1299fafdd623b1}{\-S\-P\-A\-R\-\_\-\-R\-A\-N\-G\-E\-S} \-: \-Can be set only for \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8becacd1ce0b084595a6072a57781dc7738a0}{\-I\-N\-T\-\_\-\-V\-A\-L\-U\-E} and \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca7aa9587044cd6fd9c1f1690719a072cf}{\-R\-E\-A\-L\-\_\-\-V\-A\-L\-U\-E} parameters, and cannot be combined with \hyperlink{share_2template_2gromacs_2selparam_8h_ae44a94b4d013d2a344cfb3a9f8c5479f}{\-S\-P\-A\-R\-\_\-\-D\-Y\-N\-A\-M\-I\-C}. \-If set, the parameter accepts ranges of values. \-The ranges are automatically sorted and compacted such that a minimum amount of non-\/overlapping ranges are given for the method.
\item \hyperlink{share_2template_2gromacs_2selparam_8h_a400330277d7e17cdfef1610cc37838ea}{\-S\-P\-A\-R\-\_\-\-V\-A\-R\-N\-U\-M} \-: \-If set, the parameter can have a variable number of values. \-These can be provided by the user as a list of values, or using a single \hyperlink{share_2template_2gromacs_2selmethod_8h_ae0aa6a1bbb99ba5f0f6228c4cd401e0a}{\-S\-M\-E\-T\-H\-\_\-\-V\-A\-R\-N\-U\-M\-V\-A\-L} (or a single \hyperlink{share_2template_2gromacs_2selmethod_8h_a2de9fc1fca93570388059f72b064df08}{\-S\-M\-E\-T\-H\-\_\-\-S\-I\-N\-G\-L\-E\-V\-A\-L}) method.
\item \hyperlink{share_2template_2gromacs_2selparam_8h_ababaf52ada40922bb660a4949e1e52f0}{\-S\-P\-A\-R\-\_\-\-A\-T\-O\-M\-V\-A\-L} \-: \-If set, the parameter accepts either a single value or an expression that evaluates to a value for each input atom. \-The single input value is treated as if the same value was returned for each atom. \-Cannot be combined with \hyperlink{share_2template_2gromacs_2selparam_8h_ab39fef32ca729815df1299fafdd623b1}{\-S\-P\-A\-R\-\_\-\-R\-A\-N\-G\-E\-S} or \hyperlink{share_2template_2gromacs_2selparam_8h_a400330277d7e17cdfef1610cc37838ea}{\-S\-P\-A\-R\-\_\-\-V\-A\-R\-N\-U\-M}.
\item \hyperlink{share_2template_2gromacs_2selparam_8h_a9cab7952c47c82291754bb1b90db31e7}{\-S\-P\-A\-R\-\_\-\-E\-N\-U\-M\-V\-A\-L} \-: \-Can only be set for \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca6f2f1fe9592d96990c9ac690c355bd08}{\-S\-T\-R\-\_\-\-V\-A\-L\-U\-E} parameters that take a single value, and cannot be combined with any other flag than \hyperlink{share_2template_2gromacs_2selparam_8h_a9829627bea1b9a81fe204f333a6519b6}{\-S\-P\-A\-R\-\_\-\-O\-P\-T\-I\-O\-N\-A\-L}. \-If set, the parameter only accepts one of predefined string values. \-See \hyperlink{share_2template_2gromacs_2selparam_8h_a9cab7952c47c82291754bb1b90db31e7}{\-S\-P\-A\-R\-\_\-\-E\-N\-U\-M\-V\-A\-L} documentation for details on how to specify the acceptable values.
\end{DoxyItemize}\hypertarget{selmethods_selmethods_callbacks}{}\subsection{\-Implementing callbacks}\label{selmethods_selmethods_callbacks}
\-There are eight differen callback functions that can be implemented for selection methods\-: \hyperlink{include_2selmethod_8h_a5acbf2d7bead71c4d96f9e69b267df56}{sel\-\_\-datafunc()}, \hyperlink{include_2selmethod_8h_a2b41f82c4d493740c63d148eff2129b8}{sel\-\_\-posfunc()}, \hyperlink{include_2selmethod_8h_a112e5ec6891c5963a59384cf41f0cc89}{sel\-\_\-initfunc()}, \hyperlink{include_2selmethod_8h_a682279959b047d5bf8a540b00196332b}{sel\-\_\-outinitfunc()}, \hyperlink{include_2selmethod_8h_a2e05a0b2274edfeab965c363f646735a}{sel\-\_\-freefunc()}, \hyperlink{include_2selmethod_8h_a62eee18354ffce940f10c7dd9ff1c34b}{sel\-\_\-framefunc()}, and two update functions. \-They are in this order in the {\ttfamily \hyperlink{structgmx__ana__selmethod__t}{gmx\-\_\-ana\-\_\-selmethod\-\_\-t}} data structure. \-In general, any of the callbacks can be \-N\-U\-L\-L, but the presence of parameters or other callbacks imposes some restrictions\-:
\begin{DoxyItemize}
\item \hyperlink{include_2selmethod_8h_a5acbf2d7bead71c4d96f9e69b267df56}{sel\-\_\-datafunc()} should be provided if the method takes parameters.
\item \hyperlink{include_2selmethod_8h_a112e5ec6891c5963a59384cf41f0cc89}{sel\-\_\-initfunc()} should be provided if the method takes any parameters with the \hyperlink{share_2template_2gromacs_2selparam_8h_a400330277d7e17cdfef1610cc37838ea}{\-S\-P\-A\-R\-\_\-\-V\-A\-R\-N\-U\-M} or \hyperlink{share_2template_2gromacs_2selparam_8h_ababaf52ada40922bb660a4949e1e52f0}{\-S\-P\-A\-R\-\_\-\-A\-T\-O\-M\-V\-A\-L} flags, except if those parameters have a \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec}{\-P\-O\-S\-\_\-\-V\-A\-L\-U\-E}.
\item \hyperlink{include_2selmethod_8h_a682279959b047d5bf8a540b00196332b}{sel\-\_\-outinitfunc()} should be provided for \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec}{\-P\-O\-S\-\_\-\-V\-A\-L\-U\-E} methods and \hyperlink{share_2template_2gromacs_2selmethod_8h_ae0aa6a1bbb99ba5f0f6228c4cd401e0a}{\-S\-M\-E\-T\-H\-\_\-\-V\-A\-R\-N\-U\-M\-V\-A\-L} methods.
\item \hyperlink{include_2selmethod_8h_a2e05a0b2274edfeab965c363f646735a}{sel\-\_\-freefunc()} should be provided if \hyperlink{include_2selmethod_8h_a5acbf2d7bead71c4d96f9e69b267df56}{sel\-\_\-datafunc()} and/or \hyperlink{include_2selmethod_8h_a112e5ec6891c5963a59384cf41f0cc89}{sel\-\_\-initfunc()} allocate any dynamic memory in addition to the data structure itself.
\item \hyperlink{include_2selmethod_8h_a47bfb381e8df48bddd7ca78abff224bf}{sel\-\_\-updatefunc\-\_\-pos()} only makes sense for methods with \hyperlink{share_2template_2gromacs_2selmethod_8h_af38b0eb2b4e305ae83ded06f9b12252e}{\-S\-M\-E\-T\-H\-\_\-\-D\-Y\-N\-A\-M\-I\-C} set.
\item \-At least one update function should be provided unless the method type is \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8}{\-N\-O\-\_\-\-V\-A\-L\-U\-E}.
\end{DoxyItemize}

\-The documentations for the function pointer types provide more information about how the callbacks should be implemented.\hypertarget{selmethods_selmethods_modifiers}{}\subsection{\-Selection modifiers}\label{selmethods_selmethods_modifiers}
\-Selection modifiers are a special kind of selection methods that can be appended to the end of a selection. \-They are specified by adding the \hyperlink{share_2template_2gromacs_2selmethod_8h_aa5b18df47b72690889afd89f5e68694c}{\-S\-M\-E\-T\-H\-\_\-\-M\-O\-D\-I\-F\-I\-E\-R} flag to the {\ttfamily \hyperlink{structgmx__ana__selmethod__t}{gmx\-\_\-ana\-\_\-selmethod\-\_\-t}}. \-They can have two different types\-:
\begin{DoxyItemize}
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec}{\-P\-O\-S\-\_\-\-V\-A\-L\-U\-E} \-: \-These modifiers are given the final positions as an input, and they can make modifications to the selection that are not possible otherwise (e.\-g., permute the atoms). \-The modifier should implement \hyperlink{include_2selmethod_8h_a47bfb381e8df48bddd7ca78abff224bf}{sel\-\_\-updatefunc\-\_\-pos()} and also have one \-N\-U\-L\-L parameter in the beginning of the parameter list that takes \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec}{\-P\-O\-S\-\_\-\-V\-A\-L\-U\-E} and is used to give the input positions.
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8}{\-N\-O\-\_\-\-V\-A\-L\-U\-E} \-: \-These modifiers do not modify the final selection, but can be used to implement per-\/selection options for analysis tools or to control the default behavior of the selection engine (currently, such a framework is not implemented, but should be easy to implement if required).
\end{DoxyItemize}

\-In addition to restricting the type of the method, selection modifiers do not allow the flags \hyperlink{share_2template_2gromacs_2selmethod_8h_a2de9fc1fca93570388059f72b064df08}{\-S\-M\-E\-T\-H\-\_\-\-S\-I\-N\-G\-L\-E\-V\-A\-L} and \hyperlink{share_2template_2gromacs_2selmethod_8h_ae0aa6a1bbb99ba5f0f6228c4cd401e0a}{\-S\-M\-E\-T\-H\-\_\-\-V\-A\-R\-N\-U\-M\-V\-A\-L} (they would not make sense).

\-Parameters and callbacks should be implemented as with normal selection method, but beware that very little of the functionality has been tested.

\begin{DoxyRefDesc}{\-Todo}
\item[\hyperlink{todo__todo000001}{\-Todo}]\-The modifier handling could be made more flexible and more generic; the current implementation does not allow many things which would be possible with slight changes in the internals of the library.\end{DoxyRefDesc}
\hypertarget{selmethods_selmethods_register}{}\subsection{\-Registering the method}\label{selmethods_selmethods_register}
\-After defining the method with {\ttfamily \hyperlink{structgmx__ana__selmethod__t}{gmx\-\_\-ana\-\_\-selmethod\-\_\-t}}, it should be registered with the selection engine. \-In analysis programs, this can be done by calling \hyperlink{include_2selmethod_8h_a820231622b6b4dd57fba7570f705498f}{gmx\-\_\-ana\-\_\-selmethod\-\_\-register()}. \-If adding the method to the library, you should add a pointer to the new method structure into the {\ttfamily smtable\-\_\-def} array (in \hyperlink{selmethod_8c}{selmethod.c}), and it is registered automatically. \-In both cases, \hyperlink{include_2selmethod_8h_a820231622b6b4dd57fba7570f705498f}{gmx\-\_\-ana\-\_\-selmethod\-\_\-register()} does several checks on the structure and reports any errors or inconsistencies it finds.

\-Custom selection methods are defined by creating a new instance of {\ttfamily \hyperlink{structgmx__ana__selmethod__t}{gmx\-\_\-ana\-\_\-selmethod\-\_\-t}} and filling it with the necessary data for handling the selection. \-The structure contains callback pointers that define the actual behavior of the method. \-The following sections discuss how the structure should be filled and how to implement the callbacks.\hypertarget{selmethods_selmethods_define}{}\subsection{$\backslash$c gmx\-\_\-ana\-\_\-selmethod\-\_\-t data structure}\label{selmethods_selmethods_define}
\-An example {\ttfamily \hyperlink{structgmx__ana__selmethod__t}{gmx\-\_\-ana\-\_\-selmethod\-\_\-t}} definition could look like this\-:


\begin{DoxyCode}
 gmx_ana_selmethod_t sm_example = {
   "example", GROUP_VALUE, 0,
   asize(sm_params_example), sm_params_example,
   &init_data_example,
    NULL,
   &init_example,
    NULL,
   &free_data_example,
   &init_frame_example,
   &evaluate_example,
    NULL,
   {"example from POS_EXPR [cutoff REAL]", 0, NULL},
 };
\end{DoxyCode}


\-The first value defines the name of the method. \-It is used mostly for informational purposes; the actual name(s) recognized by the selection parser are defined by the call to \hyperlink{include_2selmethod_8h_a820231622b6b4dd57fba7570f705498f}{gmx\-\_\-ana\-\_\-selmethod\-\_\-register()} (see \hyperlink{selmethods_selmethods_register}{\-Registering the method}).

\-The second value defines the type of the value the method returns. \-Possible values are
\begin{DoxyItemize}
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8}{\-N\-O\-\_\-\-V\-A\-L\-U\-E} \-: \-This is allowed only for methods that have the flag \hyperlink{share_2template_2gromacs_2selmethod_8h_aa5b18df47b72690889afd89f5e68694c}{\-S\-M\-E\-T\-H\-\_\-\-M\-O\-D\-I\-F\-I\-E\-R} set (see \hyperlink{selmethods_selmethods_modifiers}{\-Selection modifiers}).
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8becacd1ce0b084595a6072a57781dc7738a0}{\-I\-N\-T\-\_\-\-V\-A\-L\-U\-E} \-: \-The method returns one or more integer values.
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca7aa9587044cd6fd9c1f1690719a072cf}{\-R\-E\-A\-L\-\_\-\-V\-A\-L\-U\-E} \-: \-The method returns one or more floating-\/point values.
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca6f2f1fe9592d96990c9ac690c355bd08}{\-S\-T\-R\-\_\-\-V\-A\-L\-U\-E} \-: \-The method returns one or more strings.
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec}{\-P\-O\-S\-\_\-\-V\-A\-L\-U\-E} \-: \-The method returns one or more 3\-D vectors.
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6}{\-G\-R\-O\-U\-P\-\_\-\-V\-A\-L\-U\-E} \-: \-The method returns a single index group.
\end{DoxyItemize}

\-The third value gives additional information about the method using a combination of flags. \-Possible flags are\-:
\begin{DoxyItemize}
\item \hyperlink{share_2template_2gromacs_2selmethod_8h_ac5e632efef31120c54b55eac79cb23cc}{\-S\-M\-E\-T\-H\-\_\-\-R\-E\-Q\-T\-O\-P} \-: \-If set, the topology information is always loaded and the {\ttfamily top} pointer passed to the callbacks is guaranteed to be non-\/\-N\-U\-L\-L. \-Should be set if the method requires topology information for evaluation.
\item \hyperlink{share_2template_2gromacs_2selmethod_8h_af38b0eb2b4e305ae83ded06f9b12252e}{\-S\-M\-E\-T\-H\-\_\-\-D\-Y\-N\-A\-M\-I\-C} \-: \-If set, the method can only be evaluated dynamically, i.\-e., it requires data from the trajectory frame.
\item \hyperlink{share_2template_2gromacs_2selmethod_8h_aa5b18df47b72690889afd89f5e68694c}{\-S\-M\-E\-T\-H\-\_\-\-M\-O\-D\-I\-F\-I\-E\-R} \-: \-If set, the method is a selection modifier and not an actual selection method. \-For more details, see \hyperlink{selmethods_selmethods_modifiers}{\-Selection modifiers}.
\end{DoxyItemize}

\-There are two additional flags that specify the number of values the method returns. \-Only one of them can be set at a time. \-If neither is set, the default behavior is to evaluate a value for each input atom (except for \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6}{\-G\-R\-O\-U\-P\-\_\-\-V\-A\-L\-U\-E} methods, which always return a single group). \-Other behaviors can be specified with these flags\-:
\begin{DoxyItemize}
\item \hyperlink{share_2template_2gromacs_2selmethod_8h_a2de9fc1fca93570388059f72b064df08}{\-S\-M\-E\-T\-H\-\_\-\-S\-I\-N\-G\-L\-E\-V\-A\-L} \-: \-If set, the method evaluates to a single value. \-This is automatically set if the type is \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6}{\-G\-R\-O\-U\-P\-\_\-\-V\-A\-L\-U\-E}.
\item \hyperlink{share_2template_2gromacs_2selmethod_8h_ae0aa6a1bbb99ba5f0f6228c4cd401e0a}{\-S\-M\-E\-T\-H\-\_\-\-V\-A\-R\-N\-U\-M\-V\-A\-L} \-: \-If set, the method evaluates to an arbitrary number of values. \-The number of values is determined based on the values given by the user to the method parameters (see \hyperlink{selmethods_selmethods_params}{\-Defining parameters}).
\end{DoxyItemize}\-If either of these flags is specified (and the method type is not \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6}{\-G\-R\-O\-U\-P\-\_\-\-V\-A\-L\-U\-E}), the group passed to the evaluation callback should not be used as it can be \-N\-U\-L\-L. \-Currently, the above flags only work (have been tested) for \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec}{\-P\-O\-S\-\_\-\-V\-A\-L\-U\-E} methods.

\-There is one additional flag that can only be specified for \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca6f2f1fe9592d96990c9ac690c355bd08}{\-S\-T\-R\-\_\-\-V\-A\-L\-U\-E} methods\-: \hyperlink{share_2template_2gromacs_2selmethod_8h_a78abdcb637f45eafa513d07aaf14a45e}{\-S\-M\-E\-T\-H\-\_\-\-C\-H\-A\-R\-V\-A\-L} . \-It is meant for to ease implementation of methods that evaluate to strings consisting of single characters.

\-The next two values determine the number of parameters and a pointer to the parameter array. \-The contents of the parameter array are described in \hyperlink{selmethods_selmethods_params}{\-Defining parameters}. \-If the method does not take parameters, the first value should be 0 and the second can be \-N\-U\-L\-L. \-Currently, \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca6f2f1fe9592d96990c9ac690c355bd08}{\-S\-T\-R\-\_\-\-V\-A\-L\-U\-E} methods cannot take parameters, but this limitation should be easy to lift if required.

\-These are followed by function callbacks that determine the actual behavior of the method. \-Any of these except the evaluation callback can be \-N\-U\-L\-L (the evaluation callback can also be \-N\-U\-L\-L if \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8}{\-N\-O\-\_\-\-V\-A\-L\-U\-E} is specified for a selection modifier). \-However, the presence of parameters can require some of the callbacks to be implemented. \-The details are described in \hyperlink{selmethods_selmethods_callbacks}{\-Implementing callbacks}.

\-Finally, there is a data structure that gives help texts for the method.

\-The {\ttfamily \hyperlink{structgmx__ana__selmethod__t}{gmx\-\_\-ana\-\_\-selmethod\-\_\-t}} variable should be declared as a global variable or it should be otherwise ensured that the structure is not freed\-: only a pointer to the structure is stored by the library.\hypertarget{selmethods_selmethods_params}{}\subsection{\-Defining parameters}\label{selmethods_selmethods_params}
\-Parameters to selection methods are defined in a separate array of {\ttfamily \hyperlink{structgmx__ana__selparam__t}{gmx\-\_\-ana\-\_\-selparam\-\_\-t}} structures. \-The order of the parameters does not matter (except possibly for callback implementation), with one important exception\-: \-If the method evaluates to a \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec}{\-P\-O\-S\-\_\-\-V\-A\-L\-U\-E}, the first parameter should have \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6}{\-G\-R\-O\-U\-P\-\_\-\-V\-A\-L\-U\-E} and be the one that is used to calculate the positions.

\-An example parameter definition\-: 
\begin{DoxyCode}
 static gmx_ana_selparam_t sm_params_example[] = {
   {"cutoff", {REAL_VALUE, 1, {NULL}}, NULL, SPAR_OPTIONAL},
   {"from",   {POS_VALUE, -1, {NULL}}, NULL, SPAR_DYNAMIC | SPAR_VARNUM},
 };
\end{DoxyCode}


\-The first value gives the name of the parameter. \-The first parameter can have a \-N\-U\-L\-L name, which means that the value should immediately follow the method name. \-This can be used to specify methods of the type 'within 5 of ...'.

\-The second value specifies the type of the value that the parameter accepts. \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8}{\-N\-O\-\_\-\-V\-A\-L\-U\-E} can be used to specify a boolean parameter, other possibilities are the same as for the selection method type.

\-The third value gives the number of values that the parameter accepts. \-For boolean parameters (\hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8}{\-N\-O\-\_\-\-V\-A\-L\-U\-E}), it should be 0. \-For parameters with \hyperlink{share_2template_2gromacs_2selparam_8h_a400330277d7e17cdfef1610cc37838ea}{\-S\-P\-A\-R\-\_\-\-V\-A\-R\-N\-U\-M} of \hyperlink{share_2template_2gromacs_2selparam_8h_ababaf52ada40922bb660a4949e1e52f0}{\-S\-P\-A\-R\-\_\-\-A\-T\-O\-M\-V\-A\-L}, it should be set to -\/1 for consistency (it is not used). \-If \hyperlink{share_2template_2gromacs_2selparam_8h_ab39fef32ca729815df1299fafdd623b1}{\-S\-P\-A\-R\-\_\-\-R\-A\-N\-G\-E\-S} is specified, it should be either 1 (to accept a single continuous range) or -\/1 (if combined with \hyperlink{share_2template_2gromacs_2selparam_8h_a400330277d7e17cdfef1610cc37838ea}{\-S\-P\-A\-R\-\_\-\-V\-A\-R\-N\-U\-M}). \-In all other cases, it should be a positive integer; in most cases, it should be 1.

\-The nest two pointers should always be \-N\-U\-L\-L (they should be initialized in the callbacks), except the first pointer in the case of \hyperlink{share_2template_2gromacs_2selparam_8h_a9cab7952c47c82291754bb1b90db31e7}{\-S\-P\-A\-R\-\_\-\-E\-N\-U\-M\-V\-A\-L} (see below).

\-The final value gives additional information about the acceptable values for the parameter using a combination of flags. \-The possible flags are\-:
\begin{DoxyItemize}
\item \hyperlink{share_2template_2gromacs_2selparam_8h_a9829627bea1b9a81fe204f333a6519b6}{\-S\-P\-A\-R\-\_\-\-O\-P\-T\-I\-O\-N\-A\-L} \-: \-If set, the user does not need to provide a value for the parameter. \-If not set, an error is reported if the parameter is not specified by the user.
\item \hyperlink{share_2template_2gromacs_2selparam_8h_ae44a94b4d013d2a344cfb3a9f8c5479f}{\-S\-P\-A\-R\-\_\-\-D\-Y\-N\-A\-M\-I\-C} \-: \-If set, the method can handle dynamic values for the parameter, i.\-e., the value(s) can be given by an expression that evaluates to different values for different frames.
\item \hyperlink{share_2template_2gromacs_2selparam_8h_ab39fef32ca729815df1299fafdd623b1}{\-S\-P\-A\-R\-\_\-\-R\-A\-N\-G\-E\-S} \-: \-Can be set only for \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8becacd1ce0b084595a6072a57781dc7738a0}{\-I\-N\-T\-\_\-\-V\-A\-L\-U\-E} and \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca7aa9587044cd6fd9c1f1690719a072cf}{\-R\-E\-A\-L\-\_\-\-V\-A\-L\-U\-E} parameters, and cannot be combined with \hyperlink{share_2template_2gromacs_2selparam_8h_ae44a94b4d013d2a344cfb3a9f8c5479f}{\-S\-P\-A\-R\-\_\-\-D\-Y\-N\-A\-M\-I\-C}. \-If set, the parameter accepts ranges of values. \-The ranges are automatically sorted and compacted such that a minimum amount of non-\/overlapping ranges are given for the method.
\item \hyperlink{share_2template_2gromacs_2selparam_8h_a400330277d7e17cdfef1610cc37838ea}{\-S\-P\-A\-R\-\_\-\-V\-A\-R\-N\-U\-M} \-: \-If set, the parameter can have a variable number of values. \-These can be provided by the user as a list of values, or using a single \hyperlink{share_2template_2gromacs_2selmethod_8h_ae0aa6a1bbb99ba5f0f6228c4cd401e0a}{\-S\-M\-E\-T\-H\-\_\-\-V\-A\-R\-N\-U\-M\-V\-A\-L} (or a single \hyperlink{share_2template_2gromacs_2selmethod_8h_a2de9fc1fca93570388059f72b064df08}{\-S\-M\-E\-T\-H\-\_\-\-S\-I\-N\-G\-L\-E\-V\-A\-L}) method.
\item \hyperlink{share_2template_2gromacs_2selparam_8h_ababaf52ada40922bb660a4949e1e52f0}{\-S\-P\-A\-R\-\_\-\-A\-T\-O\-M\-V\-A\-L} \-: \-If set, the parameter accepts either a single value or an expression that evaluates to a value for each input atom. \-The single input value is treated as if the same value was returned for each atom. \-Cannot be combined with \hyperlink{share_2template_2gromacs_2selparam_8h_ab39fef32ca729815df1299fafdd623b1}{\-S\-P\-A\-R\-\_\-\-R\-A\-N\-G\-E\-S} or \hyperlink{share_2template_2gromacs_2selparam_8h_a400330277d7e17cdfef1610cc37838ea}{\-S\-P\-A\-R\-\_\-\-V\-A\-R\-N\-U\-M}.
\item \hyperlink{share_2template_2gromacs_2selparam_8h_a9cab7952c47c82291754bb1b90db31e7}{\-S\-P\-A\-R\-\_\-\-E\-N\-U\-M\-V\-A\-L} \-: \-Can only be set for \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca6f2f1fe9592d96990c9ac690c355bd08}{\-S\-T\-R\-\_\-\-V\-A\-L\-U\-E} parameters that take a single value, and cannot be combined with any other flag than \hyperlink{share_2template_2gromacs_2selparam_8h_a9829627bea1b9a81fe204f333a6519b6}{\-S\-P\-A\-R\-\_\-\-O\-P\-T\-I\-O\-N\-A\-L}. \-If set, the parameter only accepts one of predefined string values. \-See \hyperlink{share_2template_2gromacs_2selparam_8h_a9cab7952c47c82291754bb1b90db31e7}{\-S\-P\-A\-R\-\_\-\-E\-N\-U\-M\-V\-A\-L} documentation for details on how to specify the acceptable values.
\end{DoxyItemize}\hypertarget{selmethods_selmethods_callbacks}{}\subsection{\-Implementing callbacks}\label{selmethods_selmethods_callbacks}
\-There are eight differen callback functions that can be implemented for selection methods\-: \hyperlink{include_2selmethod_8h_a5acbf2d7bead71c4d96f9e69b267df56}{sel\-\_\-datafunc()}, \hyperlink{include_2selmethod_8h_a2b41f82c4d493740c63d148eff2129b8}{sel\-\_\-posfunc()}, \hyperlink{include_2selmethod_8h_a112e5ec6891c5963a59384cf41f0cc89}{sel\-\_\-initfunc()}, \hyperlink{include_2selmethod_8h_a682279959b047d5bf8a540b00196332b}{sel\-\_\-outinitfunc()}, \hyperlink{include_2selmethod_8h_a2e05a0b2274edfeab965c363f646735a}{sel\-\_\-freefunc()}, \hyperlink{include_2selmethod_8h_a62eee18354ffce940f10c7dd9ff1c34b}{sel\-\_\-framefunc()}, and two update functions. \-They are in this order in the {\ttfamily \hyperlink{structgmx__ana__selmethod__t}{gmx\-\_\-ana\-\_\-selmethod\-\_\-t}} data structure. \-In general, any of the callbacks can be \-N\-U\-L\-L, but the presence of parameters or other callbacks imposes some restrictions\-:
\begin{DoxyItemize}
\item \hyperlink{include_2selmethod_8h_a5acbf2d7bead71c4d96f9e69b267df56}{sel\-\_\-datafunc()} should be provided if the method takes parameters.
\item \hyperlink{include_2selmethod_8h_a112e5ec6891c5963a59384cf41f0cc89}{sel\-\_\-initfunc()} should be provided if the method takes any parameters with the \hyperlink{share_2template_2gromacs_2selparam_8h_a400330277d7e17cdfef1610cc37838ea}{\-S\-P\-A\-R\-\_\-\-V\-A\-R\-N\-U\-M} or \hyperlink{share_2template_2gromacs_2selparam_8h_ababaf52ada40922bb660a4949e1e52f0}{\-S\-P\-A\-R\-\_\-\-A\-T\-O\-M\-V\-A\-L} flags, except if those parameters have a \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec}{\-P\-O\-S\-\_\-\-V\-A\-L\-U\-E}.
\item \hyperlink{include_2selmethod_8h_a682279959b047d5bf8a540b00196332b}{sel\-\_\-outinitfunc()} should be provided for \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec}{\-P\-O\-S\-\_\-\-V\-A\-L\-U\-E} methods and \hyperlink{share_2template_2gromacs_2selmethod_8h_ae0aa6a1bbb99ba5f0f6228c4cd401e0a}{\-S\-M\-E\-T\-H\-\_\-\-V\-A\-R\-N\-U\-M\-V\-A\-L} methods.
\item \hyperlink{include_2selmethod_8h_a2e05a0b2274edfeab965c363f646735a}{sel\-\_\-freefunc()} should be provided if \hyperlink{include_2selmethod_8h_a5acbf2d7bead71c4d96f9e69b267df56}{sel\-\_\-datafunc()} and/or \hyperlink{include_2selmethod_8h_a112e5ec6891c5963a59384cf41f0cc89}{sel\-\_\-initfunc()} allocate any dynamic memory in addition to the data structure itself.
\item \hyperlink{include_2selmethod_8h_a47bfb381e8df48bddd7ca78abff224bf}{sel\-\_\-updatefunc\-\_\-pos()} only makes sense for methods with \hyperlink{share_2template_2gromacs_2selmethod_8h_af38b0eb2b4e305ae83ded06f9b12252e}{\-S\-M\-E\-T\-H\-\_\-\-D\-Y\-N\-A\-M\-I\-C} set.
\item \-At least one update function should be provided unless the method type is \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8}{\-N\-O\-\_\-\-V\-A\-L\-U\-E}.
\end{DoxyItemize}

\-The documentations for the function pointer types provide more information about how the callbacks should be implemented.\hypertarget{selmethods_selmethods_modifiers}{}\subsection{\-Selection modifiers}\label{selmethods_selmethods_modifiers}
\-Selection modifiers are a special kind of selection methods that can be appended to the end of a selection. \-They are specified by adding the \hyperlink{share_2template_2gromacs_2selmethod_8h_aa5b18df47b72690889afd89f5e68694c}{\-S\-M\-E\-T\-H\-\_\-\-M\-O\-D\-I\-F\-I\-E\-R} flag to the {\ttfamily \hyperlink{structgmx__ana__selmethod__t}{gmx\-\_\-ana\-\_\-selmethod\-\_\-t}}. \-They can have two different types\-:
\begin{DoxyItemize}
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec}{\-P\-O\-S\-\_\-\-V\-A\-L\-U\-E} \-: \-These modifiers are given the final positions as an input, and they can make modifications to the selection that are not possible otherwise (e.\-g., permute the atoms). \-The modifier should implement \hyperlink{include_2selmethod_8h_a47bfb381e8df48bddd7ca78abff224bf}{sel\-\_\-updatefunc\-\_\-pos()} and also have one \-N\-U\-L\-L parameter in the beginning of the parameter list that takes \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec}{\-P\-O\-S\-\_\-\-V\-A\-L\-U\-E} and is used to give the input positions.
\item \hyperlink{share_2template_2gromacs_2selvalue_8h_a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8}{\-N\-O\-\_\-\-V\-A\-L\-U\-E} \-: \-These modifiers do not modify the final selection, but can be used to implement per-\/selection options for analysis tools or to control the default behavior of the selection engine (currently, such a framework is not implemented, but should be easy to implement if required).
\end{DoxyItemize}

\-In addition to restricting the type of the method, selection modifiers do not allow the flags \hyperlink{share_2template_2gromacs_2selmethod_8h_a2de9fc1fca93570388059f72b064df08}{\-S\-M\-E\-T\-H\-\_\-\-S\-I\-N\-G\-L\-E\-V\-A\-L} and \hyperlink{share_2template_2gromacs_2selmethod_8h_ae0aa6a1bbb99ba5f0f6228c4cd401e0a}{\-S\-M\-E\-T\-H\-\_\-\-V\-A\-R\-N\-U\-M\-V\-A\-L} (they would not make sense).

\-Parameters and callbacks should be implemented as with normal selection method, but beware that very little of the functionality has been tested.

\begin{DoxyRefDesc}{\-Todo}
\item[\hyperlink{todo__todo000003}{\-Todo}]\-The modifier handling could be made more flexible and more generic; the current implementation does not allow many things which would be possible with slight changes in the internals of the library.\end{DoxyRefDesc}
\hypertarget{selmethods_selmethods_register}{}\subsection{\-Registering the method}\label{selmethods_selmethods_register}
\-After defining the method with {\ttfamily \hyperlink{structgmx__ana__selmethod__t}{gmx\-\_\-ana\-\_\-selmethod\-\_\-t}}, it should be registered with the selection engine. \-In analysis programs, this can be done by calling \hyperlink{include_2selmethod_8h_a820231622b6b4dd57fba7570f705498f}{gmx\-\_\-ana\-\_\-selmethod\-\_\-register()}. \-If adding the method to the library, you should add a pointer to the new method structure into the {\ttfamily smtable\-\_\-def} array (in \hyperlink{selmethod_8c}{selmethod.c}), and it is registered automatically. \-In both cases, \hyperlink{include_2selmethod_8h_a820231622b6b4dd57fba7570f705498f}{gmx\-\_\-ana\-\_\-selmethod\-\_\-register()} does several checks on the structure and reports any errors or inconsistencies it finds. \hypertarget{nbsearch}{}\section{\-Neighborhood search routines}\label{nbsearch}
\-Functions to find particles within a neighborhood of a set of particles are defined in nbsearch.\-h. \-The usage is simple\-: a data structure is allocated with \hyperlink{include_2nbsearch_8h_a8f3c442d0b5cc3f0cf00d0178fe86b69}{gmx\-\_\-ana\-\_\-nbsearch\-\_\-create()}, and the box shape and reference positions for a frame are set using \hyperlink{include_2nbsearch_8h_adb93d439fb66a65304f545892dc85685}{gmx\-\_\-ana\-\_\-nbsearch\-\_\-init()} or \hyperlink{include_2nbsearch_8h_a692b6fd5e07c1417b5249a6502100867}{gmx\-\_\-ana\-\_\-nbsearch\-\_\-pos\-\_\-init()}. \-Searches can then be performed with \hyperlink{include_2nbsearch_8h_a13e06dbe851ea6d7c0903360ffaf569f}{gmx\-\_\-ana\-\_\-nbsearch\-\_\-is\-\_\-within()} and \hyperlink{include_2nbsearch_8h_a49c541545147457df662c3c3d33718b2}{gmx\-\_\-ana\-\_\-nbsearch\-\_\-mindist()}, or with versions that take the {\ttfamily \hyperlink{structgmx__ana__pos__t}{gmx\-\_\-ana\-\_\-pos\-\_\-t}} data structure. \-When the data structure is no longer required, it can be freed with \hyperlink{include_2nbsearch_8h_a5281d4ee13a86c089b9911b722f3f512}{gmx\-\_\-ana\-\_\-nbsearch\-\_\-free()}. \hypertarget{displacements}{}\section{\-Displacement calculation routines}\label{displacements}
\-Functions to calculate particle displacements as a function of time are defined in displacement.\-h. \-These functions allow one to easily calculate the displacement during a single pass over the trajectory. \-A new calculation is initialized with \hyperlink{include_2displacement_8h_a246b6e5b5ce780fd88210f0e0f6410eb}{gmx\-\_\-ana\-\_\-displ\-\_\-create()}. \-For each frame, \hyperlink{include_2displacement_8h_a4fbbe00acaff0a0a7b3d4593bf708b96}{gmx\-\_\-ana\-\_\-displ\-\_\-start\-\_\-frame()} needs to be called, followed by a series of \hyperlink{include_2displacement_8h_a1249df9ac34685bd9609e1944bccb14a}{gmx\-\_\-ana\-\_\-displ\-\_\-store()} or a single call to \hyperlink{include_2displacement_8h_a23227f37b703ca5d00cdaa2af678e728}{gmx\-\_\-ana\-\_\-displ\-\_\-store\-\_\-array()}, \hyperlink{include_2displacement_8h_acd4c27a82da37705cbecc5400b5001ad}{gmx\-\_\-ana\-\_\-displ\-\_\-store\-\_\-all()} or \hyperlink{include_2displacement_8h_ab79079085cbe4605fc2c5ea9754a91e5}{gmx\-\_\-ana\-\_\-displ\-\_\-store\-\_\-pos()}. \-The displacements for the current frame can then be calculated with \hyperlink{include_2displacement_8h_ad2b5a136e9e87e0976ae558bff6fa0a9}{gmx\-\_\-ana\-\_\-displ\-\_\-vector()}, \hyperlink{include_2displacement_8h_a07581fadc4db16ad790533b67c7ed7a5}{gmx\-\_\-ana\-\_\-displ\-\_\-vectors()} and/or \hyperlink{include_2displacement_8h_af99ad13734798104a87fbdd44de8627e}{gmx\-\_\-ana\-\_\-displ\-\_\-vectors\-\_\-all()}. \-These calculate the displacements from old positions to the ones on the current frame. \-The input frames should be evenly spaced, otherwise a fatal error is reported. \-A time interval can be converted to a number of steps for the calculation functions using \hyperlink{include_2displacement_8h_a87f1257d1fff4526bfc989d1dbfd177a}{gmx\-\_\-ana\-\_\-displ\-\_\-time\-\_\-to\-\_\-steps()}. \-When the structure is no longer required, \hyperlink{include_2displacement_8h_a1c6c8a635f8e4918789917d790958f77}{gmx\-\_\-ana\-\_\-displ\-\_\-free()} can be used to free the memory.

\-The functions support calculation for dynamic selections\-: when storing the positions, it is possible to specify whether a particle is present or not. \-This data is then accessible in the {\ttfamily pout} array returned by the calculation functions. \-Note that if you only call \hyperlink{include_2displacement_8h_a1249df9ac34685bd9609e1944bccb14a}{gmx\-\_\-ana\-\_\-displ\-\_\-store()} for the particles that are present, use \hyperlink{include_2displacement_8h_a23227f37b703ca5d00cdaa2af678e728}{gmx\-\_\-ana\-\_\-displ\-\_\-store\-\_\-array()}, or use positions calculated without \hyperlink{share_2template_2gromacs_2poscalc_8h_a3586daeaab8b4ff970ae759b3677e7fd}{\-P\-O\-S\-\_\-\-M\-A\-S\-K\-O\-N\-L\-Y} for \hyperlink{include_2displacement_8h_ab79079085cbe4605fc2c5ea9754a91e5}{gmx\-\_\-ana\-\_\-displ\-\_\-store\-\_\-pos()}, you should ensure that you do not use the displacements for which {\ttfamily pout} is \-F\-A\-L\-S\-E (the values cannot be calculated based on the provided data, and are undefined). \hypertarget{histograms}{}\section{\-Histogram calculation}\label{histograms}
\-Functions to calculate histograms are defined in histogram.\-h. \-The principle is simple\-: histogram calculation is set up with \hyperlink{include_2histogram_8h_ab40d6fd1d54b3204f5daf564bf1d8dc3}{gmx\-\_\-histogram\-\_\-create()} and gmx\-\_\-histogram\-\_\-set\-\_\-$\ast$(), the histogram is sampled using the provided functions, and \hyperlink{include_2histogram_8h_a914cda7c09870610bcb3a83ac52cc709}{gmx\-\_\-histogram\-\_\-finish()} is called to finish the sampling. \-Various post-\/processing functions can then be used to normalize the histogram in various ways and to write it into a file. gmx\-\_\-histogram\-\_\-get\-\_\-$\ast$() can be used to access data from the histogram. \hyperlink{include_2histogram_8h_a705814e555fa1ccb2a297903bc47a0f3}{gmx\-\_\-histogram\-\_\-free()} can be used to free the memory allocated for a histogram.\hypertarget{histograms_histogram_sampling}{}\subsection{\-Initialization and sampling}\label{histograms_histogram_sampling}
\-A histogram calculation is initialized by calling \hyperlink{include_2histogram_8h_ab40d6fd1d54b3204f5daf564bf1d8dc3}{gmx\-\_\-histogram\-\_\-create()} or \hyperlink{include_2histogram_8h_a4651816f933b571639f58182cec55cc4}{gmx\-\_\-histogram\-\_\-create\-\_\-range()}. \-The first function takes the type of the histogram (see \hyperlink{share_2template_2gromacs_2histogram_8h_ae733abe5734389e4450335504bde8d0c}{e\-\_\-histogram\-\_\-t}) and the number of bins, and allocates the necessary memory. \-The bin locations can be initialized with \hyperlink{include_2histogram_8h_a2613ee595d411e01c5cc67e2ea62d963}{gmx\-\_\-histogram\-\_\-set\-\_\-integerbins()} and one of \hyperlink{include_2histogram_8h_aeedf50e7e41ad43592d9a13f59f5e8e2}{gmx\-\_\-histogram\-\_\-set\-\_\-binwidth()} and \hyperlink{include_2histogram_8h_ab536083f48600485e134db1a810edb5e}{gmx\-\_\-histogram\-\_\-set\-\_\-range()}. \-Only uniformly spaced bins are currently supported. \-The second initialization function takes the beginning and end of the range and the bin width. \-The treatment of values that fall outside the histogram range can be set with \hyperlink{include_2histogram_8h_afadb5475f53de1db1941b233ad58ae1e}{gmx\-\_\-histogram\-\_\-set\-\_\-all()}. \hyperlink{include_2histogram_8h_a4dc6019d346e922fe3b383b7480bb156}{gmx\-\_\-histogram\-\_\-set\-\_\-blocksize()} can be used to specify a block size for error estimates. \-If not called, no error estimates are calculated. \-Otherwise, a histogram is calculated for each block of given number of frames, and the error estimated as the error of the mean of these block histograms. \-If the number of frames is not divisible by the block size, the last block is discarded. \hyperlink{include_2histogram_8h_acf710ff31e487be33a29fe69f9373ff7}{gmx\-\_\-histogram\-\_\-set\-\_\-block\-\_\-output()} can be used to write the individual block histograms to a file (it is currently not very flexible).

\-After initialization, three sets of sampling functions are provided to sample the differen types of histograms\-:
\begin{DoxyItemize}
\item \-Use \hyperlink{include_2histogram_8h_abbbe79464f40f6bd54ac16a9835b2722}{gmx\-\_\-histogram\-\_\-increment()} or \hyperlink{include_2histogram_8h_a457f6c58e1bd221ce1df64166abbfd0a}{gmx\-\_\-histogram\-\_\-increment\-\_\-bin()} to calculate simple histograms (\hyperlink{share_2template_2gromacs_2histogram_8h_ae733abe5734389e4450335504bde8d0ca407ff02856941647f344d41b61ef301f}{\-H\-I\-S\-T\-\_\-\-S\-I\-M\-P\-L\-E} histograms).
\item \-Use \hyperlink{include_2histogram_8h_ab7b820270fa5ac5525bc48c497ec78b5}{gmx\-\_\-histogram\-\_\-add()} or \hyperlink{include_2histogram_8h_a07a59d751592617c279ebbfc5f6da9b2}{gmx\-\_\-histogram\-\_\-add\-\_\-to\-\_\-bin()} to calculate histograms where different points can have different weight (\hyperlink{share_2template_2gromacs_2histogram_8h_ae733abe5734389e4450335504bde8d0ca54f44903504f2d44f5f66fcc28060ac4}{\-H\-I\-S\-T\-\_\-\-W\-E\-I\-G\-H\-T} histograms).
\item \-Use \hyperlink{include_2histogram_8h_a29f91ac2ad05731b7c6077e16dbfbad3}{gmx\-\_\-histogram\-\_\-add\-\_\-item()} or \hyperlink{include_2histogram_8h_a200fb89cb070efb95e2467d6e90cc2e5}{gmx\-\_\-histogram\-\_\-add\-\_\-item\-\_\-to\-\_\-bin()} to calculate averages within each bin (\hyperlink{share_2template_2gromacs_2histogram_8h_ae733abe5734389e4450335504bde8d0ca853ac4534a02fcfb29320cd70f903e2a}{\-H\-I\-S\-T\-\_\-\-B\-I\-N\-A\-V\-E\-R} histograms).
\end{DoxyItemize}

\-The functions aboge that take bin indices directly do no range checking, i.\-e., one must ensure that the bin number is between 0 and the number of bins in the histogram. \-In contrast, the functions that use real values to locate the correct bin use range checking, and silently discard values outside the histogram (unless \hyperlink{include_2histogram_8h_afadb5475f53de1db1941b233ad58ae1e}{gmx\-\_\-histogram\-\_\-set\-\_\-all()} has been called). \hyperlink{include_2histogram_8h_ab537ee679149545eb6d386c6c9cc7376}{gmx\-\_\-histogram\-\_\-find\-\_\-bin()} can be used to find the bin number corresponding to a value, adhering to the \hyperlink{include_2histogram_8h_afadb5475f53de1db1941b233ad58ae1e}{gmx\-\_\-histogram\-\_\-set\-\_\-all()} setting.

\-After a frame is sampled, \hyperlink{include_2histogram_8h_af2e121043fcfe67917ef4abff2c3d1b3}{gmx\-\_\-histogram\-\_\-finish\-\_\-frame()} needs to be called. \-After all data is sampled, \hyperlink{include_2histogram_8h_a914cda7c09870610bcb3a83ac52cc709}{gmx\-\_\-histogram\-\_\-finish()} should be called. \-After these calls, the histogram will be normalized such that the sum over all bins equals the average number of samples per frame, and the error field contains the error of the mean at each bin.\hypertarget{histograms_histogram_processing}{}\subsection{\-Post-\/processing}\label{histograms_histogram_processing}
\-The following functions can be used to process the histograms\-:
\begin{DoxyItemize}
\item \hyperlink{include_2histogram_8h_ac5a1bb4ae8fe959b88bc14fdaa18ceb7}{gmx\-\_\-histogram\-\_\-clone()} makes a deep copy.
\item \hyperlink{include_2histogram_8h_a93a4debed53d9956228209842abfce40}{gmx\-\_\-histogram\-\_\-resample\-\_\-dblbw()} also makes a deep copy, but uses a binwidth that is double of the input one (see below for usage).
\item \hyperlink{include_2histogram_8h_a7f22f213dda945f913b246bb6ab32556}{gmx\-\_\-histogram\-\_\-normalize\-\_\-prob()} normalizes a histogram such that its integral becomes one.
\item \hyperlink{include_2histogram_8h_a28bbd3fc76c889ae19abb003a81bccf2}{gmx\-\_\-histogram\-\_\-scale()} and \hyperlink{include_2histogram_8h_a918cbf6887a3ad0c077d44cbcecf5454}{gmx\-\_\-histogram\-\_\-scale\-\_\-vec()} can be used to scale a histogram uniformly or non-\/uniformly, respectively.
\end{DoxyItemize}

\-There are also functions to write histograms to a file\-:
\begin{DoxyItemize}
\item \hyperlink{include_2histogram_8h_a8afcdc28d6c3e45b4d0dde85f11bdd04}{gmx\-\_\-histogram\-\_\-write()} writes a single histogram, optionally with errors.
\item \hyperlink{include_2histogram_8h_adf8c712ada3fc9147cd90ddd8ea79f28}{gmx\-\_\-histogram\-\_\-write\-\_\-array()} writes multiple histograms with identical bins. \-Values and/or errors can be written.
\item \hyperlink{include_2histogram_8h_a4064bbd1c5338583f652e8f9aee24c14}{gmx\-\_\-histogram\-\_\-write\-\_\-cum\-\_\-array()} writes cumulative histograms for multiple histograms with identical bins.
\end{DoxyItemize}

\hyperlink{include_2histogram_8h_a93a4debed53d9956228209842abfce40}{gmx\-\_\-histogram\-\_\-resample\-\_\-dblbw()} is useful if a histogram and its cumulative sum are required at same points. \-One can then sample the histogram with half the desired binwidth, and then use \hyperlink{include_2histogram_8h_a93a4debed53d9956228209842abfce40}{gmx\-\_\-histogram\-\_\-resample\-\_\-dblbw()} to construct two different versions of the histogram (by changing {\ttfamily b\-Integer\-Bins}), one suitable for writing out the histogram and the other for writing the cumulative distribution.

\-Access to the histogram data is also provided through the following functions\-:
\begin{DoxyItemize}
\item \hyperlink{include_2histogram_8h_af81328f5edef6cd281f884e26845076f}{gmx\-\_\-histogram\-\_\-get\-\_\-nbins()}
\item \hyperlink{include_2histogram_8h_aff30dc93f050ce11d3e7145072b8a4b3}{gmx\-\_\-histogram\-\_\-get\-\_\-binwidth()}
\item \hyperlink{include_2histogram_8h_a928f4b4ec02cc83d6c46cb220f2d2d20}{gmx\-\_\-histogram\-\_\-get\-\_\-value()}
\item \hyperlink{include_2histogram_8h_a7351630f6fb7293a74c35feec7fe3162}{gmx\-\_\-histogram\-\_\-get\-\_\-bin\-\_\-value()}
\item \hyperlink{include_2histogram_8h_a5dd177892fbb17f9897917180d80e285}{gmx\-\_\-histogram\-\_\-get\-\_\-values()}
\item \hyperlink{include_2histogram_8h_a06d2724d56ff3f8a49af6d946844873e}{gmx\-\_\-histogram\-\_\-get\-\_\-errors()}
\end{DoxyItemize}

\hyperlink{include_2histogram_8h_a705814e555fa1ccb2a297903bc47a0f3}{gmx\-\_\-histogram\-\_\-free()} can be used to free memory associated with a histogram when it is no longer needed. 