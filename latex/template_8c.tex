\hypertarget{template_8c}{\section{share/template/template.c \-File \-Reference}
\label{template_8c}\index{share/template/template.\-c@{share/template/template.\-c}}
}


\-Template code for writing analysis programs.  


{\ttfamily \#include $<$gromacs/copyrite.\-h$>$}\*
{\ttfamily \#include $<$gromacs/filenm.\-h$>$}\*
{\ttfamily \#include $<$gromacs/macros.\-h$>$}\*
{\ttfamily \#include $<$gromacs/pbc.\-h$>$}\*
{\ttfamily \#include $<$gromacs/smalloc.\-h$>$}\*
{\ttfamily \#include $<$gromacs/statutil.\-h$>$}\*
{\ttfamily \#include $<$gromacs/xvgr.\-h$>$}\*
{\ttfamily \#include $<$gromacs/gmx\-\_\-fatal.\-h$>$}\*
{\ttfamily \#include $<$gromacs/nbsearch.\-h$>$}\*
{\ttfamily \#include $<$gromacs/trajana.\-h$>$}\*
\-Include dependency graph for template.\-c\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{template_8c__incl}
\end{center}
\end{figure}
\subsection*{\-Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structt__analysisdata}{t\-\_\-analysisdata}
\begin{DoxyCompactList}\small\item\em \-Template analysis data structure. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{\-Defines}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{template_8c_a8485f4e81de2537e6a0935626167a775}{\-N\-F\-I\-L\-E}~\hyperlink{share_2template_2gromacs_2macros_8h_a0883345a58f8f63aefa249a4f127f707}{asize}(fnm)
\end{DoxyCompactItemize}
\subsection*{\-Functions}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{template_8c_a953a63d0349d2c760edc9a9b53df0166}{analyze\-\_\-frame} (\hyperlink{structt__topology}{t\-\_\-topology} $\ast$\hyperlink{gmx__disre_8c_a1b538a2ce75aba6c346bc03980ffeb28}{top}, \hyperlink{include_2types_2trx_8h_a206f77137d72a5db1097a457a7144ad5}{t\-\_\-trxframe} $\ast$\hyperlink{addconf_8c_ae8414314f87c5e49503ac0117eb511ad}{fr}, \hyperlink{structt__pbc}{t\-\_\-pbc} $\ast$pbc, int \hyperlink{share_2template_2gromacs_2gmx__lapack_8h_a560e4062098f77c2d7e5fe83bf09c394}{nr}, \hyperlink{structgmx__ana__selection__t}{gmx\-\_\-ana\-\_\-selection\-\_\-t} $\ast$sel\mbox{[}$\,$\mbox{]}, \hyperlink{nbnxn__kernel__simd__4xn__outer_8h_a8dc3f4a797ed992dff49d2fa3477eee8}{void} $\ast$data)
\begin{DoxyCompactList}\small\item\em \-Function that does the analysis for a single frame. \end{DoxyCompactList}\item 
int \hyperlink{template_8c_aa4770cc00bd64e5a491b5a6baacabc6f}{gmx\-\_\-template} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\begin{DoxyCompactList}\small\item\em \-Function that implements the analysis tool. \end{DoxyCompactList}\item 
int \hyperlink{template_8c_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\begin{DoxyCompactList}\small\item\em \-The main function. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{\-Detailed \-Description}
\-Template code for writing analysis programs. \-The full source code for the file\-: \hyperlink{template_8c-example}{template.c}

\hypertarget{template_8c_global}{}\subsection{\-Global definitions}\label{template_8c_global}
\-We start by including some generic \-Gromacs headers 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 and continue by including headers for the analysis library\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 \-Here, we include just nbsearch.\-h that contains routines for performing neighborhood searches for a set of positions. \-Possibile additional header files include displacement.\-h and histogram.\-h; see the documentation of user header files.

\-We then define a structure that holds data required during the analysis in \hyperlink{template_8c_a953a63d0349d2c760edc9a9b53df0166}{analyze\-\_\-frame()}\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
\hypertarget{template_8c_analysis}{}\subsection{\-Frame analysis function}\label{template_8c_analysis}
\-We're now ready to define the function that (in most analysis codes) does the main part of the work\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 \-The topology can be accessed through {\ttfamily top} and the coordinates, box size etc. through {\ttfamily fr}. {\ttfamily pbc} can be used for periodic boundary calculations with, e.\-g., \hyperlink{include_2pbc_8h_a442132e6e6fce9d8f8f5c4e115e6b4d7}{pbc\-\_\-dx()}. {\ttfamily sel} contains the selections defined by the user, containing both the positions and the index groups that have been used to evaluate those. \-The number of selections is available in {\ttfamily nr}. \-The analysis should be written such that does not assume the selections to have constant size. \-The last parameter {\ttfamily data} points to our custom data (\hyperlink{structt__analysisdata}{t\-\_\-analysisdata}), so we first define a pointer that can be used to access the data\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 \-Any changes made to the data through {\ttfamily d} can be accessed in later calls to \hyperlink{template_8c_a953a63d0349d2c760edc9a9b53df0166}{analyze\-\_\-frame()} as well as in the main function (\hyperlink{template_8c_aa4770cc00bd64e5a491b5a6baacabc6f}{gmx\-\_\-template()}).

\-Here, we can do whatever calculations our program requires for a frame. \-For the template, we first print the time for the current frame\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 \-Then, we do a simple calculation\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 \-After all the selections are processed, we print a newline to the output file\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 \-Finally, we return zero to indicate that all went well. 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
\hypertarget{template_8c_gmx_template}{}\subsection{\-The main analysis tool}\label{template_8c_gmx_template}
\-We then define our main function in the same style as in \-Gromacs analysis programs. \-We also provide a help text that can be shown with the {\ttfamily -\/h} command-\/line option\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}


\-Next, we define program-\/specific command-\/line arguments as in standard \-Gromacs analysis programs\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 \-Options for controlling the begin/end/skip of the trajectory are automatically added, as are options for selections. \-In the template, the second argument is for demonstartion purposes only; it is not actually used.

\-We also define the command-\/line options for output files\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 \-There should be no need to specify standard input files (trajectory, topology, index), because they are automatically added and read in by \hyperlink{include_2trajana_8h_ac660e74f8923b12c5070632bb39a3e83}{parse\-\_\-trjana\-\_\-args()}. \-If you, however, define these file types with non-\/standard values, they override the default values in \hyperlink{include_2trajana_8h_ac660e74f8923b12c5070632bb39a3e83}{parse\-\_\-trjana\-\_\-args()}.

\-We then define some local variables\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 \-The {\ttfamily trj} pointer holds internal data required for the library, and can also be used to access topology information during initialization. \-We also declare a \hyperlink{structt__analysisdata}{t\-\_\-analysisdata} structure to hold data required in \hyperlink{template_8c_a953a63d0349d2c760edc9a9b53df0166}{analyze\-\_\-frame()}, as well as a few variables that will store information about the selection that the user has provided.

\-The actual code begins next. \-To follow the style of \-Gromacs tools, we first print some information about the \-Gromacs build\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}


\-Next, we initialize the {\ttfamily trj} pointer\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 \-We can use different flags to specify requirements for the selections and/or other features of the library. \-See \hyperlink{share_2template_2gromacs_2trajana_8h_analysis_flags}{\-Flags for gmx\-\_\-ana\-\_\-traj\-\_\-create()}.

\-Next, we set some options\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}


\-After initializing {\ttfamily trj}, we can call \hyperlink{include_2trajana_8h_ac660e74f8923b12c5070632bb39a3e83}{parse\-\_\-trjana\-\_\-args()} to parse command-\/line arguments and initialise the rest of the {\ttfamily trj} structure\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}


\-After the call to \hyperlink{include_2trajana_8h_ac660e74f8923b12c5070632bb39a3e83}{parse\-\_\-trjana\-\_\-args()}, all the command-\/line arguments are available in the variables pointed by the {\ttfamily pa} array and can be used in initialization.

\-If you need to initialize the number of analysis groups based on the command-\/line arguments, you can set \hyperlink{share_2template_2gromacs_2trajana_8h_a1dd40cef81b1be5a2ef2da7841da2b7a}{\-A\-N\-A\-\_\-\-U\-S\-E\-R\-\_\-\-S\-E\-L\-I\-N\-I\-T} and call \hyperlink{include_2trajana_8h_a25e689bd718e61d642d199a935262edd}{gmx\-\_\-ana\-\_\-init\-\_\-selections()} separately. \-Currently, the template does not demonstrate this to keep it as simple as possible.

\-After these calls, the program should perform any initialization that is required before starting the analysis. \-This can include allocating memory, precalculating things, preparing output files and so on. \-Any data that is required in the analysis of a single frame should be put into {\ttfamily d}. \-Data related to the selections, topology, and/or the first frame can be accessed through {\ttfamily trj}; see the functions trajana.\-h. \-For the template, we get the selection used as the reference positions and the analysis groups using the following code\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 \-Notice that the reference selection is not included in the information returned by the last two calls.

\-For the template, we want to search the neighborhood of positions in the first selection, so we initialize a neighborhood search. \-This can be achieved with the following code\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 \-Note that the calculation data is stored in {\ttfamily d} for it to be accessible in \hyperlink{template_8c_a953a63d0349d2c760edc9a9b53df0166}{analyze\-\_\-frame()}.

\-For the template, we also need some memory for calculating the average distance for each index group, so we need to allocate it\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 \-We also open and prepare an output file for the data that is written out during each frame\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}


\-Now we should be ready to do the actual loop over the frames. \-This is accomplished by the function call 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 \-This reads in each frame, updates the selections and calls \hyperlink{template_8c_a953a63d0349d2c760edc9a9b53df0166}{analyze\-\_\-frame()} for each frame. \-All the initialized data (counters, file pointers, parameters etc.) that is needed by the analysis (\hyperlink{template_8c_a953a63d0349d2c760edc9a9b53df0166}{analyze\-\_\-frame()} in this case) should be included in {\ttfamily d}. \-Note that only the analysis groups are passed to \hyperlink{template_8c_a953a63d0349d2c760edc9a9b53df0166}{analyze\-\_\-frame()}; the reference groups should be retrieved separately using \hyperlink{include_2trajana_8h_ab54f2b73a4ae57e59954a0fb1ce9288f}{gmx\-\_\-ana\-\_\-get\-\_\-refsel()}. \-If this is not desired, one can also specify \hyperlink{share_2template_2gromacs_2trajana_8h_a7ae879f4029c0601ccffc4c266f08b6f}{\-A\-N\-A\-\_\-\-U\-S\-E\-\_\-\-F\-U\-L\-L\-G\-R\-P\-S} to include the reference groups to those passed to the analysis function. \-Notice that this flag also changes the behavior of \hyperlink{include_2trajana_8h_afc0ea922babbb836e49788bc8c63e49b}{gmx\-\_\-ana\-\_\-get\-\_\-anagrps()} and \hyperlink{include_2trajana_8h_a5c9404f07f99b1c57de6228397f3bbf5}{gmx\-\_\-ana\-\_\-get\-\_\-grpnames()}.

\-Finally, the analysis program probably needs to calculate and write out some values such as averaged properties. \-The template first closes the output file if one was opened 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 and then calculates and prints out the average distances for each analysis group\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}


\-To follow the conventions of \-Gromacs tools, we finally print a (funny) line 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 and return zero to indicate success. 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
\hypertarget{template_8c_main}{}\subsection{\-Definition of main()}\label{template_8c_main}
\-Now, the only thing remaining is to define the \hyperlink{TestAtomics_8c_a840291bc02cba5474a4cb46a9b9566fe}{main()} function. \-It should simply call our \hyperlink{template_8c_aa4770cc00bd64e5a491b5a6baacabc6f}{gmx\-\_\-template()} function\-: 
\begin{DoxyCodeInclude}

\end{DoxyCodeInclude}
 

\subsection{\-Define \-Documentation}
\hypertarget{template_8c_a8485f4e81de2537e6a0935626167a775}{\index{template.\-c@{template.\-c}!\-N\-F\-I\-L\-E@{\-N\-F\-I\-L\-E}}
\index{\-N\-F\-I\-L\-E@{\-N\-F\-I\-L\-E}!template.c@{template.\-c}}
\subsubsection[{\-N\-F\-I\-L\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define {\bf \-N\-F\-I\-L\-E}~{\bf asize}(fnm)}}\label{template_8c_a8485f4e81de2537e6a0935626167a775}


\subsection{\-Function \-Documentation}
\hypertarget{template_8c_a953a63d0349d2c760edc9a9b53df0166}{\index{template.\-c@{template.\-c}!analyze\-\_\-frame@{analyze\-\_\-frame}}
\index{analyze\-\_\-frame@{analyze\-\_\-frame}!template.c@{template.\-c}}
\subsubsection[{analyze\-\_\-frame}]{\setlength{\rightskip}{0pt plus 5cm}static int {\bf analyze\-\_\-frame} (
\begin{DoxyParamCaption}
\item[{{\bf t\-\_\-topology} $\ast$}]{top, }
\item[{{\bf t\-\_\-trxframe} $\ast$}]{fr, }
\item[{{\bf t\-\_\-pbc} $\ast$}]{pbc, }
\item[{int}]{nr, }
\item[{{\bf gmx\-\_\-ana\-\_\-selection\-\_\-t} $\ast$}]{sel\mbox{[}$\,$\mbox{]}, }
\item[{{\bf void} $\ast$}]{data}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}}\label{template_8c_a953a63d0349d2c760edc9a9b53df0166}


\-Function that does the analysis for a single frame. 

\-It is called once for each frame. 

\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{template_8c_a953a63d0349d2c760edc9a9b53df0166_cgraph}
\end{center}
\end{figure}




\-Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=348pt]{template_8c_a953a63d0349d2c760edc9a9b53df0166_icgraph}
\end{center}
\end{figure}


\hypertarget{template_8c_aa4770cc00bd64e5a491b5a6baacabc6f}{\index{template.\-c@{template.\-c}!gmx\-\_\-template@{gmx\-\_\-template}}
\index{gmx\-\_\-template@{gmx\-\_\-template}!template.c@{template.\-c}}
\subsubsection[{gmx\-\_\-template}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf gmx\-\_\-template} (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}}\label{template_8c_aa4770cc00bd64e5a491b5a6baacabc6f}


\-Function that implements the analysis tool. 

\-Following the style of \-Gromacs analysis tools, this function is called {\ttfamily gmx\-\_\-something}. 

\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{template_8c_aa4770cc00bd64e5a491b5a6baacabc6f_cgraph}
\end{center}
\end{figure}




\-Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=232pt]{template_8c_aa4770cc00bd64e5a491b5a6baacabc6f_icgraph}
\end{center}
\end{figure}


\hypertarget{template_8c_a0ddf1224851353fc92bfbff6f499fa97}{\index{template.\-c@{template.\-c}!main@{main}}
\index{main@{main}!template.c@{template.\-c}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf main} (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}}\label{template_8c_a0ddf1224851353fc92bfbff6f499fa97}


\-The main function. 

\-In \-Gromacs, most analysis programs are implemented such that the {\ttfamily main} function is only a wrapper for a {\ttfamily gmx\-\_\-something} function that does all the work, and that convention is also followed here. 

\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{template_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph}
\end{center}
\end{figure}


