\hypertarget{share_2template_2gromacs_2gmx__cyclecounter_8h}{\section{share/template/gromacs/gmx\-\_\-cyclecounter.h \-File \-Reference}
\label{share_2template_2gromacs_2gmx__cyclecounter_8h}\index{share/template/gromacs/gmx\-\_\-cyclecounter.\-h@{share/template/gromacs/gmx\-\_\-cyclecounter.\-h}}
}
\-This graph shows which files directly or indirectly include this file\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{share_2template_2gromacs_2gmx__cyclecounter_8h__dep__incl}
\end{center}
\end{figure}
\subsection*{\-Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef long \hyperlink{share_2template_2gromacs_2gmx__cyclecounter_8h_a7b04e633389542df9f5535b05b873baa}{gmx\-\_\-cycles\-\_\-t}
\begin{DoxyCompactList}\small\item\em \-Integer-\/like datatype for cycle counter values. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{\-Functions}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{share_2template_2gromacs_2gmx__cyclecounter_8h_af36c6166d37379804e1da2ae5c57f862}{gmx\-\_\-cycles\-\_\-have\-\_\-counter} (\hyperlink{nbnxn__kernel__simd__4xn__outer_8h_a8dc3f4a797ed992dff49d2fa3477eee8}{void})
\begin{DoxyCompactList}\small\item\em \-Check if high-\/resolution cycle counters are available. \end{DoxyCompactList}\item 
static \hyperlink{include_2gmx__cyclecounter_8h_a7b04e633389542df9f5535b05b873baa}{gmx\-\_\-cycles\-\_\-t} \hyperlink{share_2template_2gromacs_2gmx__cyclecounter_8h_a44eb37a6a439c565976b7c14c2bdae00}{gmx\-\_\-cycles\-\_\-read} (\hyperlink{nbnxn__kernel__simd__4xn__outer_8h_a8dc3f4a797ed992dff49d2fa3477eee8}{void})
\begin{DoxyCompactList}\small\item\em \-Read \-C\-P\-U cycle counter. \end{DoxyCompactList}\item 
double \hyperlink{share_2template_2gromacs_2gmx__cyclecounter_8h_a15e94a5a32400864b027b6d54c7963e7}{gmx\-\_\-cycles\-\_\-calibrate} (double sampletime)
\begin{DoxyCompactList}\small\item\em \-Calculate number of seconds per cycle tick on host. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{\-Typedef \-Documentation}
\hypertarget{share_2template_2gromacs_2gmx__cyclecounter_8h_a7b04e633389542df9f5535b05b873baa}{\index{share/template/gromacs/gmx\-\_\-cyclecounter.\-h@{share/template/gromacs/gmx\-\_\-cyclecounter.\-h}!gmx\-\_\-cycles\-\_\-t@{gmx\-\_\-cycles\-\_\-t}}
\index{gmx\-\_\-cycles\-\_\-t@{gmx\-\_\-cycles\-\_\-t}!share/template/gromacs/gmx_cyclecounter.h@{share/template/gromacs/gmx\-\_\-cyclecounter.\-h}}
\subsubsection[{gmx\-\_\-cycles\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef long {\bf gmx\-\_\-cycles\-\_\-t}}}\label{share_2template_2gromacs_2gmx__cyclecounter_8h_a7b04e633389542df9f5535b05b873baa}


\-Integer-\/like datatype for cycle counter values. 

\-Depending on your system this will usually be something like long long, or a special cycle datatype from the system header files. \-It is \-N\-O\-T necessarily real processor cycles -\/ many systems count in nanoseconds or a special external time register at fixed frequency (not the \-C\-P\-U freq.)

\-You can subtract or add gmx\-\_\-cycle\-\_\-t types just as normal integers, and if you run the calibration routine you can also multiply it with a factor to translate the cycle data to seconds. 

\subsection{\-Function \-Documentation}
\hypertarget{share_2template_2gromacs_2gmx__cyclecounter_8h_a15e94a5a32400864b027b6d54c7963e7}{\index{share/template/gromacs/gmx\-\_\-cyclecounter.\-h@{share/template/gromacs/gmx\-\_\-cyclecounter.\-h}!gmx\-\_\-cycles\-\_\-calibrate@{gmx\-\_\-cycles\-\_\-calibrate}}
\index{gmx\-\_\-cycles\-\_\-calibrate@{gmx\-\_\-cycles\-\_\-calibrate}!share/template/gromacs/gmx_cyclecounter.h@{share/template/gromacs/gmx\-\_\-cyclecounter.\-h}}
\subsubsection[{gmx\-\_\-cycles\-\_\-calibrate}]{\setlength{\rightskip}{0pt plus 5cm}double {\bf gmx\-\_\-cycles\-\_\-calibrate} (
\begin{DoxyParamCaption}
\item[{double}]{sampletime}
\end{DoxyParamCaption}
)}}\label{share_2template_2gromacs_2gmx__cyclecounter_8h_a15e94a5a32400864b027b6d54c7963e7}


\-Calculate number of seconds per cycle tick on host. 

\-This routine runs a timer loop to calibrate the number of seconds per the units returned from gmx\-\_\-cycles\-\_\-difference()

\-To calculate the time used, call \hyperlink{include_2gmx__cyclecounter_8h_a44eb37a6a439c565976b7c14c2bdae00}{gmx\-\_\-cycles\-\_\-read()} twice, and then use this routine to calculate the difference as a double precision floating-\/point number.


\begin{DoxyParams}{\-Parameters}
{\em sampletime} & \-Minimum number of seconds to sample. \-One second should give you a reasonably accurate calibration. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{\-Returns}
\-Number of seconds per cycle unit. \-If it is not possible to calculate on this system (for whatever reason) the return value will be -\/1, so check that it is positive before using it.
\end{DoxyReturn}
\-This routine runs a timer loop to calibrate the number of seconds per the units returned fro \hyperlink{include_2gmx__cyclecounter_8h_a44eb37a6a439c565976b7c14c2bdae00}{gmx\-\_\-cycles\-\_\-read()}.


\begin{DoxyParams}{\-Parameters}
{\em sampletime} & \-Minimum real sample time. \-It takes some trial-\/and-\/error to find the correct delay loop size, so the total runtime of this routine is about twice this time. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{\-Returns}
\-Number of seconds per cycle unit. \-If it is not possible to calculate on this system (for whatever reason) the return value will be -\/1, so check that it is positive before using it. 
\end{DoxyReturn}


\-Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{share_2template_2gromacs_2gmx__cyclecounter_8h_a15e94a5a32400864b027b6d54c7963e7_cgraph}
\end{center}
\end{figure}


\hypertarget{share_2template_2gromacs_2gmx__cyclecounter_8h_af36c6166d37379804e1da2ae5c57f862}{\index{share/template/gromacs/gmx\-\_\-cyclecounter.\-h@{share/template/gromacs/gmx\-\_\-cyclecounter.\-h}!gmx\-\_\-cycles\-\_\-have\-\_\-counter@{gmx\-\_\-cycles\-\_\-have\-\_\-counter}}
\index{gmx\-\_\-cycles\-\_\-have\-\_\-counter@{gmx\-\_\-cycles\-\_\-have\-\_\-counter}!share/template/gromacs/gmx_cyclecounter.h@{share/template/gromacs/gmx\-\_\-cyclecounter.\-h}}
\subsubsection[{gmx\-\_\-cycles\-\_\-have\-\_\-counter}]{\setlength{\rightskip}{0pt plus 5cm}static int {\bf gmx\-\_\-cycles\-\_\-have\-\_\-counter} (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}}\label{share_2template_2gromacs_2gmx__cyclecounter_8h_af36c6166d37379804e1da2ae5c57f862}


\-Check if high-\/resolution cycle counters are available. 

\-Not all architectures provide any way to read timestep counters in the \-C\-P\-U, and on some it is broken. \-Although we refer to it as cycle counters, it is not necessarily given in units of cycles.

\-If you notice that system is missing, implement support for it, find out how to detect the system during preprocessing, and send us a patch.

\begin{DoxyReturn}{\-Returns}
1 if cycle counters are available, 0 if not.
\end{DoxyReturn}
\begin{DoxyNote}{\-Note}
\-This functions not need to be in the header for performance reasons, but it is very important that we get exactly the same detection as for \hyperlink{share_2template_2gromacs_2gmx__cyclecounter_8h_a44eb37a6a439c565976b7c14c2bdae00}{gmx\-\_\-cycles\-\_\-read()} routines. \-If you compile the library with one compiler, and then use a different one when later linking to the library it might happen that the library supports cyclecounters but not the headers, or vice versa. 
\end{DoxyNote}
\hypertarget{share_2template_2gromacs_2gmx__cyclecounter_8h_a44eb37a6a439c565976b7c14c2bdae00}{\index{share/template/gromacs/gmx\-\_\-cyclecounter.\-h@{share/template/gromacs/gmx\-\_\-cyclecounter.\-h}!gmx\-\_\-cycles\-\_\-read@{gmx\-\_\-cycles\-\_\-read}}
\index{gmx\-\_\-cycles\-\_\-read@{gmx\-\_\-cycles\-\_\-read}!share/template/gromacs/gmx_cyclecounter.h@{share/template/gromacs/gmx\-\_\-cyclecounter.\-h}}
\subsubsection[{gmx\-\_\-cycles\-\_\-read}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf gmx\-\_\-cycles\-\_\-t} {\bf gmx\-\_\-cycles\-\_\-read} (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}}\label{share_2template_2gromacs_2gmx__cyclecounter_8h_a44eb37a6a439c565976b7c14c2bdae00}


\-Read \-C\-P\-U cycle counter. 

\-This routine returns an abstract datatype containing a cycle counter timestamp.

\begin{DoxyReturn}{\-Returns}
\-Opaque data corresponding to a cycle reading.
\end{DoxyReturn}
\-Please note that on most systems it takes several cycles to read and return the cycle counters. \-If you are measuring small intervals, you can compensate for this time by calling the routine twice and calculating what the difference is. \-Subtract this from your other measurements to get an accurate result.

\-Use gmx\-\_\-cycles\-\_\-difference() to get a real number corresponding to the difference between two gmx\-\_\-cycles\-\_\-t values returned from this routine. 