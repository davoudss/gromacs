<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>My Project: share/template/gromacs/gmx_math_x86_sse4_1_double.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">share/template/gromacs/gmx_math_x86_sse4_1_double.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * This file is part of the GROMACS molecular simulation package.</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (c) 2012,2013, by the GROMACS development team, led by</span>
<a name="l00005"></a>00005 <span class="comment"> * David van der Spoel, Berk Hess, Erik Lindahl, and including many</span>
<a name="l00006"></a>00006 <span class="comment"> * others, as listed in the AUTHORS file in the top-level source</span>
<a name="l00007"></a>00007 <span class="comment"> * directory and at http://www.gromacs.org.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * GROMACS is free software; you can redistribute it and/or</span>
<a name="l00010"></a>00010 <span class="comment"> * modify it under the terms of the GNU Lesser General Public License</span>
<a name="l00011"></a>00011 <span class="comment"> * as published by the Free Software Foundation; either version 2.1</span>
<a name="l00012"></a>00012 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * GROMACS is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00017"></a>00017 <span class="comment"> * Lesser General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * You should have received a copy of the GNU Lesser General Public</span>
<a name="l00020"></a>00020 <span class="comment"> * License along with GROMACS; if not, see</span>
<a name="l00021"></a>00021 <span class="comment"> * http://www.gnu.org/licenses, or write to the Free Software Foundation,</span>
<a name="l00022"></a>00022 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * If you want to redistribute modifications to GROMACS, please</span>
<a name="l00025"></a>00025 <span class="comment"> * consider that scientific software is very special. Version</span>
<a name="l00026"></a>00026 <span class="comment"> * control is crucial - bugs must be traceable. We will be happy to</span>
<a name="l00027"></a>00027 <span class="comment"> * consider code for inclusion in the official distribution, but</span>
<a name="l00028"></a>00028 <span class="comment"> * derived work must not be called official GROMACS. Details are found</span>
<a name="l00029"></a>00029 <span class="comment"> * in the README &amp; COPYING files - if they are missing, get the</span>
<a name="l00030"></a>00030 <span class="comment"> * official version at http://www.gromacs.org.</span>
<a name="l00031"></a>00031 <span class="comment"> *</span>
<a name="l00032"></a>00032 <span class="comment"> * To help us fund GROMACS development, we humbly ask that you cite</span>
<a name="l00033"></a>00033 <span class="comment"> * the research papers on the package. Check out http://www.gromacs.org.</span>
<a name="l00034"></a>00034 <span class="comment"> */</span>
<a name="l00035"></a>00035 <span class="preprocessor">#ifndef _gmx_math_x86_sse4_1_double_h_</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#define _gmx_math_x86_sse4_1_double_h_</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="share_2template_2gromacs_2gmx__x86__sse4__1_8h.html">gmx_x86_sse4_1.h</a>&quot;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#ifndef M_PI</span>
<a name="l00046"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">00046</a> <span class="preprocessor"></span><span class="preprocessor">#  define M_PI 3.14159265358979323846264338327950288</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00049"></a>00049 <span class="comment">/************************</span>
<a name="l00050"></a>00050 <span class="comment"> *                      *</span>
<a name="l00051"></a>00051 <span class="comment"> * Simple math routines *</span>
<a name="l00052"></a>00052 <span class="comment"> *                      *</span>
<a name="l00053"></a>00053 <span class="comment"> ************************/</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">/* 1.0/sqrt(x) */</span>
<a name="l00056"></a>00056 <span class="keyword">static</span> <a class="code" href="config_8h.html#ae41cb23b2e5c6546d8b571ff65ee8257">gmx_inline</a> __m128d
<a name="l00057"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a18a37ec6f89b9e7d2b9ffff7e90f111f">00057</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a18a37ec6f89b9e7d2b9ffff7e90f111f">gmx_mm_invsqrt_pd</a>(__m128d <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>)
<a name="l00058"></a>00058 {
<a name="l00059"></a>00059     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#a701d1f7de8380226dbc8825672ae4ef0">half</a>  = _mm_set1_pd(0.5);
<a name="l00060"></a>00060     <span class="keyword">const</span> __m128d three = _mm_set1_pd(3.0);
<a name="l00061"></a>00061 
<a name="l00062"></a>00062     <span class="comment">/* Lookup instruction only exists in single precision, convert back and forth... */</span>
<a name="l00063"></a>00063     __m128d lu = _mm_cvtps_pd(_mm_rsqrt_ps( _mm_cvtpd_ps(x)));
<a name="l00064"></a>00064 
<a name="l00065"></a>00065     lu = _mm_mul_pd(half, _mm_mul_pd(_mm_sub_pd(three, _mm_mul_pd(_mm_mul_pd(lu, lu), x)), lu));
<a name="l00066"></a>00066     <span class="keywordflow">return</span> _mm_mul_pd(half, _mm_mul_pd(_mm_sub_pd(three, _mm_mul_pd(_mm_mul_pd(lu, lu), x)), lu));
<a name="l00067"></a>00067 }
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="comment">/* 1.0/sqrt(x), done for a pair of arguments to improve throughput */</span>
<a name="l00070"></a>00070 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00071"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a35f35d0c1507c30d030e6bf5fc5e98e0">00071</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a35f35d0c1507c30d030e6bf5fc5e98e0">gmx_mm_invsqrt_pair_pd</a>(__m128d x1, __m128d x2, __m128d *invsqrt1, __m128d *invsqrt2)
<a name="l00072"></a>00072 {
<a name="l00073"></a>00073     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#a701d1f7de8380226dbc8825672ae4ef0">half</a>   = _mm_set1_pd(0.5);
<a name="l00074"></a>00074     <span class="keyword">const</span> __m128d three  = _mm_set1_pd(3.0);
<a name="l00075"></a>00075     <span class="keyword">const</span> __m128  <a class="code" href="maths_8c.html#a6f88c1a3bd1f4056cddd11abb3b92681">halff</a>  = _mm_set1_ps(0.5<a class="code" href="copyrite_8c.html#a0757cfb6fe645a02867727255faa4f8b">f</a>);
<a name="l00076"></a>00076     <span class="keyword">const</span> __m128  threef = _mm_set1_ps(3.0<a class="code" href="copyrite_8c.html#a0757cfb6fe645a02867727255faa4f8b">f</a>);
<a name="l00077"></a>00077 
<a name="l00078"></a>00078     __m128        xf, luf;
<a name="l00079"></a>00079     __m128d       lu1, lu2;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <span class="comment">/* Do first N-R step in float for 2x throughput */</span>
<a name="l00082"></a>00082     xf  = _mm_shuffle_ps(_mm_cvtpd_ps(x1), _mm_cvtpd_ps(x2), _MM_SHUFFLE(1, 0, 1, 0));
<a name="l00083"></a>00083     luf = _mm_rsqrt_ps(xf);
<a name="l00084"></a>00084     luf = _mm_mul_ps(halff, _mm_mul_ps(_mm_sub_ps(threef, _mm_mul_ps(_mm_mul_ps(luf, luf), xf)), luf));
<a name="l00085"></a>00085 
<a name="l00086"></a>00086     lu2 = _mm_cvtps_pd(_mm_shuffle_ps(luf, luf, _MM_SHUFFLE(3, 2, 3, 2)));
<a name="l00087"></a>00087     lu1 = _mm_cvtps_pd(luf);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     *invsqrt1 = _mm_mul_pd(half, _mm_mul_pd(_mm_sub_pd(three, _mm_mul_pd(_mm_mul_pd(lu1, lu1), x1)), lu1));
<a name="l00090"></a>00090     *invsqrt2 = _mm_mul_pd(half, _mm_mul_pd(_mm_sub_pd(three, _mm_mul_pd(_mm_mul_pd(lu2, lu2), x2)), lu2));
<a name="l00091"></a>00091 }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="comment">/* sqrt(x) - Do NOT use this (but rather invsqrt) if you actually need 1.0/sqrt(x) */</span>
<a name="l00094"></a>00094 <span class="keyword">static</span> <a class="code" href="config_8h.html#ae41cb23b2e5c6546d8b571ff65ee8257">gmx_inline</a> __m128d
<a name="l00095"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a34a1c9addc31acbb09c58587a51960e8">00095</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a34a1c9addc31acbb09c58587a51960e8">gmx_mm_sqrt_pd</a>(__m128d <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>)
<a name="l00096"></a>00096 {
<a name="l00097"></a>00097     __m128d mask;
<a name="l00098"></a>00098     __m128d res;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100     mask = _mm_cmpeq_pd(x, _mm_setzero_pd());
<a name="l00101"></a>00101     res  = _mm_andnot_pd(mask, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a18a37ec6f89b9e7d2b9ffff7e90f111f">gmx_mm_invsqrt_pd</a>(x));
<a name="l00102"></a>00102 
<a name="l00103"></a>00103     res  = _mm_mul_pd(x, res);
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     <span class="keywordflow">return</span> res;
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 <span class="comment">/* 1.0/x */</span>
<a name="l00109"></a>00109 <span class="keyword">static</span> <a class="code" href="config_8h.html#ae41cb23b2e5c6546d8b571ff65ee8257">gmx_inline</a> __m128d
<a name="l00110"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">00110</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(__m128d <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>)
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#a45c15ebfa63fa10683ebce401df0b836">two</a>  = _mm_set1_pd(2.0);
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     <span class="comment">/* Lookup instruction only exists in single precision, convert back and forth... */</span>
<a name="l00115"></a>00115     __m128d lu = _mm_cvtps_pd(_mm_rcp_ps( _mm_cvtpd_ps(x)));
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <span class="comment">/* Perform two N-R steps for double precision */</span>
<a name="l00118"></a>00118     lu         = _mm_mul_pd(lu, _mm_sub_pd(two, _mm_mul_pd(x, lu)));
<a name="l00119"></a>00119     <span class="keywordflow">return</span> _mm_mul_pd(lu, _mm_sub_pd(two, _mm_mul_pd(x, lu)));
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="keyword">static</span> <a class="code" href="config_8h.html#ae41cb23b2e5c6546d8b571ff65ee8257">gmx_inline</a> __m128d
<a name="l00123"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a935221f94a86b3f7a14c8956f8538a2e">00123</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a935221f94a86b3f7a14c8956f8538a2e">gmx_mm_abs_pd</a>(__m128d <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>)
<a name="l00124"></a>00124 {
<a name="l00125"></a>00125     <span class="keyword">const</span> __m128d signmask  = <a class="code" href="include_2gmx__x86__avx__128__fma_8h.html#a15d96a23ac5f6569e6d35e73ea186589">gmx_mm_castsi128_pd</a>( _mm_set_epi32(0x7FFFFFFF, 0xFFFFFFFF, 0x7FFFFFFF, 0xFFFFFFFF) );
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     <span class="keywordflow">return</span> _mm_and_pd(x, signmask);
<a name="l00128"></a>00128 }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 <span class="comment">/*</span>
<a name="l00132"></a>00132 <span class="comment"> * 2^x function.</span>
<a name="l00133"></a>00133 <span class="comment"> *</span>
<a name="l00134"></a>00134 <span class="comment"> * The 2^w term is calculated from a (6,0)-th order (no denominator) Minimax polynomia on the interval</span>
<a name="l00135"></a>00135 <span class="comment"> * [-0.5,0.5].</span>
<a name="l00136"></a>00136 <span class="comment"> *</span>
<a name="l00137"></a>00137 <span class="comment"> * The approximation on [-0.5,0.5] is a rational Padé approximation, 1+2*P(x^2)/(Q(x^2)-P(x^2)),</span>
<a name="l00138"></a>00138 <span class="comment"> * according to the same algorithm as used in the Cephes/netlib math routines.</span>
<a name="l00139"></a>00139 <span class="comment"> */</span>
<a name="l00140"></a>00140 <span class="keyword">static</span> __m128d
<a name="l00141"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a8879bee059177d68b14bb2ea9405f59c">00141</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a8879bee059177d68b14bb2ea9405f59c">gmx_mm_exp2_pd</a>(__m128d <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>)
<a name="l00142"></a>00142 {
<a name="l00143"></a>00143     <span class="comment">/* Lower bound: We do not allow numbers that would lead to an IEEE fp representation exponent smaller than -126. */</span>
<a name="l00144"></a>00144     <span class="keyword">const</span> __m128d arglimit = _mm_set1_pd(1022.0);
<a name="l00145"></a>00145     <span class="keyword">const</span> __m128i expbase  = _mm_set1_epi32(1023);
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <span class="keyword">const</span> __m128d P2       = _mm_set1_pd(2.30933477057345225087<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-2);
<a name="l00148"></a>00148     <span class="keyword">const</span> __m128d P1       = _mm_set1_pd(2.02020656693165307700e1);
<a name="l00149"></a>00149     <span class="keyword">const</span> __m128d P0       = _mm_set1_pd(1.51390680115615096133e3);
<a name="l00150"></a>00150     <span class="comment">/* Q2 == 1.0 */</span>
<a name="l00151"></a>00151     <span class="keyword">const</span> __m128d Q1       = _mm_set1_pd(2.33184211722314911771<a class="code" href="include_2gmx__lapack_8h.html#a940a4ccebd05dcf81cf91afd05427ccd">e2</a>);
<a name="l00152"></a>00152     <span class="keyword">const</span> __m128d Q0       = _mm_set1_pd(4.36821166879210612817e3);
<a name="l00153"></a>00153     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#ada85e349d35971b32c8ea4238881ff8b">one</a>      = _mm_set1_pd(1.0);
<a name="l00154"></a>00154     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#a45c15ebfa63fa10683ebce401df0b836">two</a>      = _mm_set1_pd(2.0);
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     __m128d       valuemask;
<a name="l00157"></a>00157     __m128i       iexppart;
<a name="l00158"></a>00158     __m128d       fexppart;
<a name="l00159"></a>00159     __m128d       intpart;
<a name="l00160"></a>00160     __m128d       <a class="code" href="include_2gmx__arpack_8h.html#a4f5dbf2e71c295ecca7ff4214e90ba91">z</a>, z2;
<a name="l00161"></a>00161     __m128d       PolyP, PolyQ;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     iexppart  = _mm_cvtpd_epi32(x);
<a name="l00164"></a>00164     intpart   = _mm_round_pd(x, _MM_FROUND_TO_NEAREST_INT);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="comment">/* The two lowest elements of iexppart now contains 32-bit numbers with a correctly biased exponent.</span>
<a name="l00167"></a>00167 <span class="comment">     * To be able to shift it into the exponent for a double precision number we first need to</span>
<a name="l00168"></a>00168 <span class="comment">     * shuffle so that the lower half contains the first element, and the upper half the second.</span>
<a name="l00169"></a>00169 <span class="comment">     * This should really be done as a zero-extension, but since the next instructions will shift</span>
<a name="l00170"></a>00170 <span class="comment">     * the registers left by 52 bits it doesn&#39;t matter what we put there - it will be shifted out.</span>
<a name="l00171"></a>00171 <span class="comment">     * (thus we just use element 2 from iexppart).</span>
<a name="l00172"></a>00172 <span class="comment">     */</span>
<a name="l00173"></a>00173     iexppart  = _mm_shuffle_epi32(iexppart, _MM_SHUFFLE(2, 1, 2, 0));
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     <span class="comment">/* Do the shift operation on the 64-bit registers */</span>
<a name="l00176"></a>00176     iexppart  = _mm_add_epi32(iexppart, expbase);
<a name="l00177"></a>00177     iexppart  = _mm_slli_epi64(iexppart, 52);
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     valuemask = _mm_cmpge_pd(arglimit, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a935221f94a86b3f7a14c8956f8538a2e">gmx_mm_abs_pd</a>(x));
<a name="l00180"></a>00180     fexppart  = _mm_and_pd(valuemask, <a class="code" href="include_2gmx__x86__avx__128__fma_8h.html#a15d96a23ac5f6569e6d35e73ea186589">gmx_mm_castsi128_pd</a>(iexppart));
<a name="l00181"></a>00181 
<a name="l00182"></a>00182     z         = _mm_sub_pd(x, intpart);
<a name="l00183"></a>00183     z2        = _mm_mul_pd(z, z);
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     PolyP     = _mm_mul_pd(P2, z2);
<a name="l00186"></a>00186     PolyP     = _mm_add_pd(PolyP, P1);
<a name="l00187"></a>00187     PolyQ     = _mm_add_pd(z2, Q1);
<a name="l00188"></a>00188     PolyP     = _mm_mul_pd(PolyP, z2);
<a name="l00189"></a>00189     PolyQ     = _mm_mul_pd(PolyQ, z2);
<a name="l00190"></a>00190     PolyP     = _mm_add_pd(PolyP, P0);
<a name="l00191"></a>00191     PolyQ     = _mm_add_pd(PolyQ, Q0);
<a name="l00192"></a>00192     PolyP     = _mm_mul_pd(PolyP, z);
<a name="l00193"></a>00193 
<a name="l00194"></a>00194     z         = _mm_mul_pd(PolyP, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(_mm_sub_pd(PolyQ, PolyP)));
<a name="l00195"></a>00195     z         = _mm_add_pd(one, _mm_mul_pd(two, z));
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     z         = _mm_mul_pd(z, fexppart);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     <span class="keywordflow">return</span> <a class="code" href="include_2gmx__arpack_8h.html#a4f5dbf2e71c295ecca7ff4214e90ba91">z</a>;
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="comment">/* Exponential function. This could be calculated from 2^x as Exp(x)=2^(y), where y=log2(e)*x,</span>
<a name="l00203"></a>00203 <span class="comment"> * but there will then be a small rounding error since we lose some precision due to the</span>
<a name="l00204"></a>00204 <span class="comment"> * multiplication. This will then be magnified a lot by the exponential.</span>
<a name="l00205"></a>00205 <span class="comment"> *</span>
<a name="l00206"></a>00206 <span class="comment"> * Instead, we calculate the fractional part directly as a Padé approximation of</span>
<a name="l00207"></a>00207 <span class="comment"> * Exp(z) on [-0.5,0.5]. We use extended precision arithmetics to calculate the fraction</span>
<a name="l00208"></a>00208 <span class="comment"> * remaining after 2^y, which avoids the precision-loss.</span>
<a name="l00209"></a>00209 <span class="comment"> */</span>
<a name="l00210"></a>00210 <span class="keyword">static</span> __m128d
<a name="l00211"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a124c3aacdbc15f6181542a96e81b9103">00211</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a124c3aacdbc15f6181542a96e81b9103">gmx_mm_exp_pd</a>(__m128d exparg)
<a name="l00212"></a>00212 {
<a name="l00213"></a>00213     <span class="keyword">const</span> __m128d argscale = _mm_set1_pd(1.4426950408889634073599);
<a name="l00214"></a>00214     <span class="comment">/* Lower bound: We do not allow numbers that would lead to an IEEE fp representation exponent smaller than -126. */</span>
<a name="l00215"></a>00215     <span class="keyword">const</span> __m128d arglimit = _mm_set1_pd(1022.0);
<a name="l00216"></a>00216     <span class="keyword">const</span> __m128i expbase  = _mm_set1_epi32(1023);
<a name="l00217"></a>00217 
<a name="l00218"></a>00218     <span class="keyword">const</span> __m128d invargscale0  = _mm_set1_pd(6.93145751953125<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-1);
<a name="l00219"></a>00219     <span class="keyword">const</span> __m128d invargscale1  = _mm_set1_pd(1.42860682030941723212<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-6);
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     <span class="keyword">const</span> __m128d P2       = _mm_set1_pd(1.26177193074810590878<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-4);
<a name="l00222"></a>00222     <span class="keyword">const</span> __m128d P1       = _mm_set1_pd(3.02994407707441961300<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-2);
<a name="l00223"></a>00223     <span class="comment">/* P0 == 1.0 */</span>
<a name="l00224"></a>00224     <span class="keyword">const</span> __m128d Q3       = _mm_set1_pd(3.00198505138664455042E-6);
<a name="l00225"></a>00225     <span class="keyword">const</span> __m128d Q2       = _mm_set1_pd(2.52448340349684104192E-3);
<a name="l00226"></a>00226     <span class="keyword">const</span> __m128d Q1       = _mm_set1_pd(2.27265548208155028766E-1);
<a name="l00227"></a>00227     <span class="comment">/* Q0 == 2.0 */</span>
<a name="l00228"></a>00228     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#ada85e349d35971b32c8ea4238881ff8b">one</a>      = _mm_set1_pd(1.0);
<a name="l00229"></a>00229     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#a45c15ebfa63fa10683ebce401df0b836">two</a>      = _mm_set1_pd(2.0);
<a name="l00230"></a>00230 
<a name="l00231"></a>00231     __m128d       valuemask;
<a name="l00232"></a>00232     __m128i       iexppart;
<a name="l00233"></a>00233     __m128d       fexppart;
<a name="l00234"></a>00234     __m128d       intpart;
<a name="l00235"></a>00235     __m128d       <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>, <a class="code" href="include_2gmx__arpack_8h.html#a4f5dbf2e71c295ecca7ff4214e90ba91">z</a>, z2;
<a name="l00236"></a>00236     __m128d       PolyP, PolyQ;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238     x             = _mm_mul_pd(exparg, argscale);
<a name="l00239"></a>00239 
<a name="l00240"></a>00240     iexppart  = _mm_cvtpd_epi32(x);
<a name="l00241"></a>00241     intpart   = _mm_round_pd(x, _MM_FROUND_TO_NEAREST_INT);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <span class="comment">/* The two lowest elements of iexppart now contains 32-bit numbers with a correctly biased exponent.</span>
<a name="l00244"></a>00244 <span class="comment">     * To be able to shift it into the exponent for a double precision number we first need to</span>
<a name="l00245"></a>00245 <span class="comment">     * shuffle so that the lower half contains the first element, and the upper half the second.</span>
<a name="l00246"></a>00246 <span class="comment">     * This should really be done as a zero-extension, but since the next instructions will shift</span>
<a name="l00247"></a>00247 <span class="comment">     * the registers left by 52 bits it doesn&#39;t matter what we put there - it will be shifted out.</span>
<a name="l00248"></a>00248 <span class="comment">     * (thus we just use element 2 from iexppart).</span>
<a name="l00249"></a>00249 <span class="comment">     */</span>
<a name="l00250"></a>00250     iexppart  = _mm_shuffle_epi32(iexppart, _MM_SHUFFLE(2, 1, 2, 0));
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     <span class="comment">/* Do the shift operation on the 64-bit registers */</span>
<a name="l00253"></a>00253     iexppart  = _mm_add_epi32(iexppart, expbase);
<a name="l00254"></a>00254     iexppart  = _mm_slli_epi64(iexppart, 52);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256     valuemask = _mm_cmpge_pd(arglimit, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a935221f94a86b3f7a14c8956f8538a2e">gmx_mm_abs_pd</a>(x));
<a name="l00257"></a>00257     fexppart  = _mm_and_pd(valuemask, <a class="code" href="include_2gmx__x86__avx__128__fma_8h.html#a15d96a23ac5f6569e6d35e73ea186589">gmx_mm_castsi128_pd</a>(iexppart));
<a name="l00258"></a>00258 
<a name="l00259"></a>00259     z         = _mm_sub_pd(exparg, _mm_mul_pd(invargscale0, intpart));
<a name="l00260"></a>00260     z         = _mm_sub_pd(z, _mm_mul_pd(invargscale1, intpart));
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     z2        = _mm_mul_pd(z, z);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     PolyQ     = _mm_mul_pd(Q3, z2);
<a name="l00265"></a>00265     PolyQ     = _mm_add_pd(PolyQ, Q2);
<a name="l00266"></a>00266     PolyP     = _mm_mul_pd(P2, z2);
<a name="l00267"></a>00267     PolyQ     = _mm_mul_pd(PolyQ, z2);
<a name="l00268"></a>00268     PolyP     = _mm_add_pd(PolyP, P1);
<a name="l00269"></a>00269     PolyQ     = _mm_add_pd(PolyQ, Q1);
<a name="l00270"></a>00270     PolyP     = _mm_mul_pd(PolyP, z2);
<a name="l00271"></a>00271     PolyQ     = _mm_mul_pd(PolyQ, z2);
<a name="l00272"></a>00272     PolyP     = _mm_add_pd(PolyP, one);
<a name="l00273"></a>00273     PolyQ     = _mm_add_pd(PolyQ, two);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     PolyP     = _mm_mul_pd(PolyP, z);
<a name="l00276"></a>00276 
<a name="l00277"></a>00277     z         = _mm_mul_pd(PolyP, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(_mm_sub_pd(PolyQ, PolyP)));
<a name="l00278"></a>00278     z         = _mm_add_pd(one, _mm_mul_pd(two, z));
<a name="l00279"></a>00279 
<a name="l00280"></a>00280     z         = _mm_mul_pd(z, fexppart);
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     <span class="keywordflow">return</span> <a class="code" href="include_2gmx__arpack_8h.html#a4f5dbf2e71c295ecca7ff4214e90ba91">z</a>;
<a name="l00283"></a>00283 }
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="keyword">static</span> __m128d
<a name="l00288"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a3d8d3f2cd376efb8aea0735e6f840711">00288</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a3d8d3f2cd376efb8aea0735e6f840711">gmx_mm_log_pd</a>(__m128d <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>)
<a name="l00289"></a>00289 {
<a name="l00290"></a>00290     <span class="comment">/* Same algorithm as cephes library */</span>
<a name="l00291"></a>00291     <span class="keyword">const</span> __m128d expmask    = <a class="code" href="include_2gmx__x86__avx__128__fma_8h.html#a15d96a23ac5f6569e6d35e73ea186589">gmx_mm_castsi128_pd</a>( _mm_set_epi32(0x7FF00000, 0x00000000, 0x7FF00000, 0x00000000) );
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     <span class="keyword">const</span> __m128i expbase_m1 = _mm_set1_epi32(1023-1); <span class="comment">/* We want non-IEEE format */</span>
<a name="l00294"></a>00294 
<a name="l00295"></a>00295     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#a701d1f7de8380226dbc8825672ae4ef0">half</a>       = _mm_set1_pd(0.5);
<a name="l00296"></a>00296     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#ada85e349d35971b32c8ea4238881ff8b">one</a>        = _mm_set1_pd(1.0);
<a name="l00297"></a>00297     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#a45c15ebfa63fa10683ebce401df0b836">two</a>        = _mm_set1_pd(2.0);
<a name="l00298"></a>00298     <span class="keyword">const</span> __m128d invsq2     = _mm_set1_pd(1.0/sqrt(2.0));
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="keyword">const</span> __m128d corr1      = _mm_set1_pd(-2.121944400546905827679<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-4);
<a name="l00301"></a>00301     <span class="keyword">const</span> __m128d corr2      = _mm_set1_pd(0.693359375);
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     <span class="keyword">const</span> __m128d P5         = _mm_set1_pd(1.01875663804580931796<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-4);
<a name="l00304"></a>00304     <span class="keyword">const</span> __m128d P4         = _mm_set1_pd(4.97494994976747001425<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-1);
<a name="l00305"></a>00305     <span class="keyword">const</span> __m128d P3         = _mm_set1_pd(4.70579119878881725854e0);
<a name="l00306"></a>00306     <span class="keyword">const</span> __m128d P2         = _mm_set1_pd(1.44989225341610930846e1);
<a name="l00307"></a>00307     <span class="keyword">const</span> __m128d P1         = _mm_set1_pd(1.79368678507819816313e1);
<a name="l00308"></a>00308     <span class="keyword">const</span> __m128d P0         = _mm_set1_pd(7.70838733755885391666e0);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     <span class="keyword">const</span> __m128d Q4         = _mm_set1_pd(1.12873587189167450590e1);
<a name="l00311"></a>00311     <span class="keyword">const</span> __m128d Q3         = _mm_set1_pd(4.52279145837532221105e1);
<a name="l00312"></a>00312     <span class="keyword">const</span> __m128d Q2         = _mm_set1_pd(8.29875266912776603211e1);
<a name="l00313"></a>00313     <span class="keyword">const</span> __m128d Q1         = _mm_set1_pd(7.11544750618563894466e1);
<a name="l00314"></a>00314     <span class="keyword">const</span> __m128d Q0         = _mm_set1_pd(2.31251620126765340583e1);
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     <span class="keyword">const</span> __m128d R2         = _mm_set1_pd(-7.89580278884799154124<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-1);
<a name="l00317"></a>00317     <span class="keyword">const</span> __m128d R1         = _mm_set1_pd(1.63866645699558079767e1);
<a name="l00318"></a>00318     <span class="keyword">const</span> __m128d R0         = _mm_set1_pd(-6.41409952958715622951e1);
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <span class="keyword">const</span> __m128d S2         = _mm_set1_pd(-3.56722798256324312549E1);
<a name="l00321"></a>00321     <span class="keyword">const</span> __m128d S1         = _mm_set1_pd(3.12093766372244180303E2);
<a name="l00322"></a>00322     <span class="keyword">const</span> __m128d S0         = _mm_set1_pd(-7.69691943550460008604E2);
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     __m128d       fexp;
<a name="l00325"></a>00325     __m128i       iexp;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327     __m128d       mask1, mask2;
<a name="l00328"></a>00328     __m128d       corr, t1, t2, <a class="code" href="include_2gmx__lapack_8h.html#ae7eb68b191e2ae9d52d5faa1ccd140d6">q</a>;
<a name="l00329"></a>00329     __m128d       zA, yA, xA, zB, yB, xB, <a class="code" href="include_2gmx__arpack_8h.html#a4f5dbf2e71c295ecca7ff4214e90ba91">z</a>;
<a name="l00330"></a>00330     __m128d       polyR, polyS;
<a name="l00331"></a>00331     __m128d       polyP1, polyP2, polyQ1, polyQ2;
<a name="l00332"></a>00332 
<a name="l00333"></a>00333     <span class="comment">/* Separate x into exponent and mantissa, with a mantissa in the range [0.5..1[ (not IEEE754 standard!) */</span>
<a name="l00334"></a>00334     fexp   = _mm_and_pd(x, expmask);
<a name="l00335"></a>00335     iexp   = <a class="code" href="include_2gmx__x86__avx__128__fma_8h.html#ab9c0d5009f958d851a418a56b801b493">gmx_mm_castpd_si128</a>(fexp);
<a name="l00336"></a>00336     iexp   = _mm_srli_epi64(iexp, 52);
<a name="l00337"></a>00337     iexp   = _mm_sub_epi32(iexp, expbase_m1);
<a name="l00338"></a>00338     iexp   = _mm_shuffle_epi32(iexp, _MM_SHUFFLE(1, 1, 2, 0) );
<a name="l00339"></a>00339     fexp   = _mm_cvtepi32_pd(iexp);
<a name="l00340"></a>00340 
<a name="l00341"></a>00341     x      = _mm_andnot_pd(expmask, x);
<a name="l00342"></a>00342     x      = _mm_or_pd(x, one);
<a name="l00343"></a>00343     x      = _mm_mul_pd(x, half);
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     mask1     = _mm_cmpgt_pd(<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a935221f94a86b3f7a14c8956f8538a2e">gmx_mm_abs_pd</a>(fexp), two);
<a name="l00346"></a>00346     mask2     = _mm_cmplt_pd(x, invsq2);
<a name="l00347"></a>00347 
<a name="l00348"></a>00348     fexp   = _mm_sub_pd(fexp, _mm_and_pd(mask2, one));
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     <span class="comment">/* If mask1 is set (&#39;A&#39;) */</span>
<a name="l00351"></a>00351     zA     = _mm_sub_pd(x, half);
<a name="l00352"></a>00352     t1     = _mm_blendv_pd( zA, x, mask2 );
<a name="l00353"></a>00353     zA     = _mm_sub_pd(t1, half);
<a name="l00354"></a>00354     t2     = _mm_blendv_pd( x, zA, mask2 );
<a name="l00355"></a>00355     yA     = _mm_mul_pd(half, _mm_add_pd(t2, one));
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     xA     = _mm_mul_pd(zA, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(yA));
<a name="l00358"></a>00358     zA     = _mm_mul_pd(xA, xA);
<a name="l00359"></a>00359 
<a name="l00360"></a>00360     <span class="comment">/* EVALUATE POLY */</span>
<a name="l00361"></a>00361     polyR  = _mm_mul_pd(R2, zA);
<a name="l00362"></a>00362     polyR  = _mm_add_pd(polyR, R1);
<a name="l00363"></a>00363     polyR  = _mm_mul_pd(polyR, zA);
<a name="l00364"></a>00364     polyR  = _mm_add_pd(polyR, R0);
<a name="l00365"></a>00365 
<a name="l00366"></a>00366     polyS  = _mm_add_pd(zA, S2);
<a name="l00367"></a>00367     polyS  = _mm_mul_pd(polyS, zA);
<a name="l00368"></a>00368     polyS  = _mm_add_pd(polyS, S1);
<a name="l00369"></a>00369     polyS  = _mm_mul_pd(polyS, zA);
<a name="l00370"></a>00370     polyS  = _mm_add_pd(polyS, S0);
<a name="l00371"></a>00371 
<a name="l00372"></a>00372     q      = _mm_mul_pd(polyR, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(polyS));
<a name="l00373"></a>00373     zA     = _mm_mul_pd(_mm_mul_pd(xA, zA), q);
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     zA     = _mm_add_pd(zA, _mm_mul_pd(corr1, fexp));
<a name="l00376"></a>00376     zA     = _mm_add_pd(zA, xA);
<a name="l00377"></a>00377     zA     = _mm_add_pd(zA, _mm_mul_pd(corr2, fexp));
<a name="l00378"></a>00378 
<a name="l00379"></a>00379     <span class="comment">/* If mask1 is not set (&#39;B&#39;) */</span>
<a name="l00380"></a>00380     corr   = _mm_and_pd(mask2, x);
<a name="l00381"></a>00381     xB     = _mm_add_pd(x, corr);
<a name="l00382"></a>00382     xB     = _mm_sub_pd(xB, one);
<a name="l00383"></a>00383     zB     = _mm_mul_pd(xB, xB);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     polyP1 = _mm_mul_pd(P5, zB);
<a name="l00386"></a>00386     polyP2 = _mm_mul_pd(P4, zB);
<a name="l00387"></a>00387     polyP1 = _mm_add_pd(polyP1, P3);
<a name="l00388"></a>00388     polyP2 = _mm_add_pd(polyP2, P2);
<a name="l00389"></a>00389     polyP1 = _mm_mul_pd(polyP1, zB);
<a name="l00390"></a>00390     polyP2 = _mm_mul_pd(polyP2, zB);
<a name="l00391"></a>00391     polyP1 = _mm_add_pd(polyP1, P1);
<a name="l00392"></a>00392     polyP2 = _mm_add_pd(polyP2, P0);
<a name="l00393"></a>00393     polyP1 = _mm_mul_pd(polyP1, xB);
<a name="l00394"></a>00394     polyP1 = _mm_add_pd(polyP1, polyP2);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396     polyQ2 = _mm_mul_pd(Q4, zB);
<a name="l00397"></a>00397     polyQ1 = _mm_add_pd(zB, Q3);
<a name="l00398"></a>00398     polyQ2 = _mm_add_pd(polyQ2, Q2);
<a name="l00399"></a>00399     polyQ1 = _mm_mul_pd(polyQ1, zB);
<a name="l00400"></a>00400     polyQ2 = _mm_mul_pd(polyQ2, zB);
<a name="l00401"></a>00401     polyQ1 = _mm_add_pd(polyQ1, Q1);
<a name="l00402"></a>00402     polyQ2 = _mm_add_pd(polyQ2, Q0);
<a name="l00403"></a>00403     polyQ1 = _mm_mul_pd(polyQ1, xB);
<a name="l00404"></a>00404     polyQ1 = _mm_add_pd(polyQ1, polyQ2);
<a name="l00405"></a>00405 
<a name="l00406"></a>00406     fexp   = _mm_and_pd(fexp, _mm_cmpneq_pd(fexp, _mm_setzero_pd()));
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     q      = _mm_mul_pd(polyP1, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(polyQ1));
<a name="l00409"></a>00409     yB     = _mm_mul_pd(_mm_mul_pd(xB, zB), q);
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     yB     = _mm_add_pd(yB, _mm_mul_pd(corr1, fexp));
<a name="l00412"></a>00412     yB     = _mm_sub_pd(yB, _mm_mul_pd(half, zB));
<a name="l00413"></a>00413     zB     = _mm_add_pd(xB, yB);
<a name="l00414"></a>00414     zB     = _mm_add_pd(zB, _mm_mul_pd(corr2, fexp));
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     z      = _mm_blendv_pd( zB, zA, mask1 );
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     <span class="keywordflow">return</span> <a class="code" href="include_2gmx__arpack_8h.html#a4f5dbf2e71c295ecca7ff4214e90ba91">z</a>;
<a name="l00419"></a>00419 }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 <span class="keyword">static</span> __m128d
<a name="l00423"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a105bd7274e56ade8dfaf7dd53f35b82d">00423</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a105bd7274e56ade8dfaf7dd53f35b82d">gmx_mm_erf_pd</a>(__m128d <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>)
<a name="l00424"></a>00424 {
<a name="l00425"></a>00425     <span class="comment">/* Coefficients for minimax approximation of erf(x)=x*(CAoffset + P(x^2)/Q(x^2)) in range [-0.75,0.75] */</span>
<a name="l00426"></a>00426     <span class="keyword">const</span> __m128d CAP4      = _mm_set1_pd(-0.431780540597889301512<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-4);
<a name="l00427"></a>00427     <span class="keyword">const</span> __m128d CAP3      = _mm_set1_pd(-0.00578562306260059236059);
<a name="l00428"></a>00428     <span class="keyword">const</span> __m128d CAP2      = _mm_set1_pd(-0.028593586920219752446);
<a name="l00429"></a>00429     <span class="keyword">const</span> __m128d CAP1      = _mm_set1_pd(-0.315924962948621698209);
<a name="l00430"></a>00430     <span class="keyword">const</span> __m128d CAP0      = _mm_set1_pd(0.14952975608477029151);
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     <span class="keyword">const</span> __m128d CAQ5      = _mm_set1_pd(-0.374089300177174709737<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-5);
<a name="l00433"></a>00433     <span class="keyword">const</span> __m128d CAQ4      = _mm_set1_pd(0.00015126584532155383535);
<a name="l00434"></a>00434     <span class="keyword">const</span> __m128d CAQ3      = _mm_set1_pd(0.00536692680669480725423);
<a name="l00435"></a>00435     <span class="keyword">const</span> __m128d CAQ2      = _mm_set1_pd(0.0668686825594046122636);
<a name="l00436"></a>00436     <span class="keyword">const</span> __m128d CAQ1      = _mm_set1_pd(0.402604990869284362773);
<a name="l00437"></a>00437     <span class="comment">/* CAQ0 == 1.0 */</span>
<a name="l00438"></a>00438     <span class="keyword">const</span> __m128d CAoffset  = _mm_set1_pd(0.9788494110107421875);
<a name="l00439"></a>00439 
<a name="l00440"></a>00440     <span class="comment">/* Coefficients for minimax approximation of erfc(x)=exp(-x^2)*x*(P(x-1)/Q(x-1)) in range [1.0,4.5] */</span>
<a name="l00441"></a>00441     <span class="keyword">const</span> __m128d CBP6      = _mm_set1_pd(2.49650423685462752497647637088<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-10);
<a name="l00442"></a>00442     <span class="keyword">const</span> __m128d CBP5      = _mm_set1_pd(0.00119770193298159629350136085658);
<a name="l00443"></a>00443     <span class="keyword">const</span> __m128d CBP4      = _mm_set1_pd(0.0164944422378370965881008942733);
<a name="l00444"></a>00444     <span class="keyword">const</span> __m128d CBP3      = _mm_set1_pd(0.0984581468691775932063932439252);
<a name="l00445"></a>00445     <span class="keyword">const</span> __m128d CBP2      = _mm_set1_pd(0.317364595806937763843589437418);
<a name="l00446"></a>00446     <span class="keyword">const</span> __m128d CBP1      = _mm_set1_pd(0.554167062641455850932670067075);
<a name="l00447"></a>00447     <span class="keyword">const</span> __m128d CBP0      = _mm_set1_pd(0.427583576155807163756925301060);
<a name="l00448"></a>00448     <span class="keyword">const</span> __m128d CBQ7      = _mm_set1_pd(0.00212288829699830145976198384930);
<a name="l00449"></a>00449     <span class="keyword">const</span> __m128d CBQ6      = _mm_set1_pd(0.0334810979522685300554606393425);
<a name="l00450"></a>00450     <span class="keyword">const</span> __m128d CBQ5      = _mm_set1_pd(0.2361713785181450957579508850717);
<a name="l00451"></a>00451     <span class="keyword">const</span> __m128d CBQ4      = _mm_set1_pd(0.955364736493055670530981883072);
<a name="l00452"></a>00452     <span class="keyword">const</span> __m128d CBQ3      = _mm_set1_pd(2.36815675631420037315349279199);
<a name="l00453"></a>00453     <span class="keyword">const</span> __m128d CBQ2      = _mm_set1_pd(3.55261649184083035537184223542);
<a name="l00454"></a>00454     <span class="keyword">const</span> __m128d CBQ1      = _mm_set1_pd(2.93501136050160872574376997993);
<a name="l00455"></a>00455     <span class="comment">/* CBQ0 == 1.0 */</span>
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     <span class="comment">/* Coefficients for minimax approximation of erfc(x)=exp(-x^2)/x*(P(1/x)/Q(1/x)) in range [4.5,inf] */</span>
<a name="l00458"></a>00458     <span class="keyword">const</span> __m128d CCP6      = _mm_set1_pd(-2.8175401114513378771);
<a name="l00459"></a>00459     <span class="keyword">const</span> __m128d CCP5      = _mm_set1_pd(-3.22729451764143718517);
<a name="l00460"></a>00460     <span class="keyword">const</span> __m128d CCP4      = _mm_set1_pd(-2.5518551727311523996);
<a name="l00461"></a>00461     <span class="keyword">const</span> __m128d CCP3      = _mm_set1_pd(-0.687717681153649930619);
<a name="l00462"></a>00462     <span class="keyword">const</span> __m128d CCP2      = _mm_set1_pd(-0.212652252872804219852);
<a name="l00463"></a>00463     <span class="keyword">const</span> __m128d CCP1      = _mm_set1_pd(0.0175389834052493308818);
<a name="l00464"></a>00464     <span class="keyword">const</span> __m128d CCP0      = _mm_set1_pd(0.00628057170626964891937);
<a name="l00465"></a>00465 
<a name="l00466"></a>00466     <span class="keyword">const</span> __m128d CCQ6      = _mm_set1_pd(5.48409182238641741584);
<a name="l00467"></a>00467     <span class="keyword">const</span> __m128d CCQ5      = _mm_set1_pd(13.5064170191802889145);
<a name="l00468"></a>00468     <span class="keyword">const</span> __m128d CCQ4      = _mm_set1_pd(22.9367376522880577224);
<a name="l00469"></a>00469     <span class="keyword">const</span> __m128d CCQ3      = _mm_set1_pd(15.930646027911794143);
<a name="l00470"></a>00470     <span class="keyword">const</span> __m128d CCQ2      = _mm_set1_pd(11.0567237927800161565);
<a name="l00471"></a>00471     <span class="keyword">const</span> __m128d CCQ1      = _mm_set1_pd(2.79257750980575282228);
<a name="l00472"></a>00472     <span class="comment">/* CCQ0 == 1.0 */</span>
<a name="l00473"></a>00473     <span class="keyword">const</span> __m128d CCoffset  = _mm_set1_pd(0.5579090118408203125);
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#ada85e349d35971b32c8ea4238881ff8b">one</a>       = _mm_set1_pd(1.0);
<a name="l00476"></a>00476     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#a45c15ebfa63fa10683ebce401df0b836">two</a>       = _mm_set1_pd(2.0);
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     <span class="keyword">const</span> __m128d signbit   = <a class="code" href="include_2gmx__x86__avx__128__fma_8h.html#a15d96a23ac5f6569e6d35e73ea186589">gmx_mm_castsi128_pd</a>( _mm_set_epi32(0x80000000, 0x00000000, 0x80000000, 0x00000000) );
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     __m128d       xabs, x2, x4, <a class="code" href="include_2gmx__lapack_8h.html#ae647c0df6f34102f0f7788e940d006cc">t</a>, t2, <a class="code" href="include_2gmx__lapack_8h.html#ab484f49f296361999f2c4ba1e7e95586">w</a>, w2;
<a name="l00481"></a>00481     __m128d       PolyAP0, PolyAP1, PolyAQ0, PolyAQ1;
<a name="l00482"></a>00482     __m128d       PolyBP0, PolyBP1, PolyBQ0, PolyBQ1;
<a name="l00483"></a>00483     __m128d       PolyCP0, PolyCP1, PolyCQ0, PolyCQ1;
<a name="l00484"></a>00484     __m128d       res_erf, res_erfcB, res_erfcC, res_erfc, res;
<a name="l00485"></a>00485     __m128d       mask, expmx2;
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     <span class="comment">/* Calculate erf() */</span>
<a name="l00488"></a>00488     xabs     = <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a935221f94a86b3f7a14c8956f8538a2e">gmx_mm_abs_pd</a>(x);
<a name="l00489"></a>00489     x2       = _mm_mul_pd(x, x);
<a name="l00490"></a>00490     x4       = _mm_mul_pd(x2, x2);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     PolyAP0  = _mm_mul_pd(CAP4, x4);
<a name="l00493"></a>00493     PolyAP1  = _mm_mul_pd(CAP3, x4);
<a name="l00494"></a>00494     PolyAP0  = _mm_add_pd(PolyAP0, CAP2);
<a name="l00495"></a>00495     PolyAP1  = _mm_add_pd(PolyAP1, CAP1);
<a name="l00496"></a>00496     PolyAP0  = _mm_mul_pd(PolyAP0, x4);
<a name="l00497"></a>00497     PolyAP1  = _mm_mul_pd(PolyAP1, x2);
<a name="l00498"></a>00498     PolyAP0  = _mm_add_pd(PolyAP0, CAP0);
<a name="l00499"></a>00499     PolyAP0  = _mm_add_pd(PolyAP0, PolyAP1);
<a name="l00500"></a>00500 
<a name="l00501"></a>00501     PolyAQ1  = _mm_mul_pd(CAQ5, x4);
<a name="l00502"></a>00502     PolyAQ0  = _mm_mul_pd(CAQ4, x4);
<a name="l00503"></a>00503     PolyAQ1  = _mm_add_pd(PolyAQ1, CAQ3);
<a name="l00504"></a>00504     PolyAQ0  = _mm_add_pd(PolyAQ0, CAQ2);
<a name="l00505"></a>00505     PolyAQ1  = _mm_mul_pd(PolyAQ1, x4);
<a name="l00506"></a>00506     PolyAQ0  = _mm_mul_pd(PolyAQ0, x4);
<a name="l00507"></a>00507     PolyAQ1  = _mm_add_pd(PolyAQ1, CAQ1);
<a name="l00508"></a>00508     PolyAQ0  = _mm_add_pd(PolyAQ0, one);
<a name="l00509"></a>00509     PolyAQ1  = _mm_mul_pd(PolyAQ1, x2);
<a name="l00510"></a>00510     PolyAQ0  = _mm_add_pd(PolyAQ0, PolyAQ1);
<a name="l00511"></a>00511 
<a name="l00512"></a>00512     res_erf  = _mm_mul_pd(PolyAP0, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(PolyAQ0));
<a name="l00513"></a>00513     res_erf  = _mm_add_pd(CAoffset, res_erf);
<a name="l00514"></a>00514     res_erf  = _mm_mul_pd(x, res_erf);
<a name="l00515"></a>00515 
<a name="l00516"></a>00516     <span class="comment">/* Calculate erfc() in range [1,4.5] */</span>
<a name="l00517"></a>00517     t       = _mm_sub_pd(xabs, one);
<a name="l00518"></a>00518     t2      = _mm_mul_pd(t, t);
<a name="l00519"></a>00519 
<a name="l00520"></a>00520     PolyBP0  = _mm_mul_pd(CBP6, t2);
<a name="l00521"></a>00521     PolyBP1  = _mm_mul_pd(CBP5, t2);
<a name="l00522"></a>00522     PolyBP0  = _mm_add_pd(PolyBP0, CBP4);
<a name="l00523"></a>00523     PolyBP1  = _mm_add_pd(PolyBP1, CBP3);
<a name="l00524"></a>00524     PolyBP0  = _mm_mul_pd(PolyBP0, t2);
<a name="l00525"></a>00525     PolyBP1  = _mm_mul_pd(PolyBP1, t2);
<a name="l00526"></a>00526     PolyBP0  = _mm_add_pd(PolyBP0, CBP2);
<a name="l00527"></a>00527     PolyBP1  = _mm_add_pd(PolyBP1, CBP1);
<a name="l00528"></a>00528     PolyBP0  = _mm_mul_pd(PolyBP0, t2);
<a name="l00529"></a>00529     PolyBP1  = _mm_mul_pd(PolyBP1, t);
<a name="l00530"></a>00530     PolyBP0  = _mm_add_pd(PolyBP0, CBP0);
<a name="l00531"></a>00531     PolyBP0  = _mm_add_pd(PolyBP0, PolyBP1);
<a name="l00532"></a>00532 
<a name="l00533"></a>00533     PolyBQ1 = _mm_mul_pd(CBQ7, t2);
<a name="l00534"></a>00534     PolyBQ0 = _mm_mul_pd(CBQ6, t2);
<a name="l00535"></a>00535     PolyBQ1 = _mm_add_pd(PolyBQ1, CBQ5);
<a name="l00536"></a>00536     PolyBQ0 = _mm_add_pd(PolyBQ0, CBQ4);
<a name="l00537"></a>00537     PolyBQ1 = _mm_mul_pd(PolyBQ1, t2);
<a name="l00538"></a>00538     PolyBQ0 = _mm_mul_pd(PolyBQ0, t2);
<a name="l00539"></a>00539     PolyBQ1 = _mm_add_pd(PolyBQ1, CBQ3);
<a name="l00540"></a>00540     PolyBQ0 = _mm_add_pd(PolyBQ0, CBQ2);
<a name="l00541"></a>00541     PolyBQ1 = _mm_mul_pd(PolyBQ1, t2);
<a name="l00542"></a>00542     PolyBQ0 = _mm_mul_pd(PolyBQ0, t2);
<a name="l00543"></a>00543     PolyBQ1 = _mm_add_pd(PolyBQ1, CBQ1);
<a name="l00544"></a>00544     PolyBQ0 = _mm_add_pd(PolyBQ0, one);
<a name="l00545"></a>00545     PolyBQ1 = _mm_mul_pd(PolyBQ1, t);
<a name="l00546"></a>00546     PolyBQ0 = _mm_add_pd(PolyBQ0, PolyBQ1);
<a name="l00547"></a>00547 
<a name="l00548"></a>00548     res_erfcB = _mm_mul_pd(PolyBP0, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(PolyBQ0));
<a name="l00549"></a>00549 
<a name="l00550"></a>00550     res_erfcB = _mm_mul_pd(res_erfcB, xabs);
<a name="l00551"></a>00551 
<a name="l00552"></a>00552     <span class="comment">/* Calculate erfc() in range [4.5,inf] */</span>
<a name="l00553"></a>00553     w       = <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(xabs);
<a name="l00554"></a>00554     w2      = _mm_mul_pd(w, w);
<a name="l00555"></a>00555 
<a name="l00556"></a>00556     PolyCP0  = _mm_mul_pd(CCP6, w2);
<a name="l00557"></a>00557     PolyCP1  = _mm_mul_pd(CCP5, w2);
<a name="l00558"></a>00558     PolyCP0  = _mm_add_pd(PolyCP0, CCP4);
<a name="l00559"></a>00559     PolyCP1  = _mm_add_pd(PolyCP1, CCP3);
<a name="l00560"></a>00560     PolyCP0  = _mm_mul_pd(PolyCP0, w2);
<a name="l00561"></a>00561     PolyCP1  = _mm_mul_pd(PolyCP1, w2);
<a name="l00562"></a>00562     PolyCP0  = _mm_add_pd(PolyCP0, CCP2);
<a name="l00563"></a>00563     PolyCP1  = _mm_add_pd(PolyCP1, CCP1);
<a name="l00564"></a>00564     PolyCP0  = _mm_mul_pd(PolyCP0, w2);
<a name="l00565"></a>00565     PolyCP1  = _mm_mul_pd(PolyCP1, w);
<a name="l00566"></a>00566     PolyCP0  = _mm_add_pd(PolyCP0, CCP0);
<a name="l00567"></a>00567     PolyCP0  = _mm_add_pd(PolyCP0, PolyCP1);
<a name="l00568"></a>00568 
<a name="l00569"></a>00569     PolyCQ0  = _mm_mul_pd(CCQ6, w2);
<a name="l00570"></a>00570     PolyCQ1  = _mm_mul_pd(CCQ5, w2);
<a name="l00571"></a>00571     PolyCQ0  = _mm_add_pd(PolyCQ0, CCQ4);
<a name="l00572"></a>00572     PolyCQ1  = _mm_add_pd(PolyCQ1, CCQ3);
<a name="l00573"></a>00573     PolyCQ0  = _mm_mul_pd(PolyCQ0, w2);
<a name="l00574"></a>00574     PolyCQ1  = _mm_mul_pd(PolyCQ1, w2);
<a name="l00575"></a>00575     PolyCQ0  = _mm_add_pd(PolyCQ0, CCQ2);
<a name="l00576"></a>00576     PolyCQ1  = _mm_add_pd(PolyCQ1, CCQ1);
<a name="l00577"></a>00577     PolyCQ0  = _mm_mul_pd(PolyCQ0, w2);
<a name="l00578"></a>00578     PolyCQ1  = _mm_mul_pd(PolyCQ1, w);
<a name="l00579"></a>00579     PolyCQ0  = _mm_add_pd(PolyCQ0, one);
<a name="l00580"></a>00580     PolyCQ0  = _mm_add_pd(PolyCQ0, PolyCQ1);
<a name="l00581"></a>00581 
<a name="l00582"></a>00582     expmx2   = <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a124c3aacdbc15f6181542a96e81b9103">gmx_mm_exp_pd</a>( _mm_or_pd(signbit, x2) );
<a name="l00583"></a>00583 
<a name="l00584"></a>00584     res_erfcC = _mm_mul_pd(PolyCP0, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(PolyCQ0));
<a name="l00585"></a>00585     res_erfcC = _mm_add_pd(res_erfcC, CCoffset);
<a name="l00586"></a>00586     res_erfcC = _mm_mul_pd(res_erfcC, w);
<a name="l00587"></a>00587 
<a name="l00588"></a>00588     mask     = _mm_cmpgt_pd(xabs, _mm_set1_pd(4.5));
<a name="l00589"></a>00589     res_erfc = _mm_blendv_pd(res_erfcB, res_erfcC, mask);
<a name="l00590"></a>00590 
<a name="l00591"></a>00591     res_erfc = _mm_mul_pd(res_erfc, expmx2);
<a name="l00592"></a>00592 
<a name="l00593"></a>00593     <span class="comment">/* erfc(x&lt;0) = 2-erfc(|x|) */</span>
<a name="l00594"></a>00594     mask     = _mm_cmplt_pd(x, _mm_setzero_pd());
<a name="l00595"></a>00595     res_erfc = _mm_blendv_pd(res_erfc, _mm_sub_pd(two, res_erfc), mask);
<a name="l00596"></a>00596 
<a name="l00597"></a>00597     <span class="comment">/* Select erf() or erfc() */</span>
<a name="l00598"></a>00598     mask = _mm_cmplt_pd(xabs, one);
<a name="l00599"></a>00599     res  = _mm_blendv_pd(_mm_sub_pd(one, res_erfc), res_erf, mask);
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <span class="keywordflow">return</span> res;
<a name="l00602"></a>00602 }
<a name="l00603"></a>00603 
<a name="l00604"></a>00604 
<a name="l00605"></a>00605 <span class="keyword">static</span> __m128d
<a name="l00606"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a06c9cb58f6c10feaf25dd133c20b0686">00606</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a06c9cb58f6c10feaf25dd133c20b0686">gmx_mm_erfc_pd</a>(__m128d <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>)
<a name="l00607"></a>00607 {
<a name="l00608"></a>00608     <span class="comment">/* Coefficients for minimax approximation of erf(x)=x*(CAoffset + P(x^2)/Q(x^2)) in range [-0.75,0.75] */</span>
<a name="l00609"></a>00609     <span class="keyword">const</span> __m128d CAP4      = _mm_set1_pd(-0.431780540597889301512<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-4);
<a name="l00610"></a>00610     <span class="keyword">const</span> __m128d CAP3      = _mm_set1_pd(-0.00578562306260059236059);
<a name="l00611"></a>00611     <span class="keyword">const</span> __m128d CAP2      = _mm_set1_pd(-0.028593586920219752446);
<a name="l00612"></a>00612     <span class="keyword">const</span> __m128d CAP1      = _mm_set1_pd(-0.315924962948621698209);
<a name="l00613"></a>00613     <span class="keyword">const</span> __m128d CAP0      = _mm_set1_pd(0.14952975608477029151);
<a name="l00614"></a>00614 
<a name="l00615"></a>00615     <span class="keyword">const</span> __m128d CAQ5      = _mm_set1_pd(-0.374089300177174709737<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-5);
<a name="l00616"></a>00616     <span class="keyword">const</span> __m128d CAQ4      = _mm_set1_pd(0.00015126584532155383535);
<a name="l00617"></a>00617     <span class="keyword">const</span> __m128d CAQ3      = _mm_set1_pd(0.00536692680669480725423);
<a name="l00618"></a>00618     <span class="keyword">const</span> __m128d CAQ2      = _mm_set1_pd(0.0668686825594046122636);
<a name="l00619"></a>00619     <span class="keyword">const</span> __m128d CAQ1      = _mm_set1_pd(0.402604990869284362773);
<a name="l00620"></a>00620     <span class="comment">/* CAQ0 == 1.0 */</span>
<a name="l00621"></a>00621     <span class="keyword">const</span> __m128d CAoffset  = _mm_set1_pd(0.9788494110107421875);
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     <span class="comment">/* Coefficients for minimax approximation of erfc(x)=exp(-x^2)*x*(P(x-1)/Q(x-1)) in range [1.0,4.5] */</span>
<a name="l00624"></a>00624     <span class="keyword">const</span> __m128d CBP6      = _mm_set1_pd(2.49650423685462752497647637088<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-10);
<a name="l00625"></a>00625     <span class="keyword">const</span> __m128d CBP5      = _mm_set1_pd(0.00119770193298159629350136085658);
<a name="l00626"></a>00626     <span class="keyword">const</span> __m128d CBP4      = _mm_set1_pd(0.0164944422378370965881008942733);
<a name="l00627"></a>00627     <span class="keyword">const</span> __m128d CBP3      = _mm_set1_pd(0.0984581468691775932063932439252);
<a name="l00628"></a>00628     <span class="keyword">const</span> __m128d CBP2      = _mm_set1_pd(0.317364595806937763843589437418);
<a name="l00629"></a>00629     <span class="keyword">const</span> __m128d CBP1      = _mm_set1_pd(0.554167062641455850932670067075);
<a name="l00630"></a>00630     <span class="keyword">const</span> __m128d CBP0      = _mm_set1_pd(0.427583576155807163756925301060);
<a name="l00631"></a>00631     <span class="keyword">const</span> __m128d CBQ7      = _mm_set1_pd(0.00212288829699830145976198384930);
<a name="l00632"></a>00632     <span class="keyword">const</span> __m128d CBQ6      = _mm_set1_pd(0.0334810979522685300554606393425);
<a name="l00633"></a>00633     <span class="keyword">const</span> __m128d CBQ5      = _mm_set1_pd(0.2361713785181450957579508850717);
<a name="l00634"></a>00634     <span class="keyword">const</span> __m128d CBQ4      = _mm_set1_pd(0.955364736493055670530981883072);
<a name="l00635"></a>00635     <span class="keyword">const</span> __m128d CBQ3      = _mm_set1_pd(2.36815675631420037315349279199);
<a name="l00636"></a>00636     <span class="keyword">const</span> __m128d CBQ2      = _mm_set1_pd(3.55261649184083035537184223542);
<a name="l00637"></a>00637     <span class="keyword">const</span> __m128d CBQ1      = _mm_set1_pd(2.93501136050160872574376997993);
<a name="l00638"></a>00638     <span class="comment">/* CBQ0 == 1.0 */</span>
<a name="l00639"></a>00639 
<a name="l00640"></a>00640     <span class="comment">/* Coefficients for minimax approximation of erfc(x)=exp(-x^2)/x*(P(1/x)/Q(1/x)) in range [4.5,inf] */</span>
<a name="l00641"></a>00641     <span class="keyword">const</span> __m128d CCP6      = _mm_set1_pd(-2.8175401114513378771);
<a name="l00642"></a>00642     <span class="keyword">const</span> __m128d CCP5      = _mm_set1_pd(-3.22729451764143718517);
<a name="l00643"></a>00643     <span class="keyword">const</span> __m128d CCP4      = _mm_set1_pd(-2.5518551727311523996);
<a name="l00644"></a>00644     <span class="keyword">const</span> __m128d CCP3      = _mm_set1_pd(-0.687717681153649930619);
<a name="l00645"></a>00645     <span class="keyword">const</span> __m128d CCP2      = _mm_set1_pd(-0.212652252872804219852);
<a name="l00646"></a>00646     <span class="keyword">const</span> __m128d CCP1      = _mm_set1_pd(0.0175389834052493308818);
<a name="l00647"></a>00647     <span class="keyword">const</span> __m128d CCP0      = _mm_set1_pd(0.00628057170626964891937);
<a name="l00648"></a>00648 
<a name="l00649"></a>00649     <span class="keyword">const</span> __m128d CCQ6      = _mm_set1_pd(5.48409182238641741584);
<a name="l00650"></a>00650     <span class="keyword">const</span> __m128d CCQ5      = _mm_set1_pd(13.5064170191802889145);
<a name="l00651"></a>00651     <span class="keyword">const</span> __m128d CCQ4      = _mm_set1_pd(22.9367376522880577224);
<a name="l00652"></a>00652     <span class="keyword">const</span> __m128d CCQ3      = _mm_set1_pd(15.930646027911794143);
<a name="l00653"></a>00653     <span class="keyword">const</span> __m128d CCQ2      = _mm_set1_pd(11.0567237927800161565);
<a name="l00654"></a>00654     <span class="keyword">const</span> __m128d CCQ1      = _mm_set1_pd(2.79257750980575282228);
<a name="l00655"></a>00655     <span class="comment">/* CCQ0 == 1.0 */</span>
<a name="l00656"></a>00656     <span class="keyword">const</span> __m128d CCoffset  = _mm_set1_pd(0.5579090118408203125);
<a name="l00657"></a>00657 
<a name="l00658"></a>00658     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#ada85e349d35971b32c8ea4238881ff8b">one</a>       = _mm_set1_pd(1.0);
<a name="l00659"></a>00659     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#a45c15ebfa63fa10683ebce401df0b836">two</a>       = _mm_set1_pd(2.0);
<a name="l00660"></a>00660 
<a name="l00661"></a>00661     <span class="keyword">const</span> __m128d signbit   = <a class="code" href="include_2gmx__x86__avx__128__fma_8h.html#a15d96a23ac5f6569e6d35e73ea186589">gmx_mm_castsi128_pd</a>( _mm_set_epi32(0x80000000, 0x00000000, 0x80000000, 0x00000000) );
<a name="l00662"></a>00662 
<a name="l00663"></a>00663     __m128d       xabs, x2, x4, <a class="code" href="include_2gmx__lapack_8h.html#ae647c0df6f34102f0f7788e940d006cc">t</a>, t2, <a class="code" href="include_2gmx__lapack_8h.html#ab484f49f296361999f2c4ba1e7e95586">w</a>, w2;
<a name="l00664"></a>00664     __m128d       PolyAP0, PolyAP1, PolyAQ0, PolyAQ1;
<a name="l00665"></a>00665     __m128d       PolyBP0, PolyBP1, PolyBQ0, PolyBQ1;
<a name="l00666"></a>00666     __m128d       PolyCP0, PolyCP1, PolyCQ0, PolyCQ1;
<a name="l00667"></a>00667     __m128d       res_erf, res_erfcB, res_erfcC, res_erfc, res;
<a name="l00668"></a>00668     __m128d       mask, expmx2;
<a name="l00669"></a>00669 
<a name="l00670"></a>00670     <span class="comment">/* Calculate erf() */</span>
<a name="l00671"></a>00671     xabs     = <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a935221f94a86b3f7a14c8956f8538a2e">gmx_mm_abs_pd</a>(x);
<a name="l00672"></a>00672     x2       = _mm_mul_pd(x, x);
<a name="l00673"></a>00673     x4       = _mm_mul_pd(x2, x2);
<a name="l00674"></a>00674 
<a name="l00675"></a>00675     PolyAP0  = _mm_mul_pd(CAP4, x4);
<a name="l00676"></a>00676     PolyAP1  = _mm_mul_pd(CAP3, x4);
<a name="l00677"></a>00677     PolyAP0  = _mm_add_pd(PolyAP0, CAP2);
<a name="l00678"></a>00678     PolyAP1  = _mm_add_pd(PolyAP1, CAP1);
<a name="l00679"></a>00679     PolyAP0  = _mm_mul_pd(PolyAP0, x4);
<a name="l00680"></a>00680     PolyAP1  = _mm_mul_pd(PolyAP1, x2);
<a name="l00681"></a>00681     PolyAP0  = _mm_add_pd(PolyAP0, CAP0);
<a name="l00682"></a>00682     PolyAP0  = _mm_add_pd(PolyAP0, PolyAP1);
<a name="l00683"></a>00683 
<a name="l00684"></a>00684     PolyAQ1  = _mm_mul_pd(CAQ5, x4);
<a name="l00685"></a>00685     PolyAQ0  = _mm_mul_pd(CAQ4, x4);
<a name="l00686"></a>00686     PolyAQ1  = _mm_add_pd(PolyAQ1, CAQ3);
<a name="l00687"></a>00687     PolyAQ0  = _mm_add_pd(PolyAQ0, CAQ2);
<a name="l00688"></a>00688     PolyAQ1  = _mm_mul_pd(PolyAQ1, x4);
<a name="l00689"></a>00689     PolyAQ0  = _mm_mul_pd(PolyAQ0, x4);
<a name="l00690"></a>00690     PolyAQ1  = _mm_add_pd(PolyAQ1, CAQ1);
<a name="l00691"></a>00691     PolyAQ0  = _mm_add_pd(PolyAQ0, one);
<a name="l00692"></a>00692     PolyAQ1  = _mm_mul_pd(PolyAQ1, x2);
<a name="l00693"></a>00693     PolyAQ0  = _mm_add_pd(PolyAQ0, PolyAQ1);
<a name="l00694"></a>00694 
<a name="l00695"></a>00695     res_erf  = _mm_mul_pd(PolyAP0, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(PolyAQ0));
<a name="l00696"></a>00696     res_erf  = _mm_add_pd(CAoffset, res_erf);
<a name="l00697"></a>00697     res_erf  = _mm_mul_pd(x, res_erf);
<a name="l00698"></a>00698 
<a name="l00699"></a>00699     <span class="comment">/* Calculate erfc() in range [1,4.5] */</span>
<a name="l00700"></a>00700     t       = _mm_sub_pd(xabs, one);
<a name="l00701"></a>00701     t2      = _mm_mul_pd(t, t);
<a name="l00702"></a>00702 
<a name="l00703"></a>00703     PolyBP0  = _mm_mul_pd(CBP6, t2);
<a name="l00704"></a>00704     PolyBP1  = _mm_mul_pd(CBP5, t2);
<a name="l00705"></a>00705     PolyBP0  = _mm_add_pd(PolyBP0, CBP4);
<a name="l00706"></a>00706     PolyBP1  = _mm_add_pd(PolyBP1, CBP3);
<a name="l00707"></a>00707     PolyBP0  = _mm_mul_pd(PolyBP0, t2);
<a name="l00708"></a>00708     PolyBP1  = _mm_mul_pd(PolyBP1, t2);
<a name="l00709"></a>00709     PolyBP0  = _mm_add_pd(PolyBP0, CBP2);
<a name="l00710"></a>00710     PolyBP1  = _mm_add_pd(PolyBP1, CBP1);
<a name="l00711"></a>00711     PolyBP0  = _mm_mul_pd(PolyBP0, t2);
<a name="l00712"></a>00712     PolyBP1  = _mm_mul_pd(PolyBP1, t);
<a name="l00713"></a>00713     PolyBP0  = _mm_add_pd(PolyBP0, CBP0);
<a name="l00714"></a>00714     PolyBP0  = _mm_add_pd(PolyBP0, PolyBP1);
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     PolyBQ1 = _mm_mul_pd(CBQ7, t2);
<a name="l00717"></a>00717     PolyBQ0 = _mm_mul_pd(CBQ6, t2);
<a name="l00718"></a>00718     PolyBQ1 = _mm_add_pd(PolyBQ1, CBQ5);
<a name="l00719"></a>00719     PolyBQ0 = _mm_add_pd(PolyBQ0, CBQ4);
<a name="l00720"></a>00720     PolyBQ1 = _mm_mul_pd(PolyBQ1, t2);
<a name="l00721"></a>00721     PolyBQ0 = _mm_mul_pd(PolyBQ0, t2);
<a name="l00722"></a>00722     PolyBQ1 = _mm_add_pd(PolyBQ1, CBQ3);
<a name="l00723"></a>00723     PolyBQ0 = _mm_add_pd(PolyBQ0, CBQ2);
<a name="l00724"></a>00724     PolyBQ1 = _mm_mul_pd(PolyBQ1, t2);
<a name="l00725"></a>00725     PolyBQ0 = _mm_mul_pd(PolyBQ0, t2);
<a name="l00726"></a>00726     PolyBQ1 = _mm_add_pd(PolyBQ1, CBQ1);
<a name="l00727"></a>00727     PolyBQ0 = _mm_add_pd(PolyBQ0, one);
<a name="l00728"></a>00728     PolyBQ1 = _mm_mul_pd(PolyBQ1, t);
<a name="l00729"></a>00729     PolyBQ0 = _mm_add_pd(PolyBQ0, PolyBQ1);
<a name="l00730"></a>00730 
<a name="l00731"></a>00731     res_erfcB = _mm_mul_pd(PolyBP0, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(PolyBQ0));
<a name="l00732"></a>00732 
<a name="l00733"></a>00733     res_erfcB = _mm_mul_pd(res_erfcB, xabs);
<a name="l00734"></a>00734 
<a name="l00735"></a>00735     <span class="comment">/* Calculate erfc() in range [4.5,inf] */</span>
<a name="l00736"></a>00736     w       = <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(xabs);
<a name="l00737"></a>00737     w2      = _mm_mul_pd(w, w);
<a name="l00738"></a>00738 
<a name="l00739"></a>00739     PolyCP0  = _mm_mul_pd(CCP6, w2);
<a name="l00740"></a>00740     PolyCP1  = _mm_mul_pd(CCP5, w2);
<a name="l00741"></a>00741     PolyCP0  = _mm_add_pd(PolyCP0, CCP4);
<a name="l00742"></a>00742     PolyCP1  = _mm_add_pd(PolyCP1, CCP3);
<a name="l00743"></a>00743     PolyCP0  = _mm_mul_pd(PolyCP0, w2);
<a name="l00744"></a>00744     PolyCP1  = _mm_mul_pd(PolyCP1, w2);
<a name="l00745"></a>00745     PolyCP0  = _mm_add_pd(PolyCP0, CCP2);
<a name="l00746"></a>00746     PolyCP1  = _mm_add_pd(PolyCP1, CCP1);
<a name="l00747"></a>00747     PolyCP0  = _mm_mul_pd(PolyCP0, w2);
<a name="l00748"></a>00748     PolyCP1  = _mm_mul_pd(PolyCP1, w);
<a name="l00749"></a>00749     PolyCP0  = _mm_add_pd(PolyCP0, CCP0);
<a name="l00750"></a>00750     PolyCP0  = _mm_add_pd(PolyCP0, PolyCP1);
<a name="l00751"></a>00751 
<a name="l00752"></a>00752     PolyCQ0  = _mm_mul_pd(CCQ6, w2);
<a name="l00753"></a>00753     PolyCQ1  = _mm_mul_pd(CCQ5, w2);
<a name="l00754"></a>00754     PolyCQ0  = _mm_add_pd(PolyCQ0, CCQ4);
<a name="l00755"></a>00755     PolyCQ1  = _mm_add_pd(PolyCQ1, CCQ3);
<a name="l00756"></a>00756     PolyCQ0  = _mm_mul_pd(PolyCQ0, w2);
<a name="l00757"></a>00757     PolyCQ1  = _mm_mul_pd(PolyCQ1, w2);
<a name="l00758"></a>00758     PolyCQ0  = _mm_add_pd(PolyCQ0, CCQ2);
<a name="l00759"></a>00759     PolyCQ1  = _mm_add_pd(PolyCQ1, CCQ1);
<a name="l00760"></a>00760     PolyCQ0  = _mm_mul_pd(PolyCQ0, w2);
<a name="l00761"></a>00761     PolyCQ1  = _mm_mul_pd(PolyCQ1, w);
<a name="l00762"></a>00762     PolyCQ0  = _mm_add_pd(PolyCQ0, one);
<a name="l00763"></a>00763     PolyCQ0  = _mm_add_pd(PolyCQ0, PolyCQ1);
<a name="l00764"></a>00764 
<a name="l00765"></a>00765     expmx2   = <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a124c3aacdbc15f6181542a96e81b9103">gmx_mm_exp_pd</a>( _mm_or_pd(signbit, x2) );
<a name="l00766"></a>00766 
<a name="l00767"></a>00767     res_erfcC = _mm_mul_pd(PolyCP0, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(PolyCQ0));
<a name="l00768"></a>00768     res_erfcC = _mm_add_pd(res_erfcC, CCoffset);
<a name="l00769"></a>00769     res_erfcC = _mm_mul_pd(res_erfcC, w);
<a name="l00770"></a>00770 
<a name="l00771"></a>00771     mask     = _mm_cmpgt_pd(xabs, _mm_set1_pd(4.5));
<a name="l00772"></a>00772     res_erfc = _mm_blendv_pd(res_erfcB, res_erfcC, mask);
<a name="l00773"></a>00773 
<a name="l00774"></a>00774     res_erfc = _mm_mul_pd(res_erfc, expmx2);
<a name="l00775"></a>00775 
<a name="l00776"></a>00776     <span class="comment">/* erfc(x&lt;0) = 2-erfc(|x|) */</span>
<a name="l00777"></a>00777     mask     = _mm_cmplt_pd(x, _mm_setzero_pd());
<a name="l00778"></a>00778     res_erfc = _mm_blendv_pd(res_erfc, _mm_sub_pd(two, res_erfc), mask);
<a name="l00779"></a>00779 
<a name="l00780"></a>00780     <span class="comment">/* Select erf() or erfc() */</span>
<a name="l00781"></a>00781     mask = _mm_cmplt_pd(xabs, one);
<a name="l00782"></a>00782     res  = _mm_blendv_pd(res_erfc, _mm_sub_pd(one, res_erf), mask);
<a name="l00783"></a>00783 
<a name="l00784"></a>00784     <span class="keywordflow">return</span> res;
<a name="l00785"></a>00785 }
<a name="l00786"></a>00786 
<a name="l00787"></a>00787 
<a name="l00788"></a>00788 <span class="comment">/* Calculate the force correction due to PME analytically.</span>
<a name="l00789"></a>00789 <span class="comment"> *</span>
<a name="l00790"></a>00790 <span class="comment"> * This routine is meant to enable analytical evaluation of the</span>
<a name="l00791"></a>00791 <span class="comment"> * direct-space PME electrostatic force to avoid tables.</span>
<a name="l00792"></a>00792 <span class="comment"> *</span>
<a name="l00793"></a>00793 <span class="comment"> * The direct-space potential should be Erfc(beta*r)/r, but there</span>
<a name="l00794"></a>00794 <span class="comment"> * are some problems evaluating that:</span>
<a name="l00795"></a>00795 <span class="comment"> *</span>
<a name="l00796"></a>00796 <span class="comment"> * First, the error function is difficult (read: expensive) to</span>
<a name="l00797"></a>00797 <span class="comment"> * approxmiate accurately for intermediate to large arguments, and</span>
<a name="l00798"></a>00798 <span class="comment"> * this happens already in ranges of beta*r that occur in simulations.</span>
<a name="l00799"></a>00799 <span class="comment"> * Second, we now try to avoid calculating potentials in Gromacs but</span>
<a name="l00800"></a>00800 <span class="comment"> * use forces directly.</span>
<a name="l00801"></a>00801 <span class="comment"> *</span>
<a name="l00802"></a>00802 <span class="comment"> * We can simply things slight by noting that the PME part is really</span>
<a name="l00803"></a>00803 <span class="comment"> * a correction to the normal Coulomb force since Erfc(z)=1-Erf(z), i.e.</span>
<a name="l00804"></a>00804 <span class="comment"> *</span>
<a name="l00805"></a>00805 <span class="comment"> * V= 1/r - Erf(beta*r)/r</span>
<a name="l00806"></a>00806 <span class="comment"> *</span>
<a name="l00807"></a>00807 <span class="comment"> * The first term we already have from the inverse square root, so</span>
<a name="l00808"></a>00808 <span class="comment"> * that we can leave out of this routine.</span>
<a name="l00809"></a>00809 <span class="comment"> *</span>
<a name="l00810"></a>00810 <span class="comment"> * For pme tolerances of 1e-3 to 1e-8 and cutoffs of 0.5nm to 1.8nm,</span>
<a name="l00811"></a>00811 <span class="comment"> * the argument beta*r will be in the range 0.15 to ~4. Use your</span>
<a name="l00812"></a>00812 <span class="comment"> * favorite plotting program to realize how well-behaved Erf(z)/z is</span>
<a name="l00813"></a>00813 <span class="comment"> * in this range!</span>
<a name="l00814"></a>00814 <span class="comment"> *</span>
<a name="l00815"></a>00815 <span class="comment"> * We approximate f(z)=erf(z)/z with a rational minimax polynomial.</span>
<a name="l00816"></a>00816 <span class="comment"> * However, it turns out it is more efficient to approximate f(z)/z and</span>
<a name="l00817"></a>00817 <span class="comment"> * then only use even powers. This is another minor optimization, since</span>
<a name="l00818"></a>00818 <span class="comment"> * we actually WANT f(z)/z, because it is going to be multiplied by</span>
<a name="l00819"></a>00819 <span class="comment"> * the vector between the two atoms to get the vectorial force. The</span>
<a name="l00820"></a>00820 <span class="comment"> * fastest flops are the ones we can avoid calculating!</span>
<a name="l00821"></a>00821 <span class="comment"> *</span>
<a name="l00822"></a>00822 <span class="comment"> * So, here&#39;s how it should be used:</span>
<a name="l00823"></a>00823 <span class="comment"> *</span>
<a name="l00824"></a>00824 <span class="comment"> * 1. Calculate r^2.</span>
<a name="l00825"></a>00825 <span class="comment"> * 2. Multiply by beta^2, so you get z^2=beta^2*r^2.</span>
<a name="l00826"></a>00826 <span class="comment"> * 3. Evaluate this routine with z^2 as the argument.</span>
<a name="l00827"></a>00827 <span class="comment"> * 4. The return value is the expression:</span>
<a name="l00828"></a>00828 <span class="comment"> *</span>
<a name="l00829"></a>00829 <span class="comment"> *</span>
<a name="l00830"></a>00830 <span class="comment"> *       2*exp(-z^2)     erf(z)</span>
<a name="l00831"></a>00831 <span class="comment"> *       ------------ - --------</span>
<a name="l00832"></a>00832 <span class="comment"> *       sqrt(Pi)*z^2      z^3</span>
<a name="l00833"></a>00833 <span class="comment"> *</span>
<a name="l00834"></a>00834 <span class="comment"> * 5. Multiply the entire expression by beta^3. This will get you</span>
<a name="l00835"></a>00835 <span class="comment"> *</span>
<a name="l00836"></a>00836 <span class="comment"> *       beta^3*2*exp(-z^2)     beta^3*erf(z)</span>
<a name="l00837"></a>00837 <span class="comment"> *       ------------------  - ---------------</span>
<a name="l00838"></a>00838 <span class="comment"> *          sqrt(Pi)*z^2            z^3</span>
<a name="l00839"></a>00839 <span class="comment"> *</span>
<a name="l00840"></a>00840 <span class="comment"> *    or, switching back to r (z=r*beta):</span>
<a name="l00841"></a>00841 <span class="comment"> *</span>
<a name="l00842"></a>00842 <span class="comment"> *       2*beta*exp(-r^2*beta^2)   erf(r*beta)</span>
<a name="l00843"></a>00843 <span class="comment"> *       ----------------------- - -----------</span>
<a name="l00844"></a>00844 <span class="comment"> *            sqrt(Pi)*r^2            r^3</span>
<a name="l00845"></a>00845 <span class="comment"> *</span>
<a name="l00846"></a>00846 <span class="comment"> *</span>
<a name="l00847"></a>00847 <span class="comment"> *    With a bit of math exercise you should be able to confirm that</span>
<a name="l00848"></a>00848 <span class="comment"> *    this is exactly D[Erf[beta*r]/r,r] divided by r another time.</span>
<a name="l00849"></a>00849 <span class="comment"> *</span>
<a name="l00850"></a>00850 <span class="comment"> * 6. Add the result to 1/r^3, multiply by the product of the charges,</span>
<a name="l00851"></a>00851 <span class="comment"> *    and you have your force (divided by r). A final multiplication</span>
<a name="l00852"></a>00852 <span class="comment"> *    with the vector connecting the two particles and you have your</span>
<a name="l00853"></a>00853 <span class="comment"> *    vectorial force to add to the particles.</span>
<a name="l00854"></a>00854 <span class="comment"> *</span>
<a name="l00855"></a>00855 <span class="comment"> */</span>
<a name="l00856"></a>00856 <span class="keyword">static</span> __m128d
<a name="l00857"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ab377f68a7459a5721c2ccbef2bc78fa6">00857</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ab377f68a7459a5721c2ccbef2bc78fa6">gmx_mm_pmecorrF_pd</a>(__m128d z2)
<a name="l00858"></a>00858 {
<a name="l00859"></a>00859     <span class="keyword">const</span> __m128d  FN10     = _mm_set1_pd(-8.0072854618360083154<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-14);
<a name="l00860"></a>00860     <span class="keyword">const</span> __m128d  FN9      = _mm_set1_pd(1.1859116242260148027<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-11);
<a name="l00861"></a>00861     <span class="keyword">const</span> __m128d  FN8      = _mm_set1_pd(-8.1490406329798423616<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-10);
<a name="l00862"></a>00862     <span class="keyword">const</span> __m128d  FN7      = _mm_set1_pd(3.4404793543907847655<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-8);
<a name="l00863"></a>00863     <span class="keyword">const</span> __m128d  FN6      = _mm_set1_pd(-9.9471420832602741006<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-7);
<a name="l00864"></a>00864     <span class="keyword">const</span> __m128d  FN5      = _mm_set1_pd(0.000020740315999115847456);
<a name="l00865"></a>00865     <span class="keyword">const</span> __m128d  FN4      = _mm_set1_pd(-0.00031991745139313364005);
<a name="l00866"></a>00866     <span class="keyword">const</span> __m128d  FN3      = _mm_set1_pd(0.0035074449373659008203);
<a name="l00867"></a>00867     <span class="keyword">const</span> __m128d  FN2      = _mm_set1_pd(-0.031750380176100813405);
<a name="l00868"></a>00868     <span class="keyword">const</span> __m128d  FN1      = _mm_set1_pd(0.13884101728898463426);
<a name="l00869"></a>00869     <span class="keyword">const</span> __m128d  FN0      = _mm_set1_pd(-0.75225277815249618847);
<a name="l00870"></a>00870 
<a name="l00871"></a>00871     <span class="keyword">const</span> __m128d  FD5      = _mm_set1_pd(0.000016009278224355026701);
<a name="l00872"></a>00872     <span class="keyword">const</span> __m128d  FD4      = _mm_set1_pd(0.00051055686934806966046);
<a name="l00873"></a>00873     <span class="keyword">const</span> __m128d  FD3      = _mm_set1_pd(0.0081803507497974289008);
<a name="l00874"></a>00874     <span class="keyword">const</span> __m128d  FD2      = _mm_set1_pd(0.077181146026670287235);
<a name="l00875"></a>00875     <span class="keyword">const</span> __m128d  FD1      = _mm_set1_pd(0.41543303143712535988);
<a name="l00876"></a>00876     <span class="keyword">const</span> __m128d  FD0      = _mm_set1_pd(1.0);
<a name="l00877"></a>00877 
<a name="l00878"></a>00878     __m128d        z4;
<a name="l00879"></a>00879     __m128d        polyFN0, polyFN1, polyFD0, polyFD1;
<a name="l00880"></a>00880 
<a name="l00881"></a>00881     z4             = _mm_mul_pd(z2, z2);
<a name="l00882"></a>00882 
<a name="l00883"></a>00883     polyFD1        = _mm_mul_pd(FD5, z4);
<a name="l00884"></a>00884     polyFD0        = _mm_mul_pd(FD4, z4);
<a name="l00885"></a>00885     polyFD1        = _mm_add_pd(polyFD1, FD3);
<a name="l00886"></a>00886     polyFD0        = _mm_add_pd(polyFD0, FD2);
<a name="l00887"></a>00887     polyFD1        = _mm_mul_pd(polyFD1, z4);
<a name="l00888"></a>00888     polyFD0        = _mm_mul_pd(polyFD0, z4);
<a name="l00889"></a>00889     polyFD1        = _mm_add_pd(polyFD1, FD1);
<a name="l00890"></a>00890     polyFD0        = _mm_add_pd(polyFD0, FD0);
<a name="l00891"></a>00891     polyFD1        = _mm_mul_pd(polyFD1, z2);
<a name="l00892"></a>00892     polyFD0        = _mm_add_pd(polyFD0, polyFD1);
<a name="l00893"></a>00893 
<a name="l00894"></a>00894     polyFD0        = <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(polyFD0);
<a name="l00895"></a>00895 
<a name="l00896"></a>00896     polyFN0        = _mm_mul_pd(FN10, z4);
<a name="l00897"></a>00897     polyFN1        = _mm_mul_pd(FN9, z4);
<a name="l00898"></a>00898     polyFN0        = _mm_add_pd(polyFN0, FN8);
<a name="l00899"></a>00899     polyFN1        = _mm_add_pd(polyFN1, FN7);
<a name="l00900"></a>00900     polyFN0        = _mm_mul_pd(polyFN0, z4);
<a name="l00901"></a>00901     polyFN1        = _mm_mul_pd(polyFN1, z4);
<a name="l00902"></a>00902     polyFN0        = _mm_add_pd(polyFN0, FN6);
<a name="l00903"></a>00903     polyFN1        = _mm_add_pd(polyFN1, FN5);
<a name="l00904"></a>00904     polyFN0        = _mm_mul_pd(polyFN0, z4);
<a name="l00905"></a>00905     polyFN1        = _mm_mul_pd(polyFN1, z4);
<a name="l00906"></a>00906     polyFN0        = _mm_add_pd(polyFN0, FN4);
<a name="l00907"></a>00907     polyFN1        = _mm_add_pd(polyFN1, FN3);
<a name="l00908"></a>00908     polyFN0        = _mm_mul_pd(polyFN0, z4);
<a name="l00909"></a>00909     polyFN1        = _mm_mul_pd(polyFN1, z4);
<a name="l00910"></a>00910     polyFN0        = _mm_add_pd(polyFN0, FN2);
<a name="l00911"></a>00911     polyFN1        = _mm_add_pd(polyFN1, FN1);
<a name="l00912"></a>00912     polyFN0        = _mm_mul_pd(polyFN0, z4);
<a name="l00913"></a>00913     polyFN1        = _mm_mul_pd(polyFN1, z2);
<a name="l00914"></a>00914     polyFN0        = _mm_add_pd(polyFN0, FN0);
<a name="l00915"></a>00915     polyFN0        = _mm_add_pd(polyFN0, polyFN1);
<a name="l00916"></a>00916 
<a name="l00917"></a>00917     <span class="keywordflow">return</span> _mm_mul_pd(polyFN0, polyFD0);
<a name="l00918"></a>00918 }
<a name="l00919"></a>00919 
<a name="l00920"></a>00920 
<a name="l00921"></a>00921 
<a name="l00922"></a>00922 
<a name="l00923"></a>00923 <span class="comment">/* Calculate the potential correction due to PME analytically.</span>
<a name="l00924"></a>00924 <span class="comment"> *</span>
<a name="l00925"></a>00925 <span class="comment"> * See gmx_mm256_pmecorrF_ps() for details about the approximation.</span>
<a name="l00926"></a>00926 <span class="comment"> *</span>
<a name="l00927"></a>00927 <span class="comment"> * This routine calculates Erf(z)/z, although you should provide z^2</span>
<a name="l00928"></a>00928 <span class="comment"> * as the input argument.</span>
<a name="l00929"></a>00929 <span class="comment"> *</span>
<a name="l00930"></a>00930 <span class="comment"> * Here&#39;s how it should be used:</span>
<a name="l00931"></a>00931 <span class="comment"> *</span>
<a name="l00932"></a>00932 <span class="comment"> * 1. Calculate r^2.</span>
<a name="l00933"></a>00933 <span class="comment"> * 2. Multiply by beta^2, so you get z^2=beta^2*r^2.</span>
<a name="l00934"></a>00934 <span class="comment"> * 3. Evaluate this routine with z^2 as the argument.</span>
<a name="l00935"></a>00935 <span class="comment"> * 4. The return value is the expression:</span>
<a name="l00936"></a>00936 <span class="comment"> *</span>
<a name="l00937"></a>00937 <span class="comment"> *</span>
<a name="l00938"></a>00938 <span class="comment"> *        erf(z)</span>
<a name="l00939"></a>00939 <span class="comment"> *       --------</span>
<a name="l00940"></a>00940 <span class="comment"> *          z</span>
<a name="l00941"></a>00941 <span class="comment"> *</span>
<a name="l00942"></a>00942 <span class="comment"> * 5. Multiply the entire expression by beta and switching back to r (z=r*beta):</span>
<a name="l00943"></a>00943 <span class="comment"> *</span>
<a name="l00944"></a>00944 <span class="comment"> *       erf(r*beta)</span>
<a name="l00945"></a>00945 <span class="comment"> *       -----------</span>
<a name="l00946"></a>00946 <span class="comment"> *           r</span>
<a name="l00947"></a>00947 <span class="comment"> *</span>
<a name="l00948"></a>00948 <span class="comment"> * 6. Subtract the result from 1/r, multiply by the product of the charges,</span>
<a name="l00949"></a>00949 <span class="comment"> *    and you have your potential.</span>
<a name="l00950"></a>00950 <span class="comment"> *</span>
<a name="l00951"></a>00951 <span class="comment"> */</span>
<a name="l00952"></a>00952 <span class="keyword">static</span> __m128d
<a name="l00953"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ac86b79c874c91b52f4f630a44b3e4fa5">00953</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ac86b79c874c91b52f4f630a44b3e4fa5">gmx_mm_pmecorrV_pd</a>(__m128d z2)
<a name="l00954"></a>00954 {
<a name="l00955"></a>00955     <span class="keyword">const</span> __m128d  VN9      = _mm_set1_pd(-9.3723776169321855475<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-13);
<a name="l00956"></a>00956     <span class="keyword">const</span> __m128d  VN8      = _mm_set1_pd(1.2280156762674215741<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-10);
<a name="l00957"></a>00957     <span class="keyword">const</span> __m128d  VN7      = _mm_set1_pd(-7.3562157912251309487<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-9);
<a name="l00958"></a>00958     <span class="keyword">const</span> __m128d  VN6      = _mm_set1_pd(2.6215886208032517509<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-7);
<a name="l00959"></a>00959     <span class="keyword">const</span> __m128d  VN5      = _mm_set1_pd(-4.9532491651265819499<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-6);
<a name="l00960"></a>00960     <span class="keyword">const</span> __m128d  VN4      = _mm_set1_pd(0.00025907400778966060389);
<a name="l00961"></a>00961     <span class="keyword">const</span> __m128d  VN3      = _mm_set1_pd(0.0010585044856156469792);
<a name="l00962"></a>00962     <span class="keyword">const</span> __m128d  VN2      = _mm_set1_pd(0.045247661136833092885);
<a name="l00963"></a>00963     <span class="keyword">const</span> __m128d  VN1      = _mm_set1_pd(0.11643931522926034421);
<a name="l00964"></a>00964     <span class="keyword">const</span> __m128d  VN0      = _mm_set1_pd(1.1283791671726767970);
<a name="l00965"></a>00965 
<a name="l00966"></a>00966     <span class="keyword">const</span> __m128d  VD5      = _mm_set1_pd(0.000021784709867336150342);
<a name="l00967"></a>00967     <span class="keyword">const</span> __m128d  VD4      = _mm_set1_pd(0.00064293662010911388448);
<a name="l00968"></a>00968     <span class="keyword">const</span> __m128d  VD3      = _mm_set1_pd(0.0096311444822588683504);
<a name="l00969"></a>00969     <span class="keyword">const</span> __m128d  VD2      = _mm_set1_pd(0.085608012351550627051);
<a name="l00970"></a>00970     <span class="keyword">const</span> __m128d  VD1      = _mm_set1_pd(0.43652499166614811084);
<a name="l00971"></a>00971     <span class="keyword">const</span> __m128d  VD0      = _mm_set1_pd(1.0);
<a name="l00972"></a>00972 
<a name="l00973"></a>00973     __m128d        z4;
<a name="l00974"></a>00974     __m128d        polyVN0, polyVN1, polyVD0, polyVD1;
<a name="l00975"></a>00975 
<a name="l00976"></a>00976     z4             = _mm_mul_pd(z2, z2);
<a name="l00977"></a>00977 
<a name="l00978"></a>00978     polyVD1        = _mm_mul_pd(VD5, z4);
<a name="l00979"></a>00979     polyVD0        = _mm_mul_pd(VD4, z4);
<a name="l00980"></a>00980     polyVD1        = _mm_add_pd(polyVD1, VD3);
<a name="l00981"></a>00981     polyVD0        = _mm_add_pd(polyVD0, VD2);
<a name="l00982"></a>00982     polyVD1        = _mm_mul_pd(polyVD1, z4);
<a name="l00983"></a>00983     polyVD0        = _mm_mul_pd(polyVD0, z4);
<a name="l00984"></a>00984     polyVD1        = _mm_add_pd(polyVD1, VD1);
<a name="l00985"></a>00985     polyVD0        = _mm_add_pd(polyVD0, VD0);
<a name="l00986"></a>00986     polyVD1        = _mm_mul_pd(polyVD1, z2);
<a name="l00987"></a>00987     polyVD0        = _mm_add_pd(polyVD0, polyVD1);
<a name="l00988"></a>00988 
<a name="l00989"></a>00989     polyVD0        = <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(polyVD0);
<a name="l00990"></a>00990 
<a name="l00991"></a>00991     polyVN1        = _mm_mul_pd(VN9, z4);
<a name="l00992"></a>00992     polyVN0        = _mm_mul_pd(VN8, z4);
<a name="l00993"></a>00993     polyVN1        = _mm_add_pd(polyVN1, VN7);
<a name="l00994"></a>00994     polyVN0        = _mm_add_pd(polyVN0, VN6);
<a name="l00995"></a>00995     polyVN1        = _mm_mul_pd(polyVN1, z4);
<a name="l00996"></a>00996     polyVN0        = _mm_mul_pd(polyVN0, z4);
<a name="l00997"></a>00997     polyVN1        = _mm_add_pd(polyVN1, VN5);
<a name="l00998"></a>00998     polyVN0        = _mm_add_pd(polyVN0, VN4);
<a name="l00999"></a>00999     polyVN1        = _mm_mul_pd(polyVN1, z4);
<a name="l01000"></a>01000     polyVN0        = _mm_mul_pd(polyVN0, z4);
<a name="l01001"></a>01001     polyVN1        = _mm_add_pd(polyVN1, VN3);
<a name="l01002"></a>01002     polyVN0        = _mm_add_pd(polyVN0, VN2);
<a name="l01003"></a>01003     polyVN1        = _mm_mul_pd(polyVN1, z4);
<a name="l01004"></a>01004     polyVN0        = _mm_mul_pd(polyVN0, z4);
<a name="l01005"></a>01005     polyVN1        = _mm_add_pd(polyVN1, VN1);
<a name="l01006"></a>01006     polyVN0        = _mm_add_pd(polyVN0, VN0);
<a name="l01007"></a>01007     polyVN1        = _mm_mul_pd(polyVN1, z2);
<a name="l01008"></a>01008     polyVN0        = _mm_add_pd(polyVN0, polyVN1);
<a name="l01009"></a>01009 
<a name="l01010"></a>01010     <span class="keywordflow">return</span> _mm_mul_pd(polyVN0, polyVD0);
<a name="l01011"></a>01011 }
<a name="l01012"></a>01012 
<a name="l01013"></a>01013 
<a name="l01014"></a>01014 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01015"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a9361bdcc1111ab1cd496fd7cc4524002">01015</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a9361bdcc1111ab1cd496fd7cc4524002">gmx_mm_sincos_pd</a>(__m128d  <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>,
<a name="l01016"></a>01016                  __m128d *sinval,
<a name="l01017"></a>01017                  __m128d *cosval)
<a name="l01018"></a>01018 {
<a name="l01019"></a>01019 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l01020"></a>01020 <span class="preprocessor"></span>    __declspec(align(16))
<a name="l01021"></a>01021     <span class="keyword">const</span> <span class="keywordtype">double</span> sintable[34] =
<a name="l01022"></a>01022     {
<a name="l01023"></a>01023         1.00000000000000000e+00, 0.00000000000000000e+00,
<a name="l01024"></a>01024         9.95184726672196929e-01, 9.80171403295606036e-02,
<a name="l01025"></a>01025         9.80785280403230431e-01, 1.95090322016128248e-01,
<a name="l01026"></a>01026         9.56940335732208824e-01, 2.90284677254462331e-01,
<a name="l01027"></a>01027         9.23879532511286738e-01, 3.82683432365089782e-01,
<a name="l01028"></a>01028         8.81921264348355050e-01, 4.71396736825997642e-01,
<a name="l01029"></a>01029         8.31469612302545236e-01, 5.55570233019602178e-01,
<a name="l01030"></a>01030         7.73010453362736993e-01, 6.34393284163645488e-01,
<a name="l01031"></a>01031         7.07106781186547573e-01, 7.07106781186547462e-01,
<a name="l01032"></a>01032         6.34393284163645599e-01, 7.73010453362736882e-01,
<a name="l01033"></a>01033         5.55570233019602289e-01, 8.31469612302545125e-01,
<a name="l01034"></a>01034         4.71396736825997809e-01, 8.81921264348354939e-01,
<a name="l01035"></a>01035         3.82683432365089837e-01, 9.23879532511286738e-01,
<a name="l01036"></a>01036         2.90284677254462276e-01, 9.56940335732208935e-01,
<a name="l01037"></a>01037         1.95090322016128304e-01, 9.80785280403230431e-01,
<a name="l01038"></a>01038         9.80171403295607702e-02, 9.95184726672196818e-01,
<a name="l01039"></a>01039         0.0, 1.00000000000000000e+00
<a name="l01040"></a>01040     };
<a name="l01041"></a>01041 <span class="preprocessor">#else</span>
<a name="l01042"></a>01042 <span class="preprocessor"></span>    <span class="keyword">const</span> __m128d sintable[17] =
<a name="l01043"></a>01043     {
<a name="l01044"></a>01044         _mm_set_pd( 0.0, 1.0 ),
<a name="l01045"></a>01045         _mm_set_pd( sin(  1.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0), cos(  1.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0) ),
<a name="l01046"></a>01046         _mm_set_pd( sin(  2.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0), cos(  2.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0) ),
<a name="l01047"></a>01047         _mm_set_pd( sin(  3.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0), cos(  3.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0) ),
<a name="l01048"></a>01048         _mm_set_pd( sin(  4.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0), cos(  4.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0) ),
<a name="l01049"></a>01049         _mm_set_pd( sin(  5.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0), cos(  5.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0) ),
<a name="l01050"></a>01050         _mm_set_pd( sin(  6.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0), cos(  6.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0) ),
<a name="l01051"></a>01051         _mm_set_pd( sin(  7.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0), cos(  7.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0) ),
<a name="l01052"></a>01052         _mm_set_pd( sin(  8.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0), cos(  8.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0) ),
<a name="l01053"></a>01053         _mm_set_pd( sin(  9.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0), cos(  9.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0) ),
<a name="l01054"></a>01054         _mm_set_pd( sin( 10.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0), cos( 10.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0) ),
<a name="l01055"></a>01055         _mm_set_pd( sin( 11.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0), cos( 11.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0) ),
<a name="l01056"></a>01056         _mm_set_pd( sin( 12.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0), cos( 12.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0) ),
<a name="l01057"></a>01057         _mm_set_pd( sin( 13.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0), cos( 13.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0) ),
<a name="l01058"></a>01058         _mm_set_pd( sin( 14.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0), cos( 14.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0) ),
<a name="l01059"></a>01059         _mm_set_pd( sin( 15.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0), cos( 15.0 * (<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0) / 16.0) ),
<a name="l01060"></a>01060         _mm_set_pd(  1.0, 0.0 )
<a name="l01061"></a>01061     };
<a name="l01062"></a>01062 <span class="preprocessor">#endif</span>
<a name="l01063"></a>01063 <span class="preprocessor"></span>
<a name="l01064"></a>01064     <span class="keyword">const</span> __m128d signmask       = <a class="code" href="include_2gmx__x86__avx__128__fma_8h.html#a15d96a23ac5f6569e6d35e73ea186589">gmx_mm_castsi128_pd</a>( _mm_set_epi32(0x7FFFFFFF, 0xFFFFFFFF, 0x7FFFFFFF, 0xFFFFFFFF) );
<a name="l01065"></a>01065     <span class="keyword">const</span> __m128i signbit_epi32  = _mm_set1_epi32(0x80000000);
<a name="l01066"></a>01066 
<a name="l01067"></a>01067     <span class="keyword">const</span> __m128d tabscale      = _mm_set1_pd(32.0/<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>);
<a name="l01068"></a>01068     <span class="keyword">const</span> __m128d invtabscale0  = _mm_set1_pd(9.81747508049011230469<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-02);
<a name="l01069"></a>01069     <span class="keyword">const</span> __m128d invtabscale1  = _mm_set1_pd(1.96197799156550576057<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-08);
<a name="l01070"></a>01070     <span class="keyword">const</span> __m128i ione          = _mm_set1_epi32(1);
<a name="l01071"></a>01071     <span class="keyword">const</span> __m128i i32           = _mm_set1_epi32(32);
<a name="l01072"></a>01072     <span class="keyword">const</span> __m128i i16           = _mm_set1_epi32(16);
<a name="l01073"></a>01073     <span class="keyword">const</span> __m128i tabmask       = _mm_set1_epi32(0x3F);
<a name="l01074"></a>01074     <span class="keyword">const</span> __m128d sinP7         = _mm_set1_pd(-1.0/5040.0);
<a name="l01075"></a>01075     <span class="keyword">const</span> __m128d sinP5         = _mm_set1_pd(1.0/120.0);
<a name="l01076"></a>01076     <span class="keyword">const</span> __m128d sinP3         = _mm_set1_pd(-1.0/6.0);
<a name="l01077"></a>01077     <span class="keyword">const</span> __m128d sinP1         = _mm_set1_pd(1.0);
<a name="l01078"></a>01078 
<a name="l01079"></a>01079     <span class="keyword">const</span> __m128d cosP6         = _mm_set1_pd(-1.0/720.0);
<a name="l01080"></a>01080     <span class="keyword">const</span> __m128d cosP4         = _mm_set1_pd(1.0/24.0);
<a name="l01081"></a>01081     <span class="keyword">const</span> __m128d cosP2         = _mm_set1_pd(-1.0/2.0);
<a name="l01082"></a>01082     <span class="keyword">const</span> __m128d cosP0         = _mm_set1_pd(1.0);
<a name="l01083"></a>01083 
<a name="l01084"></a>01084     __m128d       scalex;
<a name="l01085"></a>01085     __m128i       tabidx, corridx;
<a name="l01086"></a>01086     __m128d       xabs, <a class="code" href="include_2gmx__arpack_8h.html#a4f5dbf2e71c295ecca7ff4214e90ba91">z</a>, z2, polySin, polyCos;
<a name="l01087"></a>01087     __m128d       xpoint;
<a name="l01088"></a>01088     __m128d       ypoint0, ypoint1;
<a name="l01089"></a>01089 
<a name="l01090"></a>01090     __m128d       sinpoint, cospoint;
<a name="l01091"></a>01091     __m128d       xsign, ssign, csign;
<a name="l01092"></a>01092     __m128i       imask, sswapsign, cswapsign;
<a name="l01093"></a>01093     __m128d       minusone;
<a name="l01094"></a>01094 
<a name="l01095"></a>01095     xsign    = _mm_andnot_pd(signmask, x);
<a name="l01096"></a>01096     xabs     = _mm_and_pd(x, signmask);
<a name="l01097"></a>01097 
<a name="l01098"></a>01098     scalex   = _mm_mul_pd(tabscale, xabs);
<a name="l01099"></a>01099     tabidx   = _mm_cvtpd_epi32(scalex);
<a name="l01100"></a>01100 
<a name="l01101"></a>01101     xpoint   = _mm_round_pd(scalex, _MM_FROUND_TO_NEAREST_INT);
<a name="l01102"></a>01102 
<a name="l01103"></a>01103     <span class="comment">/* Extended precision arithmetics */</span>
<a name="l01104"></a>01104     z        = _mm_sub_pd(xabs, _mm_mul_pd(invtabscale0, xpoint));
<a name="l01105"></a>01105     z        = _mm_sub_pd(z, _mm_mul_pd(invtabscale1, xpoint));
<a name="l01106"></a>01106 
<a name="l01107"></a>01107     <span class="comment">/* Range reduction to 0..2*Pi */</span>
<a name="l01108"></a>01108     tabidx   = _mm_and_si128(tabidx, tabmask);
<a name="l01109"></a>01109 
<a name="l01110"></a>01110     <span class="comment">/* tabidx is now in range [0,..,64] */</span>
<a name="l01111"></a>01111     imask     = _mm_cmpgt_epi32(tabidx, i32);
<a name="l01112"></a>01112     sswapsign = imask;
<a name="l01113"></a>01113     cswapsign = imask;
<a name="l01114"></a>01114     corridx   = _mm_and_si128(imask, i32);
<a name="l01115"></a>01115     tabidx    = _mm_sub_epi32(tabidx, corridx);
<a name="l01116"></a>01116 
<a name="l01117"></a>01117     <span class="comment">/* tabidx is now in range [0..32] */</span>
<a name="l01118"></a>01118     imask     = _mm_cmpgt_epi32(tabidx, i16);
<a name="l01119"></a>01119     cswapsign = _mm_xor_si128(cswapsign, imask);
<a name="l01120"></a>01120     corridx   = _mm_sub_epi32(i32, tabidx);
<a name="l01121"></a>01121     tabidx    = _mm_blendv_epi8(tabidx, corridx, imask);
<a name="l01122"></a>01122     <span class="comment">/* tabidx is now in range [0..16] */</span>
<a name="l01123"></a>01123     ssign     = _mm_cvtepi32_pd( _mm_or_si128( sswapsign, ione ) );
<a name="l01124"></a>01124     csign     = _mm_cvtepi32_pd( _mm_or_si128( cswapsign, ione ) );
<a name="l01125"></a>01125 
<a name="l01126"></a>01126 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l01127"></a>01127 <span class="preprocessor"></span>    ypoint0  = _mm_load_pd(sintable + 2*_mm_extract_epi32(tabidx, 0));
<a name="l01128"></a>01128     ypoint1  = _mm_load_pd(sintable + 2*_mm_extract_epi32(tabidx, 1));
<a name="l01129"></a>01129 <span class="preprocessor">#else</span>
<a name="l01130"></a>01130 <span class="preprocessor"></span>    ypoint0  = sintable[_mm_extract_epi32(tabidx, 0)];
<a name="l01131"></a>01131     ypoint1  = sintable[_mm_extract_epi32(tabidx, 1)];
<a name="l01132"></a>01132 <span class="preprocessor">#endif</span>
<a name="l01133"></a>01133 <span class="preprocessor"></span>    sinpoint = _mm_unpackhi_pd(ypoint0, ypoint1);
<a name="l01134"></a>01134     cospoint = _mm_unpacklo_pd(ypoint0, ypoint1);
<a name="l01135"></a>01135 
<a name="l01136"></a>01136     sinpoint = _mm_mul_pd(sinpoint, ssign);
<a name="l01137"></a>01137     cospoint = _mm_mul_pd(cospoint, csign);
<a name="l01138"></a>01138 
<a name="l01139"></a>01139     z2       = _mm_mul_pd(z, z);
<a name="l01140"></a>01140 
<a name="l01141"></a>01141     polySin  = _mm_mul_pd(sinP7, z2);
<a name="l01142"></a>01142     polySin  = _mm_add_pd(polySin, sinP5);
<a name="l01143"></a>01143     polySin  = _mm_mul_pd(polySin, z2);
<a name="l01144"></a>01144     polySin  = _mm_add_pd(polySin, sinP3);
<a name="l01145"></a>01145     polySin  = _mm_mul_pd(polySin, z2);
<a name="l01146"></a>01146     polySin  = _mm_add_pd(polySin, sinP1);
<a name="l01147"></a>01147     polySin  = _mm_mul_pd(polySin, z);
<a name="l01148"></a>01148 
<a name="l01149"></a>01149     polyCos  = _mm_mul_pd(cosP6, z2);
<a name="l01150"></a>01150     polyCos  = _mm_add_pd(polyCos, cosP4);
<a name="l01151"></a>01151     polyCos  = _mm_mul_pd(polyCos, z2);
<a name="l01152"></a>01152     polyCos  = _mm_add_pd(polyCos, cosP2);
<a name="l01153"></a>01153     polyCos  = _mm_mul_pd(polyCos, z2);
<a name="l01154"></a>01154     polyCos  = _mm_add_pd(polyCos, cosP0);
<a name="l01155"></a>01155 
<a name="l01156"></a>01156     *sinval  = _mm_xor_pd(_mm_add_pd( _mm_mul_pd(sinpoint, polyCos), _mm_mul_pd(cospoint, polySin) ), xsign);
<a name="l01157"></a>01157     *cosval  = _mm_sub_pd( _mm_mul_pd(cospoint, polyCos), _mm_mul_pd(sinpoint, polySin) );
<a name="l01158"></a>01158 
<a name="l01159"></a>01159     <span class="keywordflow">return</span> 0;
<a name="l01160"></a>01160 }
<a name="l01161"></a>01161 
<a name="l01162"></a>01162 <span class="comment">/*</span>
<a name="l01163"></a>01163 <span class="comment"> * IMPORTANT: Do NOT call both sin &amp; cos if you need both results, since each of them</span>
<a name="l01164"></a>01164 <span class="comment"> * will then call the sincos() routine and waste a factor 2 in performance!</span>
<a name="l01165"></a>01165 <span class="comment"> */</span>
<a name="l01166"></a>01166 <span class="keyword">static</span> __m128d
<a name="l01167"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#af0a23a0bf589422dd79b060ad6d080a6">01167</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#af0a23a0bf589422dd79b060ad6d080a6">gmx_mm_sin_pd</a>(__m128d <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>)
<a name="l01168"></a>01168 {
<a name="l01169"></a>01169     __m128d <a class="code" href="include_2gmx__blas_8h.html#a4f1e75c623bc60ab5ac886fc569598a8">s</a>, <a class="code" href="include_2gmx__blas_8h.html#aa83af1e92d01e2ce0dfa2ff664326efd">c</a>;
<a name="l01170"></a>01170     <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a9361bdcc1111ab1cd496fd7cc4524002">gmx_mm_sincos_pd</a>(x, &amp;s, &amp;c);
<a name="l01171"></a>01171     <span class="keywordflow">return</span> <a class="code" href="include_2gmx__blas_8h.html#a4f1e75c623bc60ab5ac886fc569598a8">s</a>;
<a name="l01172"></a>01172 }
<a name="l01173"></a>01173 
<a name="l01174"></a>01174 <span class="comment">/*</span>
<a name="l01175"></a>01175 <span class="comment"> * IMPORTANT: Do NOT call both sin &amp; cos if you need both results, since each of them</span>
<a name="l01176"></a>01176 <span class="comment"> * will then call the sincos() routine and waste a factor 2 in performance!</span>
<a name="l01177"></a>01177 <span class="comment"> */</span>
<a name="l01178"></a>01178 <span class="keyword">static</span> __m128d
<a name="l01179"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a1eee9af33a178b56fa3e9ea6d1ae1e0d">01179</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a1eee9af33a178b56fa3e9ea6d1ae1e0d">gmx_mm_cos_pd</a>(__m128d <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>)
<a name="l01180"></a>01180 {
<a name="l01181"></a>01181     __m128d <a class="code" href="include_2gmx__blas_8h.html#a4f1e75c623bc60ab5ac886fc569598a8">s</a>, <a class="code" href="include_2gmx__blas_8h.html#aa83af1e92d01e2ce0dfa2ff664326efd">c</a>;
<a name="l01182"></a>01182     <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a9361bdcc1111ab1cd496fd7cc4524002">gmx_mm_sincos_pd</a>(x, &amp;s, &amp;c);
<a name="l01183"></a>01183     <span class="keywordflow">return</span> <a class="code" href="include_2gmx__blas_8h.html#aa83af1e92d01e2ce0dfa2ff664326efd">c</a>;
<a name="l01184"></a>01184 }
<a name="l01185"></a>01185 
<a name="l01186"></a>01186 
<a name="l01187"></a>01187 
<a name="l01188"></a>01188 <span class="keyword">static</span> __m128d
<a name="l01189"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a53abeaf3a86e76c9073c6c8c781450a5">01189</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a53abeaf3a86e76c9073c6c8c781450a5">gmx_mm_tan_pd</a>(__m128d <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>)
<a name="l01190"></a>01190 {
<a name="l01191"></a>01191     __m128d sinval, cosval;
<a name="l01192"></a>01192     __m128d tanval;
<a name="l01193"></a>01193 
<a name="l01194"></a>01194     <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a9361bdcc1111ab1cd496fd7cc4524002">gmx_mm_sincos_pd</a>(x, &amp;sinval, &amp;cosval);
<a name="l01195"></a>01195 
<a name="l01196"></a>01196     tanval = _mm_mul_pd(sinval, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(cosval));
<a name="l01197"></a>01197 
<a name="l01198"></a>01198     <span class="keywordflow">return</span> tanval;
<a name="l01199"></a>01199 }
<a name="l01200"></a>01200 
<a name="l01201"></a>01201 
<a name="l01202"></a>01202 
<a name="l01203"></a>01203 <span class="keyword">static</span> __m128d
<a name="l01204"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad4feda2f34442b3b891641493c1320ae">01204</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad4feda2f34442b3b891641493c1320ae">gmx_mm_asin_pd</a>(__m128d <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>)
<a name="l01205"></a>01205 {
<a name="l01206"></a>01206     <span class="comment">/* Same algorithm as cephes library */</span>
<a name="l01207"></a>01207     <span class="keyword">const</span> __m128d signmask  = <a class="code" href="include_2gmx__x86__avx__128__fma_8h.html#a15d96a23ac5f6569e6d35e73ea186589">gmx_mm_castsi128_pd</a>( _mm_set_epi32(0x7FFFFFFF, 0xFFFFFFFF, 0x7FFFFFFF, 0xFFFFFFFF) );
<a name="l01208"></a>01208     <span class="keyword">const</span> __m128d limit1    = _mm_set1_pd(0.625);
<a name="l01209"></a>01209     <span class="keyword">const</span> __m128d limit2    = _mm_set1_pd(1<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-8);
<a name="l01210"></a>01210     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#ada85e349d35971b32c8ea4238881ff8b">one</a>       = _mm_set1_pd(1.0);
<a name="l01211"></a>01211     <span class="keyword">const</span> __m128d halfpi    = _mm_set1_pd(<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0);
<a name="l01212"></a>01212     <span class="keyword">const</span> __m128d quarterpi = _mm_set1_pd(<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/4.0);
<a name="l01213"></a>01213     <span class="keyword">const</span> __m128d morebits  = _mm_set1_pd(6.123233995736765886130<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-17);
<a name="l01214"></a>01214 
<a name="l01215"></a>01215     <span class="keyword">const</span> __m128d P5        = _mm_set1_pd(4.253011369004428248960<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-3);
<a name="l01216"></a>01216     <span class="keyword">const</span> __m128d P4        = _mm_set1_pd(-6.019598008014123785661<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-1);
<a name="l01217"></a>01217     <span class="keyword">const</span> __m128d P3        = _mm_set1_pd(5.444622390564711410273e0);
<a name="l01218"></a>01218     <span class="keyword">const</span> __m128d P2        = _mm_set1_pd(-1.626247967210700244449e1);
<a name="l01219"></a>01219     <span class="keyword">const</span> __m128d P1        = _mm_set1_pd(1.956261983317594739197e1);
<a name="l01220"></a>01220     <span class="keyword">const</span> __m128d P0        = _mm_set1_pd(-8.198089802484824371615e0);
<a name="l01221"></a>01221 
<a name="l01222"></a>01222     <span class="keyword">const</span> __m128d Q4        = _mm_set1_pd(-1.474091372988853791896e1);
<a name="l01223"></a>01223     <span class="keyword">const</span> __m128d Q3        = _mm_set1_pd(7.049610280856842141659e1);
<a name="l01224"></a>01224     <span class="keyword">const</span> __m128d Q2        = _mm_set1_pd(-1.471791292232726029859<a class="code" href="include_2gmx__lapack_8h.html#a940a4ccebd05dcf81cf91afd05427ccd">e2</a>);
<a name="l01225"></a>01225     <span class="keyword">const</span> __m128d Q1        = _mm_set1_pd(1.395105614657485689735<a class="code" href="include_2gmx__lapack_8h.html#a940a4ccebd05dcf81cf91afd05427ccd">e2</a>);
<a name="l01226"></a>01226     <span class="keyword">const</span> __m128d Q0        = _mm_set1_pd(-4.918853881490881290097e1);
<a name="l01227"></a>01227 
<a name="l01228"></a>01228     <span class="keyword">const</span> __m128d R4        = _mm_set1_pd(2.967721961301243206100<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-3);
<a name="l01229"></a>01229     <span class="keyword">const</span> __m128d R3        = _mm_set1_pd(-5.634242780008963776856<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-1);
<a name="l01230"></a>01230     <span class="keyword">const</span> __m128d R2        = _mm_set1_pd(6.968710824104713396794e0);
<a name="l01231"></a>01231     <span class="keyword">const</span> __m128d R1        = _mm_set1_pd(-2.556901049652824852289e1);
<a name="l01232"></a>01232     <span class="keyword">const</span> __m128d R0        = _mm_set1_pd(2.853665548261061424989e1);
<a name="l01233"></a>01233 
<a name="l01234"></a>01234     <span class="keyword">const</span> __m128d S3        = _mm_set1_pd(-2.194779531642920639778e1);
<a name="l01235"></a>01235     <span class="keyword">const</span> __m128d S2        = _mm_set1_pd(1.470656354026814941758<a class="code" href="include_2gmx__lapack_8h.html#a940a4ccebd05dcf81cf91afd05427ccd">e2</a>);
<a name="l01236"></a>01236     <span class="keyword">const</span> __m128d S1        = _mm_set1_pd(-3.838770957603691357202<a class="code" href="include_2gmx__lapack_8h.html#a940a4ccebd05dcf81cf91afd05427ccd">e2</a>);
<a name="l01237"></a>01237     <span class="keyword">const</span> __m128d S0        = _mm_set1_pd(3.424398657913078477438<a class="code" href="include_2gmx__lapack_8h.html#a940a4ccebd05dcf81cf91afd05427ccd">e2</a>);
<a name="l01238"></a>01238 
<a name="l01239"></a>01239     __m128d       <a class="code" href="include_2maths_8h.html#a0e774219bb032f7b38a0b74e153b715d">sign</a>;
<a name="l01240"></a>01240     __m128d       mask;
<a name="l01241"></a>01241     __m128d       xabs;
<a name="l01242"></a>01242     __m128d       zz, ww, <a class="code" href="include_2gmx__arpack_8h.html#a4f5dbf2e71c295ecca7ff4214e90ba91">z</a>, <a class="code" href="include_2gmx__lapack_8h.html#ae7eb68b191e2ae9d52d5faa1ccd140d6">q</a>, <a class="code" href="include_2gmx__lapack_8h.html#ab484f49f296361999f2c4ba1e7e95586">w</a>, <a class="code" href="include_2gmx__blas_8h.html#a3641a70d7e24c9a5fa842b02c5edaf23">y</a>, zz2, ww2;
<a name="l01243"></a>01243     __m128d       PA, PB;
<a name="l01244"></a>01244     __m128d       QA, QB;
<a name="l01245"></a>01245     __m128d       RA, RB;
<a name="l01246"></a>01246     __m128d       <a class="code" href="hackblock_8c.html#a624a37ff829f1c3de3e3329a76e61e10">SA</a>, SB;
<a name="l01247"></a>01247     __m128d       nom, denom;
<a name="l01248"></a>01248 
<a name="l01249"></a>01249     sign  = _mm_andnot_pd(signmask, x);
<a name="l01250"></a>01250     xabs  = _mm_and_pd(x, signmask);
<a name="l01251"></a>01251 
<a name="l01252"></a>01252     mask  = _mm_cmpgt_pd(xabs, limit1);
<a name="l01253"></a>01253 
<a name="l01254"></a>01254     zz    = _mm_sub_pd(one, xabs);
<a name="l01255"></a>01255     ww    = _mm_mul_pd(xabs, xabs);
<a name="l01256"></a>01256     zz2   = _mm_mul_pd(zz, zz);
<a name="l01257"></a>01257     ww2   = _mm_mul_pd(ww, ww);
<a name="l01258"></a>01258 
<a name="l01259"></a>01259     <span class="comment">/* R */</span>
<a name="l01260"></a>01260     RA    = _mm_mul_pd(R4, zz2);
<a name="l01261"></a>01261     RB    = _mm_mul_pd(R3, zz2);
<a name="l01262"></a>01262     RA    = _mm_add_pd(RA, R2);
<a name="l01263"></a>01263     RB    = _mm_add_pd(RB, R1);
<a name="l01264"></a>01264     RA    = _mm_mul_pd(RA, zz2);
<a name="l01265"></a>01265     RB    = _mm_mul_pd(RB, zz);
<a name="l01266"></a>01266     RA    = _mm_add_pd(RA, R0);
<a name="l01267"></a>01267     RA    = _mm_add_pd(RA, RB);
<a name="l01268"></a>01268 
<a name="l01269"></a>01269     <span class="comment">/* S, SA = zz2 */</span>
<a name="l01270"></a>01270     SB    = _mm_mul_pd(S3, zz2);
<a name="l01271"></a>01271     SA    = _mm_add_pd(zz2, S2);
<a name="l01272"></a>01272     SB    = _mm_add_pd(SB, S1);
<a name="l01273"></a>01273     SA    = _mm_mul_pd(SA, zz2);
<a name="l01274"></a>01274     SB    = _mm_mul_pd(SB, zz);
<a name="l01275"></a>01275     SA    = _mm_add_pd(SA, S0);
<a name="l01276"></a>01276     SA    = _mm_add_pd(SA, SB);
<a name="l01277"></a>01277 
<a name="l01278"></a>01278     <span class="comment">/* P */</span>
<a name="l01279"></a>01279     PA    = _mm_mul_pd(P5, ww2);
<a name="l01280"></a>01280     PB    = _mm_mul_pd(P4, ww2);
<a name="l01281"></a>01281     PA    = _mm_add_pd(PA, P3);
<a name="l01282"></a>01282     PB    = _mm_add_pd(PB, P2);
<a name="l01283"></a>01283     PA    = _mm_mul_pd(PA, ww2);
<a name="l01284"></a>01284     PB    = _mm_mul_pd(PB, ww2);
<a name="l01285"></a>01285     PA    = _mm_add_pd(PA, P1);
<a name="l01286"></a>01286     PB    = _mm_add_pd(PB, P0);
<a name="l01287"></a>01287     PA    = _mm_mul_pd(PA, ww);
<a name="l01288"></a>01288     PA    = _mm_add_pd(PA, PB);
<a name="l01289"></a>01289 
<a name="l01290"></a>01290     <span class="comment">/* Q, QA = ww2 */</span>
<a name="l01291"></a>01291     QB    = _mm_mul_pd(Q4, ww2);
<a name="l01292"></a>01292     QA    = _mm_add_pd(ww2, Q3);
<a name="l01293"></a>01293     QB    = _mm_add_pd(QB, Q2);
<a name="l01294"></a>01294     QA    = _mm_mul_pd(QA, ww2);
<a name="l01295"></a>01295     QB    = _mm_mul_pd(QB, ww2);
<a name="l01296"></a>01296     QA    = _mm_add_pd(QA, Q1);
<a name="l01297"></a>01297     QB    = _mm_add_pd(QB, Q0);
<a name="l01298"></a>01298     QA    = _mm_mul_pd(QA, ww);
<a name="l01299"></a>01299     QA    = _mm_add_pd(QA, QB);
<a name="l01300"></a>01300 
<a name="l01301"></a>01301     RA    = _mm_mul_pd(RA, zz);
<a name="l01302"></a>01302     PA    = _mm_mul_pd(PA, ww);
<a name="l01303"></a>01303 
<a name="l01304"></a>01304     nom   = _mm_blendv_pd( PA, RA, mask );
<a name="l01305"></a>01305     denom = _mm_blendv_pd( QA, SA, mask );
<a name="l01306"></a>01306 
<a name="l01307"></a>01307     q     = _mm_mul_pd( nom, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(denom) );
<a name="l01308"></a>01308 
<a name="l01309"></a>01309     zz    = _mm_add_pd(zz, zz);
<a name="l01310"></a>01310     zz    = <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a34a1c9addc31acbb09c58587a51960e8">gmx_mm_sqrt_pd</a>(zz);
<a name="l01311"></a>01311     z     = _mm_sub_pd(quarterpi, zz);
<a name="l01312"></a>01312     zz    = _mm_mul_pd(zz, q);
<a name="l01313"></a>01313     zz    = _mm_sub_pd(zz, morebits);
<a name="l01314"></a>01314     z     = _mm_sub_pd(z, zz);
<a name="l01315"></a>01315     z     = _mm_add_pd(z, quarterpi);
<a name="l01316"></a>01316 
<a name="l01317"></a>01317     w     = _mm_mul_pd(xabs, q);
<a name="l01318"></a>01318     w     = _mm_add_pd(w, xabs);
<a name="l01319"></a>01319 
<a name="l01320"></a>01320     z     = _mm_blendv_pd( w, z, mask );
<a name="l01321"></a>01321 
<a name="l01322"></a>01322     mask  = _mm_cmpgt_pd(xabs, limit2);
<a name="l01323"></a>01323     z     = _mm_blendv_pd( xabs, z, mask );
<a name="l01324"></a>01324 
<a name="l01325"></a>01325     z = _mm_xor_pd(z, sign);
<a name="l01326"></a>01326 
<a name="l01327"></a>01327     <span class="keywordflow">return</span> <a class="code" href="include_2gmx__arpack_8h.html#a4f5dbf2e71c295ecca7ff4214e90ba91">z</a>;
<a name="l01328"></a>01328 }
<a name="l01329"></a>01329 
<a name="l01330"></a>01330 
<a name="l01331"></a>01331 <span class="keyword">static</span> __m128d
<a name="l01332"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a3d0826477a3ae2aae2f1b97ea3f0365c">01332</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a3d0826477a3ae2aae2f1b97ea3f0365c">gmx_mm_acos_pd</a>(__m128d <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>)
<a name="l01333"></a>01333 {
<a name="l01334"></a>01334     <span class="keyword">const</span> __m128d signmask   = <a class="code" href="include_2gmx__x86__avx__128__fma_8h.html#a15d96a23ac5f6569e6d35e73ea186589">gmx_mm_castsi128_pd</a>( _mm_set_epi32(0x7FFFFFFF, 0xFFFFFFFF, 0x7FFFFFFF, 0xFFFFFFFF) );
<a name="l01335"></a>01335     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#ada85e349d35971b32c8ea4238881ff8b">one</a>        = _mm_set1_pd(1.0);
<a name="l01336"></a>01336     <span class="keyword">const</span> __m128d <a class="code" href="maths_8c.html#a701d1f7de8380226dbc8825672ae4ef0">half</a>       = _mm_set1_pd(0.5);
<a name="l01337"></a>01337     <span class="keyword">const</span> __m128d pi         = _mm_set1_pd(<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>);
<a name="l01338"></a>01338     <span class="keyword">const</span> __m128d quarterpi0 = _mm_set1_pd(7.85398163397448309616<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-1);
<a name="l01339"></a>01339     <span class="keyword">const</span> __m128d quarterpi1 = _mm_set1_pd(6.123233995736765886130<a class="code" href="include_2gmx__lapack_8h.html#a23a74386628df419a31fc7a34866c1ef">e</a>-17);
<a name="l01340"></a>01340 
<a name="l01341"></a>01341 
<a name="l01342"></a>01342     __m128d mask1;
<a name="l01343"></a>01343 
<a name="l01344"></a>01344     __m128d <a class="code" href="include_2gmx__arpack_8h.html#a4f5dbf2e71c295ecca7ff4214e90ba91">z</a>, z1, z2;
<a name="l01345"></a>01345 
<a name="l01346"></a>01346     mask1 = _mm_cmpgt_pd(x, half);
<a name="l01347"></a>01347     z1    = _mm_mul_pd(half, _mm_sub_pd(one, x));
<a name="l01348"></a>01348     z1    = <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a34a1c9addc31acbb09c58587a51960e8">gmx_mm_sqrt_pd</a>(z1);
<a name="l01349"></a>01349     z     = _mm_blendv_pd( x, z1, mask1 );
<a name="l01350"></a>01350 
<a name="l01351"></a>01351     z     = <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad4feda2f34442b3b891641493c1320ae">gmx_mm_asin_pd</a>(z);
<a name="l01352"></a>01352 
<a name="l01353"></a>01353     z1    = _mm_add_pd(z, z);
<a name="l01354"></a>01354 
<a name="l01355"></a>01355     z2    = _mm_sub_pd(quarterpi0, z);
<a name="l01356"></a>01356     z2    = _mm_add_pd(z2, quarterpi1);
<a name="l01357"></a>01357     z2    = _mm_add_pd(z2, quarterpi0);
<a name="l01358"></a>01358 
<a name="l01359"></a>01359     z     = _mm_blendv_pd(z2, z1, mask1);
<a name="l01360"></a>01360 
<a name="l01361"></a>01361     <span class="keywordflow">return</span> <a class="code" href="include_2gmx__arpack_8h.html#a4f5dbf2e71c295ecca7ff4214e90ba91">z</a>;
<a name="l01362"></a>01362 }
<a name="l01363"></a>01363 
<a name="l01364"></a>01364 <span class="keyword">static</span> __m128d
<a name="l01365"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a63a0510ae584206e66abf54d2bdd0968">01365</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a63a0510ae584206e66abf54d2bdd0968">gmx_mm_atan_pd</a>(__m128d <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>)
<a name="l01366"></a>01366 {
<a name="l01367"></a>01367     <span class="comment">/* Same algorithm as cephes library */</span>
<a name="l01368"></a>01368     <span class="keyword">const</span> __m128d signmask  = <a class="code" href="include_2gmx__x86__avx__128__fma_8h.html#a15d96a23ac5f6569e6d35e73ea186589">gmx_mm_castsi128_pd</a>( _mm_set_epi32(0x7FFFFFFF, 0xFFFFFFFF, 0x7FFFFFFF, 0xFFFFFFFF) );
<a name="l01369"></a>01369     <span class="keyword">const</span> __m128d limit1    = _mm_set1_pd(0.66);
<a name="l01370"></a>01370     <span class="keyword">const</span> __m128d limit2    = _mm_set1_pd(2.41421356237309504880);
<a name="l01371"></a>01371     <span class="keyword">const</span> __m128d quarterpi = _mm_set1_pd(<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/4.0);
<a name="l01372"></a>01372     <span class="keyword">const</span> __m128d halfpi    = _mm_set1_pd(<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0);
<a name="l01373"></a>01373     <span class="keyword">const</span> __m128d mone      = _mm_set1_pd(-1.0);
<a name="l01374"></a>01374     <span class="keyword">const</span> __m128d morebits1 = _mm_set1_pd(0.5*6.123233995736765886130E-17);
<a name="l01375"></a>01375     <span class="keyword">const</span> __m128d morebits2 = _mm_set1_pd(6.123233995736765886130E-17);
<a name="l01376"></a>01376 
<a name="l01377"></a>01377     <span class="keyword">const</span> __m128d P4        = _mm_set1_pd(-8.750608600031904122785E-1);
<a name="l01378"></a>01378     <span class="keyword">const</span> __m128d P3        = _mm_set1_pd(-1.615753718733365076637E1);
<a name="l01379"></a>01379     <span class="keyword">const</span> __m128d P2        = _mm_set1_pd(-7.500855792314704667340E1);
<a name="l01380"></a>01380     <span class="keyword">const</span> __m128d P1        = _mm_set1_pd(-1.228866684490136173410E2);
<a name="l01381"></a>01381     <span class="keyword">const</span> __m128d P0        = _mm_set1_pd(-6.485021904942025371773E1);
<a name="l01382"></a>01382 
<a name="l01383"></a>01383     <span class="keyword">const</span> __m128d Q4        = _mm_set1_pd(2.485846490142306297962E1);
<a name="l01384"></a>01384     <span class="keyword">const</span> __m128d Q3        = _mm_set1_pd(1.650270098316988542046E2);
<a name="l01385"></a>01385     <span class="keyword">const</span> __m128d Q2        = _mm_set1_pd(4.328810604912902668951E2);
<a name="l01386"></a>01386     <span class="keyword">const</span> __m128d Q1        = _mm_set1_pd(4.853903996359136964868E2);
<a name="l01387"></a>01387     <span class="keyword">const</span> __m128d Q0        = _mm_set1_pd(1.945506571482613964425E2);
<a name="l01388"></a>01388 
<a name="l01389"></a>01389     __m128d       <a class="code" href="include_2maths_8h.html#a0e774219bb032f7b38a0b74e153b715d">sign</a>;
<a name="l01390"></a>01390     __m128d       mask1, mask2;
<a name="l01391"></a>01391     __m128d       <a class="code" href="include_2gmx__blas_8h.html#a3641a70d7e24c9a5fa842b02c5edaf23">y</a>, t1, t2;
<a name="l01392"></a>01392     __m128d       <a class="code" href="include_2gmx__arpack_8h.html#a4f5dbf2e71c295ecca7ff4214e90ba91">z</a>, z2;
<a name="l01393"></a>01393     __m128d       P_A, P_B, Q_A, Q_B;
<a name="l01394"></a>01394 
<a name="l01395"></a>01395     sign   = _mm_andnot_pd(signmask, x);
<a name="l01396"></a>01396     x      = _mm_and_pd(x, signmask);
<a name="l01397"></a>01397 
<a name="l01398"></a>01398     mask1  = _mm_cmpgt_pd(x, limit1);
<a name="l01399"></a>01399     mask2  = _mm_cmpgt_pd(x, limit2);
<a name="l01400"></a>01400 
<a name="l01401"></a>01401     t1     = _mm_mul_pd(_mm_add_pd(x, mone), <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(_mm_sub_pd(x, mone)));
<a name="l01402"></a>01402     t2     = _mm_mul_pd(mone, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(x));
<a name="l01403"></a>01403 
<a name="l01404"></a>01404     y      = _mm_and_pd(mask1, quarterpi);
<a name="l01405"></a>01405     y      = _mm_or_pd( _mm_and_pd(mask2, halfpi), _mm_andnot_pd(mask2, y) );
<a name="l01406"></a>01406 
<a name="l01407"></a>01407     x      = _mm_or_pd( _mm_and_pd(mask1, t1), _mm_andnot_pd(mask1, x) );
<a name="l01408"></a>01408     x      = _mm_or_pd( _mm_and_pd(mask2, t2), _mm_andnot_pd(mask2, x) );
<a name="l01409"></a>01409 
<a name="l01410"></a>01410     z      = _mm_mul_pd(x, x);
<a name="l01411"></a>01411     z2     = _mm_mul_pd(z, z);
<a name="l01412"></a>01412 
<a name="l01413"></a>01413     P_A    = _mm_mul_pd(P4, z2);
<a name="l01414"></a>01414     P_B    = _mm_mul_pd(P3, z2);
<a name="l01415"></a>01415     P_A    = _mm_add_pd(P_A, P2);
<a name="l01416"></a>01416     P_B    = _mm_add_pd(P_B, P1);
<a name="l01417"></a>01417     P_A    = _mm_mul_pd(P_A, z2);
<a name="l01418"></a>01418     P_B    = _mm_mul_pd(P_B, z);
<a name="l01419"></a>01419     P_A    = _mm_add_pd(P_A, P0);
<a name="l01420"></a>01420     P_A    = _mm_add_pd(P_A, P_B);
<a name="l01421"></a>01421 
<a name="l01422"></a>01422     <span class="comment">/* Q_A = z2 */</span>
<a name="l01423"></a>01423     Q_B    = _mm_mul_pd(Q4, z2);
<a name="l01424"></a>01424     Q_A    = _mm_add_pd(z2, Q3);
<a name="l01425"></a>01425     Q_B    = _mm_add_pd(Q_B, Q2);
<a name="l01426"></a>01426     Q_A    = _mm_mul_pd(Q_A, z2);
<a name="l01427"></a>01427     Q_B    = _mm_mul_pd(Q_B, z2);
<a name="l01428"></a>01428     Q_A    = _mm_add_pd(Q_A, Q1);
<a name="l01429"></a>01429     Q_B    = _mm_add_pd(Q_B, Q0);
<a name="l01430"></a>01430     Q_A    = _mm_mul_pd(Q_A, z);
<a name="l01431"></a>01431     Q_A    = _mm_add_pd(Q_A, Q_B);
<a name="l01432"></a>01432 
<a name="l01433"></a>01433     z      = _mm_mul_pd(z, P_A);
<a name="l01434"></a>01434     z      = _mm_mul_pd(z, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(Q_A));
<a name="l01435"></a>01435     z      = _mm_mul_pd(z, x);
<a name="l01436"></a>01436     z      = _mm_add_pd(z, x);
<a name="l01437"></a>01437 
<a name="l01438"></a>01438     t1     = _mm_and_pd(mask1, morebits1);
<a name="l01439"></a>01439     t1     = _mm_or_pd( _mm_and_pd(mask2, morebits2), _mm_andnot_pd(mask2, t1) );
<a name="l01440"></a>01440 
<a name="l01441"></a>01441     z      = _mm_add_pd(z, t1);
<a name="l01442"></a>01442     y      = _mm_add_pd(y, z);
<a name="l01443"></a>01443 
<a name="l01444"></a>01444     y      = _mm_xor_pd(y, sign);
<a name="l01445"></a>01445 
<a name="l01446"></a>01446     <span class="keywordflow">return</span> <a class="code" href="include_2gmx__blas_8h.html#a3641a70d7e24c9a5fa842b02c5edaf23">y</a>;
<a name="l01447"></a>01447 }
<a name="l01448"></a>01448 
<a name="l01449"></a>01449 
<a name="l01450"></a>01450 <span class="keyword">static</span> __m128d
<a name="l01451"></a><a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad606181c301eca033c485287075e3389">01451</a> <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad606181c301eca033c485287075e3389">gmx_mm_atan2_pd</a>(__m128d <a class="code" href="include_2gmx__blas_8h.html#a3641a70d7e24c9a5fa842b02c5edaf23">y</a>, __m128d <a class="code" href="include_2gmx__blas_8h.html#a1613a230af44b86d121f3cc8b7c4d831">x</a>)
<a name="l01452"></a>01452 {
<a name="l01453"></a>01453     <span class="keyword">const</span> __m128d pi          = _mm_set1_pd(<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>);
<a name="l01454"></a>01454     <span class="keyword">const</span> __m128d minuspi     = _mm_set1_pd(-<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>);
<a name="l01455"></a>01455     <span class="keyword">const</span> __m128d halfpi      = _mm_set1_pd(<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0);
<a name="l01456"></a>01456     <span class="keyword">const</span> __m128d minushalfpi = _mm_set1_pd(-<a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/2.0);
<a name="l01457"></a>01457 
<a name="l01458"></a>01458     __m128d       <a class="code" href="include_2gmx__arpack_8h.html#a4f5dbf2e71c295ecca7ff4214e90ba91">z</a>, z1, z3, z4;
<a name="l01459"></a>01459     __m128d       <a class="code" href="include_2gmx__lapack_8h.html#ab484f49f296361999f2c4ba1e7e95586">w</a>;
<a name="l01460"></a>01460     __m128d       maskx_lt, maskx_eq;
<a name="l01461"></a>01461     __m128d       masky_lt, masky_eq;
<a name="l01462"></a>01462     __m128d       mask1, mask2, mask3, mask4, maskall;
<a name="l01463"></a>01463 
<a name="l01464"></a>01464     maskx_lt  = _mm_cmplt_pd(x, _mm_setzero_pd());
<a name="l01465"></a>01465     masky_lt  = _mm_cmplt_pd(y, _mm_setzero_pd());
<a name="l01466"></a>01466     maskx_eq  = _mm_cmpeq_pd(x, _mm_setzero_pd());
<a name="l01467"></a>01467     masky_eq  = _mm_cmpeq_pd(y, _mm_setzero_pd());
<a name="l01468"></a>01468 
<a name="l01469"></a>01469     z         = _mm_mul_pd(y, <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#ad23cdb235835762bebdabad5e3d2ff99">gmx_mm_inv_pd</a>(x));
<a name="l01470"></a>01470     z         = <a class="code" href="share_2template_2gromacs_2gmx__math__x86__sse4__1__double_8h.html#a63a0510ae584206e66abf54d2bdd0968">gmx_mm_atan_pd</a>(z);
<a name="l01471"></a>01471 
<a name="l01472"></a>01472     mask1     = _mm_and_pd(maskx_eq, masky_lt);
<a name="l01473"></a>01473     mask2     = _mm_andnot_pd(maskx_lt, masky_eq);
<a name="l01474"></a>01474     mask3     = _mm_andnot_pd( _mm_or_pd(masky_lt, masky_eq), maskx_eq);
<a name="l01475"></a>01475     mask4     = _mm_and_pd(masky_eq, maskx_lt);
<a name="l01476"></a>01476 
<a name="l01477"></a>01477     maskall   = _mm_or_pd( _mm_or_pd(mask1, mask2), _mm_or_pd(mask3, mask4) );
<a name="l01478"></a>01478 
<a name="l01479"></a>01479     z         = _mm_andnot_pd(maskall, z);
<a name="l01480"></a>01480     z1        = _mm_and_pd(mask1, minushalfpi);
<a name="l01481"></a>01481     z3        = _mm_and_pd(mask3, halfpi);
<a name="l01482"></a>01482     z4        = _mm_and_pd(mask4, pi);
<a name="l01483"></a>01483 
<a name="l01484"></a>01484     z         = _mm_or_pd( _mm_or_pd(z, z1), _mm_or_pd(z3, z4) );
<a name="l01485"></a>01485 
<a name="l01486"></a>01486     w         = _mm_blendv_pd(pi, minuspi, masky_lt);
<a name="l01487"></a>01487     w         = _mm_and_pd(w, maskx_lt);
<a name="l01488"></a>01488 
<a name="l01489"></a>01489     w         = _mm_andnot_pd(maskall, w);
<a name="l01490"></a>01490 
<a name="l01491"></a>01491     z         = _mm_add_pd(z, w);
<a name="l01492"></a>01492 
<a name="l01493"></a>01493     <span class="keywordflow">return</span> <a class="code" href="include_2gmx__arpack_8h.html#a4f5dbf2e71c295ecca7ff4214e90ba91">z</a>;
<a name="l01494"></a>01494 }
<a name="l01495"></a>01495 
<a name="l01496"></a>01496 <span class="preprocessor">#endif </span><span class="comment">/*_gmx_math_x86_sse4_1_double_h_ */</span>
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Tue Jan 6 2015 16:30:29 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
